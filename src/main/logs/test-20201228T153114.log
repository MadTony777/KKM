156  [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGatewayWithStubs_DONE()
428  [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
438  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
451  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
1080 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
1082 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
1091 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
61386 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
61387 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, DONE, nothing, ЖПлато_000898541]
121651 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
121796 [main] INFO  kkm.UnitTests - Response message : {"took":6,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":3,"relation":"eq"},"max_score":11.017492,"hits":[{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"F3CSqHYBfrYj4vM98H38","_score":11.017492,"_source":{"@timestamp":"2020-12-28T08:59:08.992Z","host":{"name":"4597739f505f"},"agent":{"ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-12-28T08:59:08.989+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"c1557a9afae0dba7\",\"spanId\":\"c1557a9afae0dba7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c1557a9afae0dba7\",\"X-B3-TraceId\":\"c1557a9afae0dba7\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"log":{"offset":38019693,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"stream":"stdout","input":{"type":"container"}}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"NN7sqHYBfrYj4vM9rKIx","_score":11.017492,"_source":{"@timestamp":"2020-12-28T10:37:09.071Z","host":{"name":"4597739f505f"},"stream":"stdout","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"log":{"offset":42259873,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"message":"{\"ts\":\"2020-12-28T10:37:09.071+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"1654b7ce47022ac3\",\"spanId\":\"1654b7ce47022ac3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"1654b7ce47022ac3\",\"X-B3-TraceId\":\"1654b7ce47022ac3\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"DmtVqXYBfrYj4vM9d5sL","_score":11.017492,"_source":{"@timestamp":"2020-12-28T12:31:31.170Z","ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"agent":{"hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11"},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","Version":"97","com_docker_swarm_task":""}}},"message":"{\"ts\":\"2020-12-28T12:31:31.170+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"8926858514ed0d76\",\"spanId\":\"8926858514ed0d76\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8926858514ed0d76\",\"X-B3-TraceId\":\"8926858514ed0d76\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"log":{"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"},"offset":47154290},"stream":"stdout"}}]}}
121806 [main] INFO  kkm.UnitTests - End test

121814 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_Error()
121971 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
121971 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
121972 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
122394 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000901797'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000901797'
select * from ProcessStatus where srcID = 'ЖПлато_000901797'
122396 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
122399 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
182650 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000901797'
182651 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000901797]
242659 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000901797%22%20&size=500
242724 [main] INFO  kkm.UnitTests - Response message : {"took":2,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":3,"relation":"eq"},"max_score":11.857303,"hits":[{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"FnKUqHYBfrYj4vM9xebO","_score":11.857303,"_source":{"@timestamp":"2020-12-28T09:01:08.998Z","log":{"offset":38129690,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","Version":"97"}}},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c"},"message":"{\"ts\":\"2020-12-28T09:01:08.998+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"d2d79b190e4396aa\",\"spanId\":\"d2d79b190e4396aa\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d2d79b190e4396aa\",\"X-B3-TraceId\":\"d2d79b190e4396aa\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"O-HuqHYBfrYj4vM9gOj1","_score":11.857303,"_source":{"@timestamp":"2020-12-28T10:39:09.064Z","docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service"}}},"agent":{"ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"stream":"stdout","input":{"type":"container"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"},"host":{"name":"4597739f505f"},"log":{"offset":42370906,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"message":"{\"ts\":\"2020-12-28T10:39:09.064+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"fdb45761ccf30f42\",\"spanId\":\"fdb45761ccf30f42\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"fdb45761ccf30f42\",\"X-B3-TraceId\":\"fdb45761ccf30f42\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}"}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"2W1XqXYBfrYj4vM9S73a","_score":11.857303,"_source":{"@timestamp":"2020-12-28T12:33:31.143Z","input":{"type":"container"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"}}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"stream":"stdout","log":{"offset":47268425,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"4597739f505f"},"message":"{\"ts\":\"2020-12-28T12:33:31.143+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"8594101a22c53506\",\"spanId\":\"8594101a22c53506\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8594101a22c53506\",\"X-B3-TraceId\":\"8594101a22c53506\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}"}}]}}
242728 [main] INFO  kkm.UnitTests - End test

242738 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_NOFILIAL()
242894 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-z069MkicLOMq', '5634885281', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-z069MkicLOMq','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-z069MkicLOMq', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-z069MkicLOMq', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-z069MkicLOMq'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-z069MkicLOMq'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-z069MkicLOMq'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-z069MkicLOMq'
353558 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-z069MkicLOMq'
353558 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-z069MkicLOMq, null]
353560 [main] INFO  kkm.UnitTests - Status: null
353562 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
353562 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
373570 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
373637 [main] INFO  kkm.UnitTests - Response message : {"took":6,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1513,"relation":"eq"},"max_score":3.547755,"hits":[{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"i-OupnYBfrYj4vM9KF_B","_score":3.547755,"_source":{"@timestamp":"2020-12-28T00:09:31.141Z","docker":{"container":{"labels":{"com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","Version":"97","com_docker_swarm_task":""}}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"ecs":{"version":"1.0.1"},"log":{"offset":16366421,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"input":{"type":"container"},"host":{"name":"4597739f505f"},"stream":"stdout","message":"{\"ts\":\"2020-12-28T00:09:31.141+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a6d8893940910301\",\"spanId\":\"a6d8893940910301\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a6d8893940910301\",\"X-B3-TraceId\":\"a6d8893940910301\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"IeOupnYBfrYj4vM9obLc","_score":3.547755,"_source":{"@timestamp":"2020-12-28T00:10:09.071Z","ecs":{"version":"1.0.1"},"stream":"stdout","log":{"offset":16392448,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"},"host":{"name":"4597739f505f"},"message":"{\"ts\":\"2020-12-28T00:10:09.070+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7e077400ba643131\",\"spanId\":\"7e077400ba643131\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7e077400ba643131\",\"X-B3-TraceId\":\"7e077400ba643131\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service"}}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"3t-mpnYBfrYj4vM9yTnC","_score":3.547755,"_source":{"@timestamp":"2020-12-28T00:01:31.133Z","stream":"stdout","message":"{\"ts\":\"2020-12-28T00:01:31.133+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"551c77b71c860272\",\"spanId\":\"551c77b71c860272\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"551c77b71c860272\",\"X-B3-TraceId\":\"551c77b71c860272\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","Version":"97","com_docker_swarm_task":""}}},"host":{"name":"4597739f505f"},"log":{"offset":16039249,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"M9-npnYBfrYj4vM9ToiV","_score":3.547755,"_source":{"@timestamp":"2020-12-28T00:02:09.038Z","log":{"offset":16063715,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"message":"{\"ts\":\"2020-12-28T00:02:09.038+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"8079f2beaaefc4b6\",\"spanId\":\"8079f2beaaefc4b6\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8079f2beaaefc4b6\",\"X-B3-TraceId\":\"8079f2beaaefc4b6\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"}}},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"9OKspnYBfrYj4vM9SHQ8","_score":3.547755,"_source":{"@timestamp":"2020-12-28T00:07:31.149Z","log":{"offset":16283374,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"stream":"stdout","container":{"name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"message":"{\"ts\":\"2020-12-28T00:07:31.149+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3623c8f140184393\",\"spanId\":\"3623c8f140184393\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3623c8f140184393\",\"X-B3-TraceId\":\"3623c8f140184393\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}}]}}
373781 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
373811 [main] INFO  kkm.UnitTests - End test

373815 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_UTC12_DONE()
373989 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-G1AA5klzNwSI', '8222830390', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-G1AA5klzNwSI','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-G1AA5klzNwSI', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-G1AA5klzNwSI', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-G1AA5klzNwSI'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-G1AA5klzNwSI'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-G1AA5klzNwSI'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-G1AA5klzNwSI'
484679 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-G1AA5klzNwSI'
484679 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-G1AA5klzNwSI, null]
484683 [main] INFO  kkm.UnitTests - Status: null
484683 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
484683 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
504686 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
504745 [main] INFO  kkm.UnitTests - Response message : {"took":1,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1519,"relation":"eq"},"max_score":3.547564,"hits":[{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"i-OupnYBfrYj4vM9KF_B","_score":3.547564,"_source":{"@timestamp":"2020-12-28T00:09:31.141Z","docker":{"container":{"labels":{"com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","Version":"97","com_docker_swarm_task":""}}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"ecs":{"version":"1.0.1"},"log":{"offset":16366421,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"input":{"type":"container"},"host":{"name":"4597739f505f"},"stream":"stdout","message":"{\"ts\":\"2020-12-28T00:09:31.141+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a6d8893940910301\",\"spanId\":\"a6d8893940910301\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a6d8893940910301\",\"X-B3-TraceId\":\"a6d8893940910301\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"IeOupnYBfrYj4vM9obLc","_score":3.547564,"_source":{"@timestamp":"2020-12-28T00:10:09.071Z","ecs":{"version":"1.0.1"},"stream":"stdout","log":{"offset":16392448,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"},"host":{"name":"4597739f505f"},"message":"{\"ts\":\"2020-12-28T00:10:09.070+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7e077400ba643131\",\"spanId\":\"7e077400ba643131\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7e077400ba643131\",\"X-B3-TraceId\":\"7e077400ba643131\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service"}}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"3t-mpnYBfrYj4vM9yTnC","_score":3.547564,"_source":{"@timestamp":"2020-12-28T00:01:31.133Z","stream":"stdout","message":"{\"ts\":\"2020-12-28T00:01:31.133+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"551c77b71c860272\",\"spanId\":\"551c77b71c860272\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"551c77b71c860272\",\"X-B3-TraceId\":\"551c77b71c860272\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","Version":"97","com_docker_swarm_task":""}}},"host":{"name":"4597739f505f"},"log":{"offset":16039249,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"M9-npnYBfrYj4vM9ToiV","_score":3.547564,"_source":{"@timestamp":"2020-12-28T00:02:09.038Z","log":{"offset":16063715,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"message":"{\"ts\":\"2020-12-28T00:02:09.038+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"8079f2beaaefc4b6\",\"spanId\":\"8079f2beaaefc4b6\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8079f2beaaefc4b6\",\"X-B3-TraceId\":\"8079f2beaaefc4b6\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"}}},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"9OKspnYBfrYj4vM9SHQ8","_score":3.547564,"_source":{"@timestamp":"2020-12-28T00:07:31.149Z","log":{"offset":16283374,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"stream":"stdout","container":{"name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"message":"{\"ts\":\"2020-12-28T00:07:31.149+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3623c8f140184393\",\"spanId\":\"3623c8f140184393\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3623c8f140184393\",\"X-B3-TraceId\":\"3623c8f140184393\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}}]}}
504890 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
504914 [main] INFO  kkm.UnitTests - End test

504915 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_UTC2_FAIL()
505065 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-TcgZ57aHYynh', '3781235748', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-TcgZ57aHYynh','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-TcgZ57aHYynh', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-TcgZ57aHYynh', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-TcgZ57aHYynh'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-TcgZ57aHYynh'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-TcgZ57aHYynh'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-TcgZ57aHYynh'
615693 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-TcgZ57aHYynh'
615693 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-TcgZ57aHYynh, null]
615697 [main] INFO  kkm.UnitTests - Status: null
615698 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
615699 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
635702 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
635794 [main] INFO  kkm.UnitTests - Response message : {"took":1,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1523,"relation":"eq"},"max_score":3.547487,"hits":[{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"i-OupnYBfrYj4vM9KF_B","_score":3.547487,"_source":{"@timestamp":"2020-12-28T00:09:31.141Z","docker":{"container":{"labels":{"com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","Version":"97","com_docker_swarm_task":""}}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"ecs":{"version":"1.0.1"},"log":{"offset":16366421,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"input":{"type":"container"},"host":{"name":"4597739f505f"},"stream":"stdout","message":"{\"ts\":\"2020-12-28T00:09:31.141+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a6d8893940910301\",\"spanId\":\"a6d8893940910301\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a6d8893940910301\",\"X-B3-TraceId\":\"a6d8893940910301\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"IeOupnYBfrYj4vM9obLc","_score":3.547487,"_source":{"@timestamp":"2020-12-28T00:10:09.071Z","ecs":{"version":"1.0.1"},"stream":"stdout","log":{"offset":16392448,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"},"host":{"name":"4597739f505f"},"message":"{\"ts\":\"2020-12-28T00:10:09.070+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7e077400ba643131\",\"spanId\":\"7e077400ba643131\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7e077400ba643131\",\"X-B3-TraceId\":\"7e077400ba643131\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service"}}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"3t-mpnYBfrYj4vM9yTnC","_score":3.547487,"_source":{"@timestamp":"2020-12-28T00:01:31.133Z","stream":"stdout","message":"{\"ts\":\"2020-12-28T00:01:31.133+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"551c77b71c860272\",\"spanId\":\"551c77b71c860272\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"551c77b71c860272\",\"X-B3-TraceId\":\"551c77b71c860272\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","Version":"97","com_docker_swarm_task":""}}},"host":{"name":"4597739f505f"},"log":{"offset":16039249,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"M9-npnYBfrYj4vM9ToiV","_score":3.547487,"_source":{"@timestamp":"2020-12-28T00:02:09.038Z","log":{"offset":16063715,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"message":"{\"ts\":\"2020-12-28T00:02:09.038+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"8079f2beaaefc4b6\",\"spanId\":\"8079f2beaaefc4b6\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8079f2beaaefc4b6\",\"X-B3-TraceId\":\"8079f2beaaefc4b6\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"}}},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"9OKspnYBfrYj4vM9SHQ8","_score":3.547487,"_source":{"@timestamp":"2020-12-28T00:07:31.149Z","log":{"offset":16283374,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"stream":"stdout","container":{"name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"message":"{\"ts\":\"2020-12-28T00:07:31.149+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3623c8f140184393\",\"spanId\":\"3623c8f140184393\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3623c8f140184393\",\"X-B3-TraceId\":\"3623c8f140184393\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}}]}}
635958 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
635980 [main] INFO  kkm.UnitTests - End test

635981 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_UTC12_DONE()
636112 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-vzYDiVbQwfQp', '8613038459', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-vzYDiVbQwfQp','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-vzYDiVbQwfQp', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-vzYDiVbQwfQp', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-vzYDiVbQwfQp'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-vzYDiVbQwfQp'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-vzYDiVbQwfQp'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-vzYDiVbQwfQp'
746913 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-vzYDiVbQwfQp'
746914 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-vzYDiVbQwfQp, null]
746917 [main] INFO  kkm.UnitTests - Status: null
746917 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
746917 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
747018 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/null
747018 [main] INFO  kkm.UnitTests - Response Code : 400
747020 [main] INFO  kkm.UnitTests - End test

747036 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_NOFILIAL()
747241 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4uT4kjfl0IIE', '8017648935', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4uT4kjfl0IIE','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4uT4kjfl0IIE', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4uT4kjfl0IIE', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-4uT4kjfl0IIE'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-4uT4kjfl0IIE'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-4uT4kjfl0IIE'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-4uT4kjfl0IIE'
857842 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-4uT4kjfl0IIE'
857843 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-4uT4kjfl0IIE, c551bd70-3324-4554-8522-193972a83833]
857846 [main] INFO  kkm.UnitTests - Status: DONE
857847 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
857847 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
857965 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/c551bd70-3324-4554-8522-193972a83833
857965 [main] INFO  kkm.UnitTests - Response Code : 200
857973 [main] INFO  kkm.UnitTests - [DONE]
877978 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-4uT4kjfl0IIE%22%20&size=500
878041 [main] INFO  kkm.UnitTests - Response message : {"took":5,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":28.634426,"hits":[{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"v3hgqXYBfrYj4vM98Kjq","_score":28.634426,"_source":{"@timestamp":"2020-12-28T12:44:09.063Z","log":{"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"},"offset":47725028},"stream":"stdout","ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"message":"{\"ts\":\"2020-12-28T12:44:09.063+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"ed891cd33b0f40c3\",\"spanId\":\"ed891cd33b0f40c3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"ed891cd33b0f40c3\",\"X-B3-TraceId\":\"ed891cd33b0f40c3\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-z069MkicLOMq\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-4uT4kjfl0IIE\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef"},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","Version":"97","com_docker_swarm_task":""}}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}}]}}
878208 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
878230 [main] INFO  kkm.UnitTests - End test

878231 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_UTC2_FAIL()
878393 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-587sbBCxhMPN', '1992061262', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-587sbBCxhMPN','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-587sbBCxhMPN', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-587sbBCxhMPN', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-587sbBCxhMPN'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-587sbBCxhMPN'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-587sbBCxhMPN'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-587sbBCxhMPN'
989121 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-587sbBCxhMPN'
989121 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-587sbBCxhMPN, f4ad3acb-963c-4a7e-b6a2-d8c66a8c516c]
989123 [main] INFO  kkm.UnitTests - Status: FAIL
989123 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
989123 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
989466 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/f4ad3acb-963c-4a7e-b6a2-d8c66a8c516c
989466 [main] INFO  kkm.UnitTests - Response Code : 200
989474 [main] INFO  kkm.UnitTests - [FAIL]
1009476 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-587sbBCxhMPN%22%20&size=500
1009536 [main] INFO  kkm.UnitTests - Response message : {"took":5,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":28.313404,"hits":[{"_index":"kkm-commutator-stage-2020.12.28","_type":"_doc","_id":"3XpiqXYBfrYj4vM9xWW4","_score":28.313404,"_source":{"@timestamp":"2020-12-28T12:46:09.194Z","agent":{"hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11"},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"log":{"offset":47862191,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"stream":"stdout","container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Version":"97","com_docker_swarm_task":""}}},"message":"{\"ts\":\"2020-12-28T12:46:09.194+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"bdc973659b97a8d4\",\"spanId\":\"bdc973659b97a8d4\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"bdc973659b97a8d4\",\"X-B3-TraceId\":\"bdc973659b97a8d4\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-TcgZ57aHYynh\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-587sbBCxhMPN\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"}}}]}}
1009675 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1009702 [main] INFO  kkm.UnitTests - End test

