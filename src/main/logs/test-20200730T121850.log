246  [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGatewayWithStubs_DONE()
518  [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
523  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
532  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
1441 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
1441 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
1444 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
61713 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
61715 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, DONE, nothing, ЖПлато_000898541]
121987 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.30/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
122185 [main] INFO  kkm.UnitTests - Response message : {"took":29,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":3,"relation":"eq"},"max_score":10.746557,"hits":[{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"NYdWnnMBtD96ebe81Toq","_score":10.746557,"_source":{"@timestamp":"2020-07-30T06:09:18.616Z","message":"{\"ts\":\"2020-07-30T06:09:18.613+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"4c94f2fda184f004\",\"spanId\":\"4c94f2fda184f004\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"4c94f2fda184f004\",\"X-B3-TraceId\":\"4c94f2fda184f004\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Version":"97","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"stream":"stdout","log":{"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"},"offset":1453937},"container":{"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef","name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"44fcff07405a"},"json":{"method":"getReadyForSendingReceiptKeys","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000898541"}],"msg":"ReadyForSendingReceiptKeys selected ","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","X-B3-SpanId":"4c94f2fda184f004","X-B3-TraceId":"4c94f2fda184f004","ts":"2020-07-30T06:09:18.613+00:00","level":"INFO","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","traceId":"4c94f2fda184f004","spanId":"4c94f2fda184f004","caller_line_number":84,"thread":"scheduling-1","spanExportable":"true","X-Span-Export":"true"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"iZSmnnMBtD96ebe8j6Q4","_score":10.746557,"_source":{"@timestamp":"2020-07-30T07:36:18.762Z","log":{"offset":3720005,"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"}},"stream":"stdout","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"message":"{\"ts\":\"2020-07-30T07:36:18.762+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"d68394f44e74a20f\",\"spanId\":\"d68394f44e74a20f\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d68394f44e74a20f\",\"X-B3-TraceId\":\"d68394f44e74a20f\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"json":{"spanId":"d68394f44e74a20f","msg":"ReadyForSendingReceiptKeys selected ","ts":"2020-07-30T07:36:18.762+00:00","level":"INFO","traceId":"d68394f44e74a20f","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","X-Span-Export":"true","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000898541"}],"caller_line_number":84,"thread":"scheduling-1","X-B3-TraceId":"d68394f44e74a20f","X-B3-SpanId":"d68394f44e74a20f","method":"getReadyForSendingReceiptKeys","caller_file_name":"KkmCommutatorService.java","spanExportable":"true"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"rJvNnnMBtD96ebe82gdv","_score":10.746557,"_source":{"@timestamp":"2020-07-30T08:19:18.346Z","agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"ecs":{"version":"1.0.1"},"json":{"method":"getReadyForSendingReceiptKeys","thread":"scheduling-1","X-B3-TraceId":"39a86243d1271aa0","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","level":"INFO","spanId":"39a86243d1271aa0","X-B3-SpanId":"39a86243d1271aa0","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000898541"}],"class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","caller_line_number":84,"msg":"ReadyForSendingReceiptKeys selected ","ts":"2020-07-30T08:19:18.346+00:00","traceId":"39a86243d1271aa0","spanExportable":"true","X-Span-Export":"true"},"stream":"stdout","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","Version":"97","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service"}}},"host":{"name":"44fcff07405a"},"log":{"offset":4908166,"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"}},"message":"{\"ts\":\"2020-07-30T08:19:18.346+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"39a86243d1271aa0\",\"spanId\":\"39a86243d1271aa0\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"39a86243d1271aa0\",\"X-B3-TraceId\":\"39a86243d1271aa0\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef","name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}}}}]}}
122208 [main] INFO  kkm.UnitTests - End test

122217 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_Error()
122378 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
122379 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000902849
122380 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000902849
122906 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000902849'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000902849'
select * from ProcessStatus where srcID = 'ЖПлато_000902849'
122907 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000902849]
122912 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000902849]
183187 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000902849'
183188 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000902849]
243197 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.30/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000902849%22%20&size=500
243262 [main] INFO  kkm.UnitTests - Response message : {"took":11,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":3,"relation":"eq"},"max_score":11.548989,"hits":[{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"bIdYnnMBtD96ebe8qWT7","_score":11.548989,"_source":{"@timestamp":"2020-07-30T06:11:18.834Z","input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug"}}},"container":{"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef","name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"host":{"name":"44fcff07405a"},"json":{"caller_line_number":84,"thread":"scheduling-1","X-B3-TraceId":"c47b5487d6565f49","spanId":"c47b5487d6565f49","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000902849"}],"ts":"2020-07-30T06:11:18.833+00:00","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","caller_file_name":"KkmCommutatorService.java","msg":"ReadyForSendingReceiptKeys selected ","level":"INFO","spanExportable":"true","X-Span-Export":"true","X-B3-SpanId":"c47b5487d6565f49","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","traceId":"c47b5487d6565f49"},"log":{"offset":1526459,"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-30T06:11:18.833+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"c47b5487d6565f49\",\"spanId\":\"c47b5487d6565f49\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c47b5487d6565f49\",\"X-B3-TraceId\":\"c47b5487d6565f49\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000902849\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"EpWonnMBtD96ebe8ZyEW","_score":11.548989,"_source":{"@timestamp":"2020-07-30T07:38:18.566Z","stream":"stdout","message":"{\"ts\":\"2020-07-30T07:38:18.566+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"ee9e399c7aed3151\",\"spanId\":\"ee9e399c7aed3151\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"ee9e399c7aed3151\",\"X-B3-TraceId\":\"ee9e399c7aed3151\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000902849\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"json":{"level":"INFO","spanId":"ee9e399c7aed3151","X-B3-SpanId":"ee9e399c7aed3151","ts":"2020-07-30T07:38:18.566+00:00","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","caller_file_name":"KkmCommutatorService.java","caller_line_number":84,"thread":"scheduling-1","X-Span-Export":"true","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","traceId":"ee9e399c7aed3151","spanExportable":"true","X-B3-TraceId":"ee9e399c7aed3151","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000902849"}],"msg":"ReadyForSendingReceiptKeys selected "},"log":{"offset":3792531,"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"}},"input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug"}}}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"H5vPnnMBtD96ebe8rxdB","_score":11.548989,"_source":{"@timestamp":"2020-07-30T08:21:18.586Z","ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"docker":{"container":{"labels":{"com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Version":"97","Description":"KKM Commutator Service","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_service_name":"kkm-commutator_service"}}},"container":{"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef","name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"json":{"logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","msg":"ReadyForSendingReceiptKeys selected ","method":"getReadyForSendingReceiptKeys","thread":"scheduling-1","X-B3-TraceId":"4f1a68d8f779e052","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000902849"}],"spanId":"4f1a68d8f779e052","X-Span-Export":"true","ts":"2020-07-30T08:21:18.586+00:00","level":"INFO","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","caller_line_number":84,"traceId":"4f1a68d8f779e052","X-B3-SpanId":"4f1a68d8f779e052","spanExportable":"true"},"log":{"offset":4980688,"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-30T08:21:18.586+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"4f1a68d8f779e052\",\"spanId\":\"4f1a68d8f779e052\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"4f1a68d8f779e052\",\"X-B3-TraceId\":\"4f1a68d8f779e052\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000902849\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"}}}]}}
243267 [main] INFO  kkm.UnitTests - End test

243271 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_NOFILIAL()
243433 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-u0ChrTU1JvRt', '1894294027', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-u0ChrTU1JvRt','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-u0ChrTU1JvRt', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-u0ChrTU1JvRt', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-u0ChrTU1JvRt'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-u0ChrTU1JvRt'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-u0ChrTU1JvRt'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-u0ChrTU1JvRt'
354474 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-u0ChrTU1JvRt'
354474 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-u0ChrTU1JvRt, null]
354479 [main] INFO  kkm.UnitTests - Status: null
354480 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
354481 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
374485 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.30/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
376600 [main] INFO  kkm.UnitTests - Response message : {"took":2060,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":502,"relation":"eq"},"max_score":5.968703,"hits":[{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"-YNFnnMBtD96ebe8RfZw","_score":5.968703,"_source":{"@timestamp":"2020-07-30T05:50:08.810Z","stream":"stdout","message":"{\"ts\":\"2020-07-30T05:50:08.809+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"8f8311ec5559ea77e6daba926d0d1c30e6b9fb8c8653ceb44f3a3f5f7aaddd7c","name":"kkm-commutator_service.1.n9ys273zzmdvmamq40sjf2f97","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.n9ys273zzmdvmamq40sjf2f97","com_docker_swarm_task_id":"n9ys273zzmdvmamq40sjf2f97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_stack_namespace":"kkm-commutator","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Version":"97"}}},"host":{"name":"44fcff07405a"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"log":{"file":{"path":"/var/lib/docker/containers/8f8311ec5559ea77e6daba926d0d1c30e6b9fb8c8653ceb44f3a3f5f7aaddd7c/8f8311ec5559ea77e6daba926d0d1c30e6b9fb8c8653ceb44f3a3f5f7aaddd7c-json.log"},"offset":774711},"ecs":{"version":"1.0.1"},"json":{"ts":"2020-07-30T05:50:08.809+00:00","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_line_number":52,"msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_file_name":"DefaultRequestHandlerCombiner.java","thread":"main"},"input":{"type":"container"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"jIRHnnMBtD96ebe8dM1v","_score":5.968703,"_source":{"@timestamp":"2020-07-30T05:52:31.926Z","docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"t4b0xsbq83tzdcc3q9ln3mm78","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.t4b0xsbq83tzdcc3q9ln3mm78"}}},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"log":{"offset":774754,"file":{"path":"/var/lib/docker/containers/9617bb87277b2e4d9feb64464fc535ae846491c83e1f1e4b3b2313e0a4473367/9617bb87277b2e4d9feb64464fc535ae846491c83e1f1e4b3b2313e0a4473367-json.log"}},"message":"{\"ts\":\"2020-07-30T05:52:31.925+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.t4b0xsbq83tzdcc3q9ln3mm78","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"9617bb87277b2e4d9feb64464fc535ae846491c83e1f1e4b3b2313e0a4473367"},"stream":"stdout","json":{"method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main","ts":"2020-07-30T05:52:31.925+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"MoVJnnMBtD96ebe8rmB3","_score":5.968703,"_source":{"@timestamp":"2020-07-30T05:54:58.017Z","log":{"offset":774730,"file":{"path":"/var/lib/docker/containers/441f59a7f3607aa17bb5f46c8387c10d1733547b1f993aeba3a71dcac4b52634/441f59a7f3607aa17bb5f46c8387c10d1733547b1f993aeba3a71dcac4b52634-json.log"}},"message":"{\"ts\":\"2020-07-30T05:54:58.016+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"id":"441f59a7f3607aa17bb5f46c8387c10d1733547b1f993aeba3a71dcac4b52634","name":"kkm-commutator_service.1.f1eolmjsh468q009vcdsc2qbr","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"json":{"level":"DEBUG","method":"combine","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","caller_line_number":52,"thread":"main","ts":"2020-07-30T05:54:58.016+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_file_name":"DefaultRequestHandlerCombiner.java"},"stream":"stdout","docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Version":"97","com_docker_swarm_task_id":"f1eolmjsh468q009vcdsc2qbr","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.f1eolmjsh468q009vcdsc2qbr"}}},"host":{"name":"44fcff07405a"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"9IVQnnMBtD96ebe8ULno","_score":5.968703,"_source":{"@timestamp":"2020-07-30T06:02:12.605Z","message":"{\"ts\":\"2020-07-30T06:02:12.604+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","Description":"KKM Commutator Service"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"log":{"offset":774765,"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"}},"stream":"stdout","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef","name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug"},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"json":{"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","level":"DEBUG","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"ts":"2020-07-30T06:02:12.604+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"EoVOnnMBtD96ebe8GJj7","_score":5.968703,"_source":{"@timestamp":"2020-07-30T05:59:46.789Z","docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_task_name":"kkm-commutator_service.1.q3wqy1emlomghhu5gp09uixi0","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"q3wqy1emlomghhu5gp09uixi0","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-30T05:59:46.789+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"f676bfbe95d892652d1fd9fae184514914a5a02a8f43f1f6ee69cd45df099a0c","name":"kkm-commutator_service.1.q3wqy1emlomghhu5gp09uixi0"},"json":{"caller_file_name":"DefaultRequestHandlerCombiner.java","ts":"2020-07-30T05:59:46.789+00:00","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_line_number":52,"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"},"log":{"file":{"path":"/var/lib/docker/containers/f676bfbe95d892652d1fd9fae184514914a5a02a8f43f1f6ee69cd45df099a0c/f676bfbe95d892652d1fd9fae184514914a5a02a8f43f1f6ee69cd45df099a0c-json.log"},"offset":774741},"stream":"stdout"}}]}}
376765 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
376788 [main] INFO  kkm.UnitTests - End test

376789 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_UTC12_DONE()
376918 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NIAcuPAmi0DY', '0599848459', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NIAcuPAmi0DY','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NIAcuPAmi0DY', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NIAcuPAmi0DY', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-NIAcuPAmi0DY'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-NIAcuPAmi0DY'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-NIAcuPAmi0DY'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-NIAcuPAmi0DY'
487761 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-NIAcuPAmi0DY'
487762 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-NIAcuPAmi0DY, null]
487766 [main] INFO  kkm.UnitTests - Status: null
487766 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
487767 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
507770 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.30/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
507869 [main] INFO  kkm.UnitTests - Response message : {"took":45,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":504,"relation":"eq"},"max_score":5.966341,"hits":[{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"-YNFnnMBtD96ebe8RfZw","_score":5.966341,"_source":{"@timestamp":"2020-07-30T05:50:08.810Z","stream":"stdout","message":"{\"ts\":\"2020-07-30T05:50:08.809+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"8f8311ec5559ea77e6daba926d0d1c30e6b9fb8c8653ceb44f3a3f5f7aaddd7c","name":"kkm-commutator_service.1.n9ys273zzmdvmamq40sjf2f97","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.n9ys273zzmdvmamq40sjf2f97","com_docker_swarm_task_id":"n9ys273zzmdvmamq40sjf2f97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_stack_namespace":"kkm-commutator","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Version":"97"}}},"host":{"name":"44fcff07405a"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"log":{"file":{"path":"/var/lib/docker/containers/8f8311ec5559ea77e6daba926d0d1c30e6b9fb8c8653ceb44f3a3f5f7aaddd7c/8f8311ec5559ea77e6daba926d0d1c30e6b9fb8c8653ceb44f3a3f5f7aaddd7c-json.log"},"offset":774711},"ecs":{"version":"1.0.1"},"json":{"ts":"2020-07-30T05:50:08.809+00:00","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_line_number":52,"msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_file_name":"DefaultRequestHandlerCombiner.java","thread":"main"},"input":{"type":"container"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"jIRHnnMBtD96ebe8dM1v","_score":5.966341,"_source":{"@timestamp":"2020-07-30T05:52:31.926Z","docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"t4b0xsbq83tzdcc3q9ln3mm78","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.t4b0xsbq83tzdcc3q9ln3mm78"}}},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"log":{"offset":774754,"file":{"path":"/var/lib/docker/containers/9617bb87277b2e4d9feb64464fc535ae846491c83e1f1e4b3b2313e0a4473367/9617bb87277b2e4d9feb64464fc535ae846491c83e1f1e4b3b2313e0a4473367-json.log"}},"message":"{\"ts\":\"2020-07-30T05:52:31.925+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.t4b0xsbq83tzdcc3q9ln3mm78","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"9617bb87277b2e4d9feb64464fc535ae846491c83e1f1e4b3b2313e0a4473367"},"stream":"stdout","json":{"method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main","ts":"2020-07-30T05:52:31.925+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"MoVJnnMBtD96ebe8rmB3","_score":5.966341,"_source":{"@timestamp":"2020-07-30T05:54:58.017Z","log":{"offset":774730,"file":{"path":"/var/lib/docker/containers/441f59a7f3607aa17bb5f46c8387c10d1733547b1f993aeba3a71dcac4b52634/441f59a7f3607aa17bb5f46c8387c10d1733547b1f993aeba3a71dcac4b52634-json.log"}},"message":"{\"ts\":\"2020-07-30T05:54:58.016+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"id":"441f59a7f3607aa17bb5f46c8387c10d1733547b1f993aeba3a71dcac4b52634","name":"kkm-commutator_service.1.f1eolmjsh468q009vcdsc2qbr","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"json":{"level":"DEBUG","method":"combine","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","caller_line_number":52,"thread":"main","ts":"2020-07-30T05:54:58.016+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_file_name":"DefaultRequestHandlerCombiner.java"},"stream":"stdout","docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Version":"97","com_docker_swarm_task_id":"f1eolmjsh468q009vcdsc2qbr","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.f1eolmjsh468q009vcdsc2qbr"}}},"host":{"name":"44fcff07405a"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"9IVQnnMBtD96ebe8ULno","_score":5.966341,"_source":{"@timestamp":"2020-07-30T06:02:12.605Z","message":"{\"ts\":\"2020-07-30T06:02:12.604+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","Description":"KKM Commutator Service"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"log":{"offset":774765,"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"}},"stream":"stdout","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef","name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug"},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"json":{"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","level":"DEBUG","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"ts":"2020-07-30T06:02:12.604+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"EoVOnnMBtD96ebe8GJj7","_score":5.966341,"_source":{"@timestamp":"2020-07-30T05:59:46.789Z","docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_task_name":"kkm-commutator_service.1.q3wqy1emlomghhu5gp09uixi0","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"q3wqy1emlomghhu5gp09uixi0","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-30T05:59:46.789+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"f676bfbe95d892652d1fd9fae184514914a5a02a8f43f1f6ee69cd45df099a0c","name":"kkm-commutator_service.1.q3wqy1emlomghhu5gp09uixi0"},"json":{"caller_file_name":"DefaultRequestHandlerCombiner.java","ts":"2020-07-30T05:59:46.789+00:00","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_line_number":52,"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"},"log":{"file":{"path":"/var/lib/docker/containers/f676bfbe95d892652d1fd9fae184514914a5a02a8f43f1f6ee69cd45df099a0c/f676bfbe95d892652d1fd9fae184514914a5a02a8f43f1f6ee69cd45df099a0c-json.log"},"offset":774741},"stream":"stdout"}}]}}
508029 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
508051 [main] INFO  kkm.UnitTests - End test

508052 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_UTC2_FAIL()
508184 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UWTdI0JRYjPl', '0672706046', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UWTdI0JRYjPl','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UWTdI0JRYjPl', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UWTdI0JRYjPl', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-UWTdI0JRYjPl'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-UWTdI0JRYjPl'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-UWTdI0JRYjPl'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-UWTdI0JRYjPl'
619029 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-UWTdI0JRYjPl'
619030 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-UWTdI0JRYjPl, null]
619034 [main] INFO  kkm.UnitTests - Status: null
619034 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
619034 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
639038 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.30/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
639106 [main] INFO  kkm.UnitTests - Response message : {"took":5,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":507,"relation":"eq"},"max_score":5.9624743,"hits":[{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"-YNFnnMBtD96ebe8RfZw","_score":5.9624743,"_source":{"@timestamp":"2020-07-30T05:50:08.810Z","stream":"stdout","message":"{\"ts\":\"2020-07-30T05:50:08.809+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"8f8311ec5559ea77e6daba926d0d1c30e6b9fb8c8653ceb44f3a3f5f7aaddd7c","name":"kkm-commutator_service.1.n9ys273zzmdvmamq40sjf2f97","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.n9ys273zzmdvmamq40sjf2f97","com_docker_swarm_task_id":"n9ys273zzmdvmamq40sjf2f97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_stack_namespace":"kkm-commutator","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Version":"97"}}},"host":{"name":"44fcff07405a"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"log":{"file":{"path":"/var/lib/docker/containers/8f8311ec5559ea77e6daba926d0d1c30e6b9fb8c8653ceb44f3a3f5f7aaddd7c/8f8311ec5559ea77e6daba926d0d1c30e6b9fb8c8653ceb44f3a3f5f7aaddd7c-json.log"},"offset":774711},"ecs":{"version":"1.0.1"},"json":{"ts":"2020-07-30T05:50:08.809+00:00","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_line_number":52,"msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_file_name":"DefaultRequestHandlerCombiner.java","thread":"main"},"input":{"type":"container"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"jIRHnnMBtD96ebe8dM1v","_score":5.9624743,"_source":{"@timestamp":"2020-07-30T05:52:31.926Z","docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"t4b0xsbq83tzdcc3q9ln3mm78","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.t4b0xsbq83tzdcc3q9ln3mm78"}}},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"log":{"offset":774754,"file":{"path":"/var/lib/docker/containers/9617bb87277b2e4d9feb64464fc535ae846491c83e1f1e4b3b2313e0a4473367/9617bb87277b2e4d9feb64464fc535ae846491c83e1f1e4b3b2313e0a4473367-json.log"}},"message":"{\"ts\":\"2020-07-30T05:52:31.925+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.t4b0xsbq83tzdcc3q9ln3mm78","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"9617bb87277b2e4d9feb64464fc535ae846491c83e1f1e4b3b2313e0a4473367"},"stream":"stdout","json":{"method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main","ts":"2020-07-30T05:52:31.925+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"MoVJnnMBtD96ebe8rmB3","_score":5.9624743,"_source":{"@timestamp":"2020-07-30T05:54:58.017Z","log":{"offset":774730,"file":{"path":"/var/lib/docker/containers/441f59a7f3607aa17bb5f46c8387c10d1733547b1f993aeba3a71dcac4b52634/441f59a7f3607aa17bb5f46c8387c10d1733547b1f993aeba3a71dcac4b52634-json.log"}},"message":"{\"ts\":\"2020-07-30T05:54:58.016+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"id":"441f59a7f3607aa17bb5f46c8387c10d1733547b1f993aeba3a71dcac4b52634","name":"kkm-commutator_service.1.f1eolmjsh468q009vcdsc2qbr","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"json":{"level":"DEBUG","method":"combine","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","caller_line_number":52,"thread":"main","ts":"2020-07-30T05:54:58.016+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_file_name":"DefaultRequestHandlerCombiner.java"},"stream":"stdout","docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Version":"97","com_docker_swarm_task_id":"f1eolmjsh468q009vcdsc2qbr","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.f1eolmjsh468q009vcdsc2qbr"}}},"host":{"name":"44fcff07405a"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"9IVQnnMBtD96ebe8ULno","_score":5.9624743,"_source":{"@timestamp":"2020-07-30T06:02:12.605Z","message":"{\"ts\":\"2020-07-30T06:02:12.604+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","Description":"KKM Commutator Service"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"log":{"offset":774765,"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"}},"stream":"stdout","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef","name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug"},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"json":{"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","level":"DEBUG","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"ts":"2020-07-30T06:02:12.604+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner"}}},{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"EoVOnnMBtD96ebe8GJj7","_score":5.9624743,"_source":{"@timestamp":"2020-07-30T05:59:46.789Z","docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_task_name":"kkm-commutator_service.1.q3wqy1emlomghhu5gp09uixi0","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"q3wqy1emlomghhu5gp09uixi0","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-30T05:59:46.789+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"f676bfbe95d892652d1fd9fae184514914a5a02a8f43f1f6ee69cd45df099a0c","name":"kkm-commutator_service.1.q3wqy1emlomghhu5gp09uixi0"},"json":{"caller_file_name":"DefaultRequestHandlerCombiner.java","ts":"2020-07-30T05:59:46.789+00:00","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_line_number":52,"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"},"log":{"file":{"path":"/var/lib/docker/containers/f676bfbe95d892652d1fd9fae184514914a5a02a8f43f1f6ee69cd45df099a0c/f676bfbe95d892652d1fd9fae184514914a5a02a8f43f1f6ee69cd45df099a0c-json.log"},"offset":774741},"stream":"stdout"}}]}}
639277 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
639299 [main] INFO  kkm.UnitTests - End test

639300 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_UTC12_DONE()
639434 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ngyYeS1JOCZS', '8759748402', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ngyYeS1JOCZS','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ngyYeS1JOCZS', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ngyYeS1JOCZS', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-ngyYeS1JOCZS'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-ngyYeS1JOCZS'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-ngyYeS1JOCZS'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-ngyYeS1JOCZS'
750549 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-ngyYeS1JOCZS'
750549 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-ngyYeS1JOCZS, 1861a83a-b150-4b6f-bf23-709c7fa04ed2]
750553 [main] INFO  kkm.UnitTests - Status: DONE
750553 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
750553 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
750776 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-test01:8181/cxf/rest/api/v1/kkm/receipts/1861a83a-b150-4b6f-bf23-709c7fa04ed2
750776 [main] INFO  kkm.UnitTests - Response Code : 200
750783 [main] INFO  kkm.UnitTests - [DONE]
770787 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.30/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-ngyYeS1JOCZS%22%20&size=500
770853 [main] INFO  kkm.UnitTests - Response message : {"took":12,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":25.486008,"hits":[{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"j5zXnnMBtD96ebe88IfY","_score":25.486008,"_source":{"@timestamp":"2020-07-30T08:30:19.220Z","json":{"msg":"ReadyForSendingReceiptKeys selected ","level":"INFO","caller_file_name":"KkmCommutatorService.java","traceId":"36c6befb9b79c0cb","X-VSK-ReceiptKeys":[{"srcID":"9SD0C9DZ-9289-4A09-ngyYeS1JOCZS","systemCode":"ADINSURE","entityCode":"Payment"},{"systemCode":"ADINSURE","entityCode":"Payment","srcID":"9SD0C9DZ-9289-4A09-NIAcuPAmi0DY"}],"class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","spanExportable":"true","method":"getReadyForSendingReceiptKeys","caller_line_number":84,"X-B3-SpanId":"36c6befb9b79c0cb","X-B3-TraceId":"36c6befb9b79c0cb","ts":"2020-07-30T08:30:19.220+00:00","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","spanId":"36c6befb9b79c0cb","X-Span-Export":"true"},"stream":"stdout","message":"{\"ts\":\"2020-07-30T08:30:19.220+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"36c6befb9b79c0cb\",\"spanId\":\"36c6befb9b79c0cb\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"36c6befb9b79c0cb\",\"X-B3-TraceId\":\"36c6befb9b79c0cb\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-ngyYeS1JOCZS\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-NIAcuPAmi0DY\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"container":{"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef","name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"log":{"offset":5201192,"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"}}}]}}
771048 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
771070 [main] INFO  kkm.UnitTests - End test

771071 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_NOFILIAL()
771199 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-rA2ArIzdSLAd', '2292318517', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-rA2ArIzdSLAd','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-rA2ArIzdSLAd', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-rA2ArIzdSLAd', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-rA2ArIzdSLAd'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-rA2ArIzdSLAd'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-rA2ArIzdSLAd'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-rA2ArIzdSLAd'
882759 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-rA2ArIzdSLAd'
882759 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-rA2ArIzdSLAd, 0453e211-e87a-487f-8fa2-8446a65f46f4]
882763 [main] INFO  kkm.UnitTests - Status: DONE
882763 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
882764 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
882926 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-test01:8181/cxf/rest/api/v1/kkm/receipts/0453e211-e87a-487f-8fa2-8446a65f46f4
882926 [main] INFO  kkm.UnitTests - Response Code : 200
882927 [main] INFO  kkm.UnitTests - [DONE]
902931 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.30/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-rA2ArIzdSLAd%22%20&size=500
903030 [main] INFO  kkm.UnitTests - Response message : {"took":13,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.368958,"hits":[{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"QZ3annMBtD96ebe8qElE","_score":27.368958,"_source":{"@timestamp":"2020-07-30T08:33:18.341Z","host":{"name":"44fcff07405a"},"container":{"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef","name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"stream":"stdout","message":"{\"ts\":\"2020-07-30T08:33:18.340+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"1d37497339343c4f\",\"spanId\":\"1d37497339343c4f\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"1d37497339343c4f\",\"X-B3-TraceId\":\"1d37497339343c4f\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-rA2ArIzdSLAd\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","Version":"97","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"},"agent":{"id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a"},"json":{"class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","thread":"scheduling-1","traceId":"1d37497339343c4f","X-Span-Export":"true","X-B3-SpanId":"1d37497339343c4f","X-B3-TraceId":"1d37497339343c4f","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","caller_line_number":84,"ts":"2020-07-30T08:33:18.340+00:00","spanExportable":"true","level":"INFO","X-VSK-ReceiptKeys":[{"srcID":"9SD0C9DZ-9289-4A09-rA2ArIzdSLAd","systemCode":"ADINSURE","entityCode":"Payment"}],"msg":"ReadyForSendingReceiptKeys selected ","spanId":"1d37497339343c4f"},"log":{"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"},"offset":5359600}}}]}}
903212 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
903235 [main] INFO  kkm.UnitTests - End test

903237 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_UTC2_FAIL()
903390 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-6q4GRdGdrkLM', '3946360831', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-6q4GRdGdrkLM','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-6q4GRdGdrkLM', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-6q4GRdGdrkLM', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-6q4GRdGdrkLM'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-6q4GRdGdrkLM'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-6q4GRdGdrkLM'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-6q4GRdGdrkLM'
1014317 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-6q4GRdGdrkLM'
1014318 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-6q4GRdGdrkLM, d3392942-c06c-4f6b-8e7e-f4d00ac2ea3e]
1014322 [main] INFO  kkm.UnitTests - Status: FAIL
1014322 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
1014322 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
1014801 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-test01:8181/cxf/rest/api/v1/kkm/receipts/d3392942-c06c-4f6b-8e7e-f4d00ac2ea3e
1014801 [main] INFO  kkm.UnitTests - Response Code : 200
1014804 [main] INFO  kkm.UnitTests - [FAIL]
1034806 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.30/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-6q4GRdGdrkLM%22%20&size=500
1034869 [main] INFO  kkm.UnitTests - Response message : {"took":13,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":25.776524,"hits":[{"_index":"kkm-commutator-test-2020.07.30","_type":"_doc","_id":"yp3cnnMBtD96ebe8gfgc","_score":25.776524,"_source":{"@timestamp":"2020-07-30T08:35:18.830Z","message":"{\"ts\":\"2020-07-30T08:35:18.830+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"820942b24b84363e\",\"spanId\":\"820942b24b84363e\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"820942b24b84363e\",\"X-B3-TraceId\":\"820942b24b84363e\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-UWTdI0JRYjPl\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-6q4GRdGdrkLM\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","log":{"offset":5440351,"file":{"path":"/var/lib/docker/containers/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef/ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef-json.log"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"host":{"name":"44fcff07405a"},"json":{"X-Span-Export":"true","caller_file_name":"KkmCommutatorService.java","thread":"scheduling-1","traceId":"820942b24b84363e","spanExportable":"true","msg":"ReadyForSendingReceiptKeys selected ","ts":"2020-07-30T08:35:18.830+00:00","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","X-B3-TraceId":"820942b24b84363e","X-VSK-ReceiptKeys":[{"systemCode":"ADINSURE","entityCode":"Payment","srcID":"9SD0C9DZ-9289-4A09-UWTdI0JRYjPl"},{"srcID":"9SD0C9DZ-9289-4A09-6q4GRdGdrkLM","systemCode":"ADINSURE","entityCode":"Payment"}],"level":"INFO","caller_line_number":84,"spanId":"820942b24b84363e","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","X-B3-SpanId":"820942b24b84363e"},"stream":"stdout","input":{"type":"container"},"container":{"id":"ad9da470c2b07254f20135e9279ddffabc9c3739778f2696f1c4f77f6aa08fef","name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.5635tye7o8epif90n69lskwug","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"5635tye7o8epif90n69lskwug","Version":"97","Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9"}}},"ecs":{"version":"1.0.1"}}}]}}
1035015 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1035040 [main] INFO  kkm.UnitTests - End test

