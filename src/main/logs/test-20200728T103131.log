191  [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckNoCashier()
3275 [main] INFO  kkm.UnitTests - End test

3283 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageEmail()
275421 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.28/_search?q=%20message:%20%22CID=330eed74-d7f0-407d-851a-deca4741169311%22%20
275643 [main] INFO  kkm.UnitTests - Response message : {"took":124,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":57.820656,"hits":[{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"bWwflHMBfrYj4vM9YugN","_score":57.820656,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":667190,"@timestamp":"2020-07-28T06:32:04.905Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-28T09:32:04,905","thread":"qtp529223075-377694","message":"KkmService: REST response Operation 'SendMessage' was complete with body: ReceiptResponse{correlationId='null', checkId='421d37d9-6f95-4073-9f3b-2edc0e72dd58', error=null} | exid=ID-esb-stage-37060-1595563687826-91-26232 CID=330eed74-d7f0-407d-851a-deca4741169311","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"PGwflHMBfrYj4vM9J9W3","_score":57.60818,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":662799,"beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"@timestamp":"2020-07-28T06:32:04.877Z","timestamp":"2020-07-28T09:32:04,877","thread":"qtp529223075-377694","message":"KkmService: REST request  Operation 'SendMessage' was call with body: SendMessageRequest{checkId='421d37d9-6f95-4073-9f3b-2edc0e72dd58', messageType='email', messageAddress='EPolikarpova@VSK.RU'} | exid=ID-esb-stage-37060-1595563687826-91-26232 CID=330eed74-d7f0-407d-851a-deca4741169311","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"cmwflHMBfrYj4vM9J9W9","_score":55.370026,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":662321,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-28T06:32:04.877Z","timestamp":"2020-07-28T09:32:04,877","thread":"qtp529223075-377694","message":"KkmService: REST request  Operation 'SendMessage' was call with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-26231, JMSCorrelationID=330eed74-d7f0-407d-851a-deca4741169311, operationName=SendMessage, X-VSK-CorrelationId=330eed74-d7f0-407d-851a-deca4741169311} | exid=ID-esb-stage-37060-1595563687826-91-26232 CID=330eed74-d7f0-407d-851a-deca4741169311","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"BmwflHMBfrYj4vM9J9VZ","_score":52.060303,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":663839,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-28T06:32:04.878Z","timestamp":"2020-07-28T09:32:04,878","thread":"thread #5110 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-26231, CamelHttpMethod=GET, JMSCorrelationID=330eed74-d7f0-407d-851a-deca4741169311, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/421d37d9-6f95-4073-9f3b-2edc0e72dd58/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=330eed74-d7f0-407d-851a-deca4741169311} | exId=ID-esb-stage-37060-1595563687826-91-26234 CID=330eed74-d7f0-407d-851a-deca4741169311 |\n ","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"hGwflHMBfrYj4vM9J9Xz","_score":52.060303,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":663199,"@timestamp":"2020-07-28T06:32:04.878Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-28T09:32:04,878","thread":"thread #5110 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-26231, CamelHttpMethod=GET, JMSCorrelationID=330eed74-d7f0-407d-851a-deca4741169311, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/421d37d9-6f95-4073-9f3b-2edc0e72dd58/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=330eed74-d7f0-407d-851a-deca4741169311} | exId=ID-esb-stage-37060-1595563687826-91-26234 CID=330eed74-d7f0-407d-851a-deca4741169311","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"GWwflHMBfrYj4vM9J9Vh","_score":47.059475,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":664483,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-28T06:32:04.905Z","timestamp":"2020-07-28T09:32:04,905","thread":"thread #5110 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-26231, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 06:32:06 GMT, JMSCorrelationID=330eed74-d7f0-407d-851a-deca4741169311, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/421d37d9-6f95-4073-9f3b-2edc0e72dd58/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=330eed74-d7f0-407d-851a-deca4741169311} | exid=ID-esb-stage-37060-1595563687826-91-26234 CID=330eed74-d7f0-407d-851a-deca4741169311","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"KmwflHMBfrYj4vM9J9WC","_score":47.059475,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":666293,"beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"@timestamp":"2020-07-28T06:32:04.905Z","timestamp":"2020-07-28T09:32:04,905","thread":"qtp529223075-377694","message":"KkmService: REST response Operation 'SendMessage' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-26231, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 06:32:06 GMT, JMSCorrelationID=330eed74-d7f0-407d-851a-deca4741169311, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/421d37d9-6f95-4073-9f3b-2edc0e72dd58/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=330eed74-d7f0-407d-851a-deca4741169311} | exid=ID-esb-stage-37060-1595563687826-91-26232 CID=330eed74-d7f0-407d-851a-deca4741169311","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"KWwflHMBfrYj4vM9J9WC","_score":45.955864,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":665361,"@timestamp":"2020-07-28T06:32:04.905Z","beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"timestamp":"2020-07-28T09:32:04,905","thread":"thread #5110 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-26231, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 06:32:06 GMT, JMSCorrelationID=330eed74-d7f0-407d-851a-deca4741169311, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/421d37d9-6f95-4073-9f3b-2edc0e72dd58/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=330eed74-d7f0-407d-851a-deca4741169311} | exid=ID-esb-stage-37060-1595563687826-91-26234 CID=330eed74-d7f0-407d-851a-deca4741169311 |\n {\"checkId\":\"421d37d9-6f95-4073-9f3b-2edc0e72dd58\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
275645 [main] INFO  kkm.UnitTests - End test

275649 [main] INFO  kkm.UnitTests - Starting test: KKM_WAcheckStatus()
275930 [main] INFO  kkm.UnitTests - End test

275945 [main] INFO  kkm.UnitTests - Starting test: KKM_getStatus()
278589 [main] INFO  kkm.UnitTests - End test

278593 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceledAlredy()
300374 [main] INFO  kkm.UnitTests - End test

300378 [main] INFO  kkm.UnitTests - Starting test: KKM_getDocCustomer()
300551 [main] INFO  kkm.UnitTests - End test

300552 [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckCashier()
307065 [main] INFO  kkm.UnitTests - End test

307068 [main] INFO  kkm.UnitTests - Starting test: KKM_DB1()
307649 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
307655 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
307658 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
308059 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000901797'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000901797'
select * from ProcessStatus where srcID = 'ЖПлато_000901797'
308061 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
308065 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
369060 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000901797'
369061 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000901797]
429077 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000901797%22%20&size=500
432162 [main] INFO  kkm.UnitTests - Response message : {"took":7,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":2,"relation":"eq"},"max_score":11.582191,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"hFLbk3MBfrYj4vM9YCn9","_score":11.582191,"_source":{"@timestamp":"2020-07-28T05:18:09.050Z","stream":"stdout","message":"{\"ts\":\"2020-07-28T05:18:09.049+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"7bcb15b021cd67bc\",\"spanId\":\"7bcb15b021cd67bc\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7bcb15b021cd67bc\",\"X-B3-TraceId\":\"7bcb15b021cd67bc\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":2015445,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"input":{"type":"container"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"t28jlHMBfrYj4vM9swcX","_score":11.582191,"_source":{"@timestamp":"2020-07-28T06:37:09.214Z","message":"{\"ts\":\"2020-07-28T06:37:09.214+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"2152612f8d177669\",\"spanId\":\"2152612f8d177669\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"2152612f8d177669\",\"X-B3-TraceId\":\"2152612f8d177669\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":5422783,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"}}}]}}
432165 [main] INFO  kkm.UnitTests - End test

432168 [main] INFO  kkm.UnitTests - Starting test: KKM_DB2()
432328 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
432328 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
432329 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
432810 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
432810 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
432812 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
493055 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
493055 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, nothing, ЖПлато_000898541]
553064 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
553128 [main] INFO  kkm.UnitTests - Response message : {"took":7,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":2,"relation":"eq"},"max_score":10.779156,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"R1Pdk3MBfrYj4vM9NSHJ","_score":10.779156,"_source":{"@timestamp":"2020-07-28T05:20:09.216Z","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"log":{"offset":2117860,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-28T05:20:09.216+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"0592b363c004e718\",\"spanId\":\"0592b363c004e718\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"0592b363c004e718\",\"X-B3-TraceId\":\"0592b363c004e718\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"stream":"stdout","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"OHAllHMBfrYj4vM9iy7N","_score":10.779156,"_source":{"@timestamp":"2020-07-28T06:39:09.143Z","stream":"stdout","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-28T06:39:09.143+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"8b37c3c936fd3da1\",\"spanId\":\"8b37c3c936fd3da1\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8b37c3c936fd3da1\",\"X-B3-TraceId\":\"8b37c3c936fd3da1\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","log":{"offset":5525195,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"}}}]}}
553130 [main] INFO  kkm.UnitTests - End test

553133 [main] INFO  kkm.UnitTests - Starting test: KKM_DB3()
553263 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-YxYLT56ppZgX', '6534952191', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-YxYLT56ppZgX','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-YxYLT56ppZgX', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-YxYLT56ppZgX', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-YxYLT56ppZgX'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-YxYLT56ppZgX'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-YxYLT56ppZgX'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-YxYLT56ppZgX'
663950 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-YxYLT56ppZgX'
663951 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-YxYLT56ppZgX, c35d6ebb-cff9-4d84-9014-72f0cf3f9e0f]
663953 [main] INFO  kkm.UnitTests - Status: DONE
663953 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
663953 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
684078 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-YxYLT56ppZgX%22%20&size=500
684144 [main] INFO  kkm.UnitTests - Response message : {"took":5,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":28.67881,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"5HEnlHMBfrYj4vM9XE-0","_score":28.67881,"_source":{"@timestamp":"2020-07-28T06:41:09.030Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece"},"log":{"offset":5635198,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-28T06:41:09.030+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"70ad68aa53738216\",\"spanId\":\"70ad68aa53738216\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"70ad68aa53738216\",\"X-B3-TraceId\":\"70ad68aa53738216\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-6WpSzagjp4Oi\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-YxYLT56ppZgX\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"}}}]}}
684273 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
684302 [main] INFO  kkm.UnitTests - End test

684305 [main] INFO  kkm.UnitTests - Starting test: KKM_DB4()
684433 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-HWJvSGr4EvsY', '7327471906', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-HWJvSGr4EvsY','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-HWJvSGr4EvsY', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-HWJvSGr4EvsY', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-HWJvSGr4EvsY'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-HWJvSGr4EvsY'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-HWJvSGr4EvsY'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-HWJvSGr4EvsY'
795456 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-HWJvSGr4EvsY'
795457 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-HWJvSGr4EvsY, c0e5795c-f88d-48c8-bffc-d125da575048]
795461 [main] INFO  kkm.UnitTests - Status: FAIL
795461 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
795462 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
815896 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-HWJvSGr4EvsY%22%20&size=500
815983 [main] INFO  kkm.UnitTests - Response message : {"took":10,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.960484,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"KnIplHMBfrYj4vM9MYSE","_score":27.960484,"_source":{"@timestamp":"2020-07-28T06:43:09.096Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-28T06:43:09.095+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"a996d7cc8001e0ae\",\"spanId\":\"a996d7cc8001e0ae\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a996d7cc8001e0ae\",\"X-B3-TraceId\":\"a996d7cc8001e0ae\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-HWJvSGr4EvsY\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-KVLguKnHbPCR\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":5772370},"stream":"stdout"}}]}}
816104 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
816128 [main] INFO  kkm.UnitTests - End test

816129 [main] INFO  kkm.UnitTests - Starting test: KKM_DB5()
816253 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NZtVWA6wtZK9', '6961798565', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NZtVWA6wtZK9','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NZtVWA6wtZK9', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NZtVWA6wtZK9', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-NZtVWA6wtZK9'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-NZtVWA6wtZK9'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-NZtVWA6wtZK9'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-NZtVWA6wtZK9'
927118 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-NZtVWA6wtZK9'
927118 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-NZtVWA6wtZK9, 3304b524-5604-47f2-bf24-a4c22dcf994b]
927120 [main] INFO  kkm.UnitTests - Status: DONE
927120 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
927120 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
947212 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-NZtVWA6wtZK9%22%20&size=500
947269 [main] INFO  kkm.UnitTests - Response message : {"took":5,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.41967,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"M3MrlHMBfrYj4vM9BjJS","_score":27.41967,"_source":{"@timestamp":"2020-07-28T06:45:09.469Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-28T06:45:09.469+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"4b4782a539afaa58\",\"spanId\":\"4b4782a539afaa58\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"4b4782a539afaa58\",\"X-B3-TraceId\":\"4b4782a539afaa58\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-aMoairxNSNnY\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-NZtVWA6wtZK9\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","log":{"offset":5916852,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"input":{"type":"container"}}}]}}
947389 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
947412 [main] INFO  kkm.UnitTests - End test

947413 [main] INFO  kkm.UnitTests - Starting test: KKM_DB6()
947528 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-LXp7ISaBx4qW', '0844952577', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-LXp7ISaBx4qW','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-LXp7ISaBx4qW', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-LXp7ISaBx4qW', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-LXp7ISaBx4qW'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-LXp7ISaBx4qW'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-LXp7ISaBx4qW'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-LXp7ISaBx4qW'
1058658 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-LXp7ISaBx4qW'
1058658 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-LXp7ISaBx4qW, null]
1058660 [main] INFO  kkm.UnitTests - Status: null
1058661 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1058661 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1078668 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1078729 [main] INFO  kkm.UnitTests - Response message : {"took":7,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":819,"relation":"eq"},"max_score":3.5565677,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"KhG4knMBfrYj4vM9TT2U","_score":3.5565677,"_source":{"@timestamp":"2020-07-28T00:00:09.144Z","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":39011095},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:09.144+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3aeb83866d1badae\",\"spanId\":\"3aeb83866d1badae\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3aeb83866d1badae\",\"X-B3-TraceId\":\"3aeb83866d1badae\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"jRG4knMBfrYj4vM9x03M","_score":3.5565677,"_source":{"@timestamp":"2020-07-28T00:00:31.145Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:31.145+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"80a3bdd764703cc3\",\"spanId\":\"80a3bdd764703cc3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"80a3bdd764703cc3\",\"X-B3-TraceId\":\"80a3bdd764703cc3\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"log":{"offset":39024011,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"IBK_knMBfrYj4vM9j47e","_score":3.5565677,"_source":{"@timestamp":"2020-07-28T00:08:09.103Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":39344355,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:08:09.102+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"928d0efe630ecd07\",\"spanId\":\"928d0efe630ecd07\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"928d0efe630ecd07\",\"X-B3-TraceId\":\"928d0efe630ecd07\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"host":{"name":"25805977eece"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"3BK_knMBfrYj4vM9-Z5Z","_score":3.5565677,"_source":{"@timestamp":"2020-07-28T00:08:31.153Z","docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-28T00:08:31.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"39574cafbebc9ac8\",\"spanId\":\"39574cafbebc9ac8\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"39574cafbebc9ac8\",\"X-B3-TraceId\":\"39574cafbebc9ac8\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":39357273},"input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"iRG7knMBfrYj4vM95phE","_score":3.5565677,"_source":{"@timestamp":"2020-07-28T00:04:09.038Z","docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:04:09.038+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"4f0cc081a3a46b86\",\"spanId\":\"4f0cc081a3a46b86\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"4f0cc081a3a46b86\",\"X-B3-TraceId\":\"4f0cc081a3a46b86\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":39181270,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}}}}]}}
1078853 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
1078878 [main] INFO  kkm.UnitTests - End test

1078879 [main] INFO  kkm.UnitTests - Starting test: KKM_DB7()
1078998 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-kt7UhTDCLJcf', '4758097259', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-kt7UhTDCLJcf','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-kt7UhTDCLJcf', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-kt7UhTDCLJcf', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-kt7UhTDCLJcf'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-kt7UhTDCLJcf'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-kt7UhTDCLJcf'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-kt7UhTDCLJcf'
1190011 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-kt7UhTDCLJcf'
1190011 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-kt7UhTDCLJcf, null]
1190013 [main] INFO  kkm.UnitTests - Status: null
1190013 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1190013 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1210014 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1210067 [main] INFO  kkm.UnitTests - Response message : {"took":2,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":823,"relation":"eq"},"max_score":3.5563834,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"KhG4knMBfrYj4vM9TT2U","_score":3.5563834,"_source":{"@timestamp":"2020-07-28T00:00:09.144Z","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":39011095},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:09.144+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3aeb83866d1badae\",\"spanId\":\"3aeb83866d1badae\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3aeb83866d1badae\",\"X-B3-TraceId\":\"3aeb83866d1badae\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"jRG4knMBfrYj4vM9x03M","_score":3.5563834,"_source":{"@timestamp":"2020-07-28T00:00:31.145Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:31.145+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"80a3bdd764703cc3\",\"spanId\":\"80a3bdd764703cc3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"80a3bdd764703cc3\",\"X-B3-TraceId\":\"80a3bdd764703cc3\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"log":{"offset":39024011,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"IBK_knMBfrYj4vM9j47e","_score":3.5563834,"_source":{"@timestamp":"2020-07-28T00:08:09.103Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":39344355,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:08:09.102+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"928d0efe630ecd07\",\"spanId\":\"928d0efe630ecd07\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"928d0efe630ecd07\",\"X-B3-TraceId\":\"928d0efe630ecd07\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"host":{"name":"25805977eece"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"3BK_knMBfrYj4vM9-Z5Z","_score":3.5563834,"_source":{"@timestamp":"2020-07-28T00:08:31.153Z","docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-28T00:08:31.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"39574cafbebc9ac8\",\"spanId\":\"39574cafbebc9ac8\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"39574cafbebc9ac8\",\"X-B3-TraceId\":\"39574cafbebc9ac8\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":39357273},"input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"iRG7knMBfrYj4vM95phE","_score":3.5563834,"_source":{"@timestamp":"2020-07-28T00:04:09.038Z","docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:04:09.038+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"4f0cc081a3a46b86\",\"spanId\":\"4f0cc081a3a46b86\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"4f0cc081a3a46b86\",\"X-B3-TraceId\":\"4f0cc081a3a46b86\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":39181270,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}}}}]}}
1210191 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1210214 [main] INFO  kkm.UnitTests - End test

1210215 [main] INFO  kkm.UnitTests - Starting test: KKM_DB8()
1210336 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jTdE5ET2J6SY', '4549188846', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jTdE5ET2J6SY','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jTdE5ET2J6SY', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jTdE5ET2J6SY', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-jTdE5ET2J6SY'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-jTdE5ET2J6SY'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-jTdE5ET2J6SY'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-jTdE5ET2J6SY'
1321312 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-jTdE5ET2J6SY'
1321313 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-jTdE5ET2J6SY, null]
1321314 [main] INFO  kkm.UnitTests - Status: null
1321314 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1321314 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1341319 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1341375 [main] INFO  kkm.UnitTests - Response message : {"took":2,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":827,"relation":"eq"},"max_score":3.5562007,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"KhG4knMBfrYj4vM9TT2U","_score":3.5562007,"_source":{"@timestamp":"2020-07-28T00:00:09.144Z","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":39011095},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:09.144+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3aeb83866d1badae\",\"spanId\":\"3aeb83866d1badae\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3aeb83866d1badae\",\"X-B3-TraceId\":\"3aeb83866d1badae\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"jRG4knMBfrYj4vM9x03M","_score":3.5562007,"_source":{"@timestamp":"2020-07-28T00:00:31.145Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:31.145+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"80a3bdd764703cc3\",\"spanId\":\"80a3bdd764703cc3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"80a3bdd764703cc3\",\"X-B3-TraceId\":\"80a3bdd764703cc3\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"log":{"offset":39024011,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"IBK_knMBfrYj4vM9j47e","_score":3.5562007,"_source":{"@timestamp":"2020-07-28T00:08:09.103Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":39344355,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:08:09.102+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"928d0efe630ecd07\",\"spanId\":\"928d0efe630ecd07\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"928d0efe630ecd07\",\"X-B3-TraceId\":\"928d0efe630ecd07\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"host":{"name":"25805977eece"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"3BK_knMBfrYj4vM9-Z5Z","_score":3.5562007,"_source":{"@timestamp":"2020-07-28T00:08:31.153Z","docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-28T00:08:31.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"39574cafbebc9ac8\",\"spanId\":\"39574cafbebc9ac8\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"39574cafbebc9ac8\",\"X-B3-TraceId\":\"39574cafbebc9ac8\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":39357273},"input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"iRG7knMBfrYj4vM95phE","_score":3.5562007,"_source":{"@timestamp":"2020-07-28T00:04:09.038Z","docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:04:09.038+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"4f0cc081a3a46b86\",\"spanId\":\"4f0cc081a3a46b86\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"4f0cc081a3a46b86\",\"X-B3-TraceId\":\"4f0cc081a3a46b86\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":39181270,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}}}}]}}
1341496 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
1341518 [main] INFO  kkm.UnitTests - End test

1341520 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageWasCanceled()
1349526 [main] INFO  kkm.UnitTests - End test

1349528 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceleNotFound()
1349558 [main] INFO  kkm.UnitTests - End test

1349560 [main] INFO  kkm.UnitTests - Starting test: KKM_makeAndCancelCheckCashier()
1593297 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.28/_search?q=%20message:%20%22CID=bd355934-1770-4e5d-97e9-61ef0fd862752%22%20
1593416 [main] INFO  kkm.UnitTests - Response message : {"took":65,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":55.514004,"hits":[{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"UHYzlHMBfrYj4vM9Z0ks","_score":55.514004,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":5824073,"@timestamp":"2020-07-28T06:54:02.737Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-28T09:54:02,737","thread":"qtp529223075-384377","message":"KkmService: REST request  Operation 'CancelReceipt' was call with body: ab426313-1be8-4b6f-bad3-ad3b202d4855 | exid=ID-esb-stage-37060-1595563687826-91-29222 CID=bd355934-1770-4e5d-97e9-61ef0fd862752","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"ZHYzlHMBfrYj4vM9nl4-","_score":53.060825,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":5828205,"@timestamp":"2020-07-28T06:54:02.785Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-28T09:54:02,785","thread":"qtp529223075-384377","message":"KkmService: REST response Operation 'CancelReceipt' was complete with body: CancelReceiptResponse{correlationId='null', checkId='ab426313-1be8-4b6f-bad3-ad3b202d4855', canceledCheckId='b88ff96b-3df8-4043-b71f-436b1a0875f4', error=null} | exid=ID-esb-stage-37060-1595563687826-91-29222 CID=bd355934-1770-4e5d-97e9-61ef0fd862752","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"T3YzlHMBfrYj4vM9Z0ks","_score":51.913784,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":5823594,"@timestamp":"2020-07-28T06:54:02.737Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-28T09:54:02,737","thread":"qtp529223075-384377","message":"KkmService: REST request  Operation 'CancelReceipt' was call with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-29221, JMSCorrelationID=bd355934-1770-4e5d-97e9-61ef0fd862752, operationName=CancelReceipt, X-VSK-CorrelationId=bd355934-1770-4e5d-97e9-61ef0fd862752} | exid=ID-esb-stage-37060-1595563687826-91-29222 CID=bd355934-1770-4e5d-97e9-61ef0fd862752","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"UXYzlHMBfrYj4vM9Z0ks","_score":49.42095,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":5824385,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-28T06:54:02.737Z","timestamp":"2020-07-28T09:54:02,737","thread":"thread #5154 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-29221, CamelHttpMethod=PUT, JMSCorrelationID=bd355934-1770-4e5d-97e9-61ef0fd862752, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/ab426313-1be8-4b6f-bad3-ad3b202d4855/cancel, X-VSK-CorrelationId=bd355934-1770-4e5d-97e9-61ef0fd862752} | exId=ID-esb-stage-37060-1595563687826-91-29224 CID=bd355934-1770-4e5d-97e9-61ef0fd862752","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"UnYzlHMBfrYj4vM9Z0ks","_score":48.101093,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":5824998,"@timestamp":"2020-07-28T06:54:02.737Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-28T09:54:02,737","thread":"thread #5154 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-29221, CamelHttpMethod=PUT, JMSCorrelationID=bd355934-1770-4e5d-97e9-61ef0fd862752, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/ab426313-1be8-4b6f-bad3-ad3b202d4855/cancel, X-VSK-CorrelationId=bd355934-1770-4e5d-97e9-61ef0fd862752} | exId=ID-esb-stage-37060-1595563687826-91-29224 CID=bd355934-1770-4e5d-97e9-61ef0fd862752 |\n ab426313-1be8-4b6f-bad3-ad3b202d4855","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"U3YzlHMBfrYj4vM9Z0ks","_score":45.090572,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":5825651,"@timestamp":"2020-07-28T06:54:02.784Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-28T09:54:02,784","thread":"thread #5154 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-29221, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 06:54:03 GMT, JMSCorrelationID=bd355934-1770-4e5d-97e9-61ef0fd862752, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/ab426313-1be8-4b6f-bad3-ad3b202d4855/cancel, X-VSK-CorrelationId=bd355934-1770-4e5d-97e9-61ef0fd862752} | exid=ID-esb-stage-37060-1595563687826-91-29224 CID=bd355934-1770-4e5d-97e9-61ef0fd862752","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"VXYzlHMBfrYj4vM9Z0ks","_score":45.090572,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":5827378,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-28T06:54:02.785Z","timestamp":"2020-07-28T09:54:02,785","thread":"qtp529223075-384377","message":"KkmService: REST response Operation 'CancelReceipt' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-29221, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 06:54:03 GMT, JMSCorrelationID=bd355934-1770-4e5d-97e9-61ef0fd862752, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/ab426313-1be8-4b6f-bad3-ad3b202d4855/cancel, X-VSK-CorrelationId=bd355934-1770-4e5d-97e9-61ef0fd862752} | exid=ID-esb-stage-37060-1595563687826-91-29222 CID=bd355934-1770-4e5d-97e9-61ef0fd862752","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.28","_type":"_doc","_id":"VHYzlHMBfrYj4vM9Z0ks","_score":43.989296,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":5826459,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-28T06:54:02.784Z","timestamp":"2020-07-28T09:54:02,784","thread":"thread #5154 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-29221, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 06:54:03 GMT, JMSCorrelationID=bd355934-1770-4e5d-97e9-61ef0fd862752, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/ab426313-1be8-4b6f-bad3-ad3b202d4855/cancel, X-VSK-CorrelationId=bd355934-1770-4e5d-97e9-61ef0fd862752} | exid=ID-esb-stage-37060-1595563687826-91-29224 CID=bd355934-1770-4e5d-97e9-61ef0fd862752 |\n {\"checkId\":\"ab426313-1be8-4b6f-bad3-ad3b202d4855\",\"canceledCheckId\":\"b88ff96b-3df8-4043-b71f-436b1a0875f4\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
1593417 [main] INFO  kkm.UnitTests - End test

1593418 [main] INFO  kkm.UnitTests - Starting test: KKM_SIPheckStatus()
1595985 [main] INFO  kkm.UnitTests - End test

1595987 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageNotFound()
1596023 [main] INFO  kkm.UnitTests - End test

1596024 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt_negative()
1596100 [main] INFO  kkm.UnitTests - End test

1596102 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt()
1600789 [main] INFO  kkm.UnitTests - End test

