163  [main] INFO  kkm.UnitTests - Starting test: KKM_DB1()
817  [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
823  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898622
825  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898622
1264 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000898622'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898622'
select * from ProcessStatus where srcID = 'ЖПлато_000898622'
1266 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000898622]
1270 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000898622]
61501 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898622'
61502 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000898622]
121622 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.22/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898622%22%20&size=500
121799 [main] INFO  kkm.UnitTests - Response message : {"took":70,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":11.3657,"hits":[{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"ow7udHMBfrYj4vM90X9-","_score":11.3657,"_source":{"@timestamp":"2020-07-22T05:11:09.198Z","stream":"stdout","message":"{\"ts\":\"2020-07-22T05:11:09.198+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"4c187ff72fe35b8d\",\"spanId\":\"4c187ff72fe35b8d\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"4c187ff72fe35b8d\",\"X-B3-TraceId\":\"4c187ff72fe35b8d\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443","name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_id":"tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_task_name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":49960950,"file":{"path":"/var/lib/docker/containers/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443-json.log"}},"input":{"type":"container"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"HD-BdXMBfrYj4vM9SgvL","_score":11.3657,"_source":{"@timestamp":"2020-07-22T07:51:09.105Z","stream":"stdout","docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_id":"tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_task_name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-22T07:51:09.105+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"e66978000b1e450d\",\"spanId\":\"e66978000b1e450d\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"e66978000b1e450d\",\"X-B3-TraceId\":\"e66978000b1e450d\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","log":{"file":{"path":"/var/lib/docker/containers/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443-json.log"},"offset":6950268},"input":{"type":"container"},"container":{"id":"dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443","name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"Wo1WdnMBfrYj4vM9nyw1","_score":11.3657,"_source":{"@timestamp":"2020-07-22T11:44:09.051Z","stream":"stdout","message":"{\"ts\":\"2020-07-22T11:44:09.050+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"08e262f830b5ce5b\",\"spanId\":\"08e262f830b5ce5b\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"08e262f830b5ce5b\",\"X-B3-TraceId\":\"08e262f830b5ce5b\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":7341380,"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"}},"input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"7ZJodnMBfrYj4vM980Mw","_score":11.3657,"_source":{"@timestamp":"2020-07-22T12:04:09.127Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":8270634,"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"}},"host":{"name":"25805977eece"},"input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida"}}},"ecs":{"version":"1.0.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-22T12:04:09.126+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"04c12b3fb59a0b8f\",\"spanId\":\"04c12b3fb59a0b8f\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"04c12b3fb59a0b8f\",\"X-B3-TraceId\":\"04c12b3fb59a0b8f\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}"}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"d5h8dnMBfrYj4vM9i81T","_score":11.3657,"_source":{"@timestamp":"2020-07-22T12:25:31.172Z","log":{"offset":9254567,"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"}},"message":"{\"ts\":\"2020-07-22T12:25:31.172+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"4d5b24a95f87f14d\",\"spanId\":\"4d5b24a95f87f14d\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"4d5b24a95f87f14d\",\"X-B3-TraceId\":\"4d5b24a95f87f14d\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"stream":"stdout","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"Kqq2dnMBfrYj4vM9v7F8","_score":11.3657,"_source":{"@timestamp":"2020-07-22T13:29:09.073Z","log":{"offset":12008525,"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-22T13:29:09.073+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"6bddd9c57031c91a\",\"spanId\":\"6bddd9c57031c91a\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"6bddd9c57031c91a\",\"X-B3-TraceId\":\"6bddd9c57031c91a\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida"}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"bKiwdnMBfrYj4vM9VqGj","_score":10.995171,"_source":{"@timestamp":"2020-07-22T13:22:09.344Z","message":"{\"ts\":\"2020-07-22T13:22:09.343+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"0837858a311dbfc0\",\"spanId\":\"0837858a311dbfc0\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"0837858a311dbfc0\",\"X-B3-TraceId\":\"0837858a311dbfc0\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"},{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida"}}},"host":{"name":"25805977eece"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"log":{"offset":11609751,"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"}},"stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"}}}]}}
121809 [main] INFO  kkm.UnitTests - End test

121817 [main] INFO  kkm.UnitTests - Starting test: KKM_DB2()
121960 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
121961 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
121963 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
122522 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
122523 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
122527 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
182765 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
182766 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, nothing, ЖПлато_000898541]
242773 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.22/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
242876 [main] INFO  kkm.UnitTests - Response message : {"took":47,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":7,"relation":"eq"},"max_score":10.518369,"hits":[{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"Gg_wdHMBfrYj4vM9q1ci","_score":10.518369,"_source":{"@timestamp":"2020-07-22T05:13:09.278Z","stream":"stdout","log":{"file":{"path":"/var/lib/docker/containers/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443-json.log"},"offset":63480},"input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_id":"tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_task_name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-22T05:13:09.278+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"91fabd25467f58e3\",\"spanId\":\"91fabd25467f58e3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"91fabd25467f58e3\",\"X-B3-TraceId\":\"91fabd25467f58e3\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443","name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"Vj-DdXMBfrYj4vM9I42A","_score":10.518369,"_source":{"@timestamp":"2020-07-22T07:53:09.043Z","stream":"stdout","input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_id":"tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_task_name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"},"log":{"offset":7052988,"file":{"path":"/var/lib/docker/containers/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443-json.log"}},"message":"{\"ts\":\"2020-07-22T07:53:09.043+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"6c75b633d9eebd04\",\"spanId\":\"6c75b633d9eebd04\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"6c75b633d9eebd04\",\"X-B3-TraceId\":\"6c75b633d9eebd04\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443","name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"KYdNdnMBfrYj4vM9d-02","_score":10.518369,"_source":{"@timestamp":"2020-07-22T11:34:09.116Z","stream":"stdout","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida"}}},"container":{"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece"},"log":{"offset":6815674,"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-22T11:34:09.116+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"f15cf81aa0729222\",\"spanId\":\"f15cf81aa0729222\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"f15cf81aa0729222\",\"X-B3-TraceId\":\"f15cf81aa0729222\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}"}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"949fdnMBfrYj4vM9y-wZ","_score":10.518369,"_source":{"@timestamp":"2020-07-22T11:54:09.049Z","container":{"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n"}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"log":{"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"},"offset":7801404},"stream":"stdout","message":"{\"ts\":\"2020-07-22T11:54:09.048+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"312cf8bae0b12625\",\"spanId\":\"312cf8bae0b12625\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"312cf8bae0b12625\",\"X-B3-TraceId\":\"312cf8bae0b12625\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"sZVzdnMBfrYj4vM9Y0pM","_score":10.518369,"_source":{"@timestamp":"2020-07-22T12:15:31.145Z","agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"log":{"offset":8781680,"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"}},"input":{"type":"container"},"container":{"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"stream":"stdout","message":"{\"ts\":\"2020-07-22T12:15:31.145+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"0984bb3a747243d4\",\"spanId\":\"0984bb3a747243d4\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"0984bb3a747243d4\",\"X-B3-TraceId\":\"0984bb3a747243d4\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n"}}}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"8au4dnMBfrYj4vM9lBlJ","_score":10.518369,"_source":{"@timestamp":"2020-07-22T13:31:09.211Z","message":"{\"ts\":\"2020-07-22T13:31:09.210+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"044370ee435274bb\",\"spanId\":\"044370ee435274bb\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"044370ee435274bb\",\"X-B3-TraceId\":\"044370ee435274bb\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"host":{"name":"25805977eece"},"log":{"offset":12111242,"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida"}}},"container":{"name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3"},"ecs":{"version":"1.0.1"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"K6mydnMBfrYj4vM9K0Z0","_score":10.175535,"_source":{"@timestamp":"2020-07-22T13:24:09.191Z","host":{"name":"25805977eece"},"stream":"stdout","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida"},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":11742954,"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"}},"message":"{\"ts\":\"2020-07-22T13:24:09.190+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"5f429b4fdfd308cd\",\"spanId\":\"5f429b4fdfd308cd\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"5f429b4fdfd308cd\",\"X-B3-TraceId\":\"5f429b4fdfd308cd\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"847C907BA418513D37F6000CE30C407DBB7C70C2\"},{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}"}}]}}
242878 [main] INFO  kkm.UnitTests - End test

242884 [main] INFO  kkm.UnitTests - Starting test: KKM_DB3()
243010 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-VF8yF9ob6vzs', '5826188334', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-VF8yF9ob6vzs','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-VF8yF9ob6vzs', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-VF8yF9ob6vzs', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-VF8yF9ob6vzs'


update alertPeriod set finishTime = '23.59.59' where FilialCode = '0031'

update alertPeriod set startTime = '00.00.00' where FilialCode = '0031'

update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-VF8yF9ob6vzs'

update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-VF8yF9ob6vzs'
333484 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-VF8yF9ob6vzs'
333485 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-VF8yF9ob6vzs, null]
333489 [main] INFO  kkm.UnitTests - null
333489 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
333489 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
333581 [main] INFO  kkm.UnitTests - End test

333600 [main] INFO  kkm.UnitTests - Starting test: KKM_DB4()
333719 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-L4gSqJpPCpNi', '1094231954', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-L4gSqJpPCpNi','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-L4gSqJpPCpNi', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-L4gSqJpPCpNi', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-L4gSqJpPCpNi'


update alertPeriod set finishTime = '23.59.59' where FilialCode = '0067'

update alertPeriod set startTime = '00.00.00' where FilialCode = '0067'

update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-L4gSqJpPCpNi'

update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-L4gSqJpPCpNi'
424304 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-L4gSqJpPCpNi'
424305 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-L4gSqJpPCpNi, null]
424308 [main] INFO  kkm.UnitTests - null
424309 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
424309 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
424398 [main] INFO  kkm.UnitTests - End test

424406 [main] INFO  kkm.UnitTests - Starting test: KKM_DB5()
424535 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Dk5PYA4dDsrg', '9051500584', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Dk5PYA4dDsrg','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Dk5PYA4dDsrg', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Dk5PYA4dDsrg', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-Dk5PYA4dDsrg'


update alertPeriod set finishTime = '23.59.59' where FilialCode = 'NOFILIAL'

update alertPeriod set startTime = '00.00.00' where FilialCode = 'NOFILIAL'

update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-Dk5PYA4dDsrg'

update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-Dk5PYA4dDsrg'
514982 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-Dk5PYA4dDsrg'
514983 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-Dk5PYA4dDsrg, d0b6efc4-a23f-4ed6-a8ce-5b05f51dfaaa]
514986 [main] INFO  kkm.UnitTests - DONE
514987 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
514987 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
515185 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.22/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-Dk5PYA4dDsrg%22%20&size=500
515338 [main] INFO  kkm.UnitTests - Response message : {"took":36,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":28.68536,"hits":[{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"way9dnMBfrYj4vM9KEZJ","_score":28.68536,"_source":{"@timestamp":"2020-07-22T13:36:09.227Z","stream":"stdout","message":"{\"ts\":\"2020-07-22T13:36:09.227+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"6f18529e33b86ae3\",\"spanId\":\"6f18529e33b86ae3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"6f18529e33b86ae3\",\"X-B3-TraceId\":\"6f18529e33b86ae3\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-Dk5PYA4dDsrg\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"log":{"offset":12339665,"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"}},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida"}}},"container":{"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}}}}]}}
515470 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'

515618 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
515643 [main] INFO  kkm.UnitTests - End test

515646 [main] INFO  kkm.UnitTests - Starting test: KKM_DB6()
515768 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-3f05bA5WP3vS', '8385378681', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-3f05bA5WP3vS','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-3f05bA5WP3vS', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-3f05bA5WP3vS', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-3f05bA5WP3vS'


update alertPeriod set finishTime = '00.00.00' where FilialCode = '0031'

update alertPeriod set startTime = '00.00.00' where FilialCode = '0031'

update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-3f05bA5WP3vS'

update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-3f05bA5WP3vS'
606207 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-3f05bA5WP3vS'
606207 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-3f05bA5WP3vS, null]
606211 [main] INFO  kkm.UnitTests - null
606211 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
606211 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
606216 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.22/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
606375 [main] INFO  kkm.UnitTests - Response message : {"took":105,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1633,"relation":"eq"},"max_score":5.339103,"hits":[{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"K13TdXMBfrYj4vM9B-zw","_score":5.339103,"_source":{"@timestamp":"2020-07-22T09:20:26.472Z","log":{"offset":774714,"file":{"path":"/var/lib/docker/containers/41c126187698f12cd162f8dc866a0d2db1c5f6995e7473ba9bb3c9f8914a8272/41c126187698f12cd162f8dc866a0d2db1c5f6995e7473ba9bb3c9f8914a8272-json.log"}},"input":{"type":"container"},"container":{"id":"41c126187698f12cd162f8dc866a0d2db1c5f6995e7473ba9bb3c9f8914a8272","name":"kkm-commutator_service.1.s85gta6vzn5waao47603f352c","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"stream":"stdout","message":"{\"ts\":\"2020-07-22T09:20:26.472+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","Version":"97","com_docker_swarm_task_id":"s85gta6vzn5waao47603f352c","Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.s85gta6vzn5waao47603f352c"}}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"6lzQdXMBfrYj4vM909WW","_score":5.339103,"_source":{"@timestamp":"2020-07-22T09:18:02.059Z","log":{"offset":774717,"file":{"path":"/var/lib/docker/containers/89eddade8201aff27c08831c7fea8414372f29d372659d3f1ddc4786630e9bd2/89eddade8201aff27c08831c7fea8414372f29d372659d3f1ddc4786630e9bd2-json.log"}},"message":"{\"ts\":\"2020-07-22T09:18:02.059+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"stream":"stdout","input":{"type":"container"},"container":{"id":"89eddade8201aff27c08831c7fea8414372f29d372659d3f1ddc4786630e9bd2","name":"kkm-commutator_service.1.m11gsg5xsp7b6yr07m4kooxk8","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_id":"m11gsg5xsp7b6yr07m4kooxk8","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.m11gsg5xsp7b6yr07m4kooxk8"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"Dl_XdXMBfrYj4vM9bZt3","_score":5.339103,"_source":{"@timestamp":"2020-07-22T09:25:15.258Z","host":{"name":"25805977eece"},"log":{"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"},"offset":774746},"container":{"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-22T09:25:15.258+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"Ul_VdXMBfrYj4vM9PAbJ","_score":5.339103,"_source":{"@timestamp":"2020-07-22T09:22:50.766Z","input":{"type":"container"},"container":{"id":"16413d6b7eecb898699d8ffb7aebb0bd455bee9249bdda454dfc6f9cfa3822a6","name":"kkm-commutator_service.1.g7yjrgjmwwfuzsyjdnehxf2gt","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_name":"kkm-commutator_service.1.g7yjrgjmwwfuzsyjdnehxf2gt","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_id":"g7yjrgjmwwfuzsyjdnehxf2gt"}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-22T09:22:50.766+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","stream":"stdout","log":{"offset":774729,"file":{"path":"/var/lib/docker/containers/16413d6b7eecb898699d8ffb7aebb0bd455bee9249bdda454dfc6f9cfa3822a6/16413d6b7eecb898699d8ffb7aebb0bd455bee9249bdda454dfc6f9cfa3822a6-json.log"}}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"t93Vc3MBfrYj4vM9xDCR","_score":3.6902862,"_source":{"@timestamp":"2020-07-22T00:04:09.029Z","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task_id":"tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_task_name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n"}}},"host":{"name":"25805977eece"},"message":"{\"ts\":\"2020-07-22T00:04:09.029+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9fb1d594f520a788\",\"spanId\":\"9fb1d594f520a788\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9fb1d594f520a788\",\"X-B3-TraceId\":\"9fb1d594f520a788\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","input":{"type":"container"},"container":{"id":"dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443","name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":37396269,"file":{"path":"/var/lib/docker/containers/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443-json.log"}}}}]}}
606498 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'

606651 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
606677 [main] INFO  kkm.UnitTests - End test

606678 [main] INFO  kkm.UnitTests - Starting test: KKM_DB7()
606819 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-k202BRsqKBqB', '1002954705', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-k202BRsqKBqB','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-k202BRsqKBqB', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-k202BRsqKBqB', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-k202BRsqKBqB'


update alertPeriod set finishTime = '00.00.00' where FilialCode = '0067'

update alertPeriod set startTime = '00.00.00' where FilialCode = '0067'

update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-k202BRsqKBqB'

update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-k202BRsqKBqB'
697396 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-k202BRsqKBqB'
697397 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-k202BRsqKBqB, null]
697400 [main] INFO  kkm.UnitTests - null
697400 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
697400 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
697405 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.22/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
697460 [main] INFO  kkm.UnitTests - Response message : {"took":1,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1635,"relation":"eq"},"max_score":5.3386884,"hits":[{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"K13TdXMBfrYj4vM9B-zw","_score":5.3386884,"_source":{"@timestamp":"2020-07-22T09:20:26.472Z","log":{"offset":774714,"file":{"path":"/var/lib/docker/containers/41c126187698f12cd162f8dc866a0d2db1c5f6995e7473ba9bb3c9f8914a8272/41c126187698f12cd162f8dc866a0d2db1c5f6995e7473ba9bb3c9f8914a8272-json.log"}},"input":{"type":"container"},"container":{"id":"41c126187698f12cd162f8dc866a0d2db1c5f6995e7473ba9bb3c9f8914a8272","name":"kkm-commutator_service.1.s85gta6vzn5waao47603f352c","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"stream":"stdout","message":"{\"ts\":\"2020-07-22T09:20:26.472+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","Version":"97","com_docker_swarm_task_id":"s85gta6vzn5waao47603f352c","Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.s85gta6vzn5waao47603f352c"}}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"6lzQdXMBfrYj4vM909WW","_score":5.3386884,"_source":{"@timestamp":"2020-07-22T09:18:02.059Z","log":{"offset":774717,"file":{"path":"/var/lib/docker/containers/89eddade8201aff27c08831c7fea8414372f29d372659d3f1ddc4786630e9bd2/89eddade8201aff27c08831c7fea8414372f29d372659d3f1ddc4786630e9bd2-json.log"}},"message":"{\"ts\":\"2020-07-22T09:18:02.059+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"stream":"stdout","input":{"type":"container"},"container":{"id":"89eddade8201aff27c08831c7fea8414372f29d372659d3f1ddc4786630e9bd2","name":"kkm-commutator_service.1.m11gsg5xsp7b6yr07m4kooxk8","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_id":"m11gsg5xsp7b6yr07m4kooxk8","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.m11gsg5xsp7b6yr07m4kooxk8"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"Dl_XdXMBfrYj4vM9bZt3","_score":5.3386884,"_source":{"@timestamp":"2020-07-22T09:25:15.258Z","host":{"name":"25805977eece"},"log":{"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"},"offset":774746},"container":{"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-22T09:25:15.258+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"Ul_VdXMBfrYj4vM9PAbJ","_score":5.3386884,"_source":{"@timestamp":"2020-07-22T09:22:50.766Z","input":{"type":"container"},"container":{"id":"16413d6b7eecb898699d8ffb7aebb0bd455bee9249bdda454dfc6f9cfa3822a6","name":"kkm-commutator_service.1.g7yjrgjmwwfuzsyjdnehxf2gt","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_name":"kkm-commutator_service.1.g7yjrgjmwwfuzsyjdnehxf2gt","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_id":"g7yjrgjmwwfuzsyjdnehxf2gt"}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-22T09:22:50.766+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","stream":"stdout","log":{"offset":774729,"file":{"path":"/var/lib/docker/containers/16413d6b7eecb898699d8ffb7aebb0bd455bee9249bdda454dfc6f9cfa3822a6/16413d6b7eecb898699d8ffb7aebb0bd455bee9249bdda454dfc6f9cfa3822a6-json.log"}}}},{"_index":"kkm-commutator-stage-2020.07.22","_type":"_doc","_id":"t93Vc3MBfrYj4vM9xDCR","_score":3.6900043,"_source":{"@timestamp":"2020-07-22T00:04:09.029Z","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task_id":"tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_task_name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n"}}},"host":{"name":"25805977eece"},"message":"{\"ts\":\"2020-07-22T00:04:09.029+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9fb1d594f520a788\",\"spanId\":\"9fb1d594f520a788\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9fb1d594f520a788\",\"X-B3-TraceId\":\"9fb1d594f520a788\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","input":{"type":"container"},"container":{"id":"dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443","name":"kkm-commutator_service.1.tvklcn7vfeoqq3fd07v60ht9c","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":37396269,"file":{"path":"/var/lib/docker/containers/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443/dd2324c1d9ff4016c6c1a83b8bb94f9d633dae0561e1fd1f2b47a7302fa22443-json.log"}}}}]}}
697597 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'

697763 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
697790 [main] INFO  kkm.UnitTests - End test

697793 [main] INFO  kkm.UnitTests - Starting test: KKM_DB8()
697935 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oR5ja2Iy4GiE', '0362904723', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oR5ja2Iy4GiE','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oR5ja2Iy4GiE', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oR5ja2Iy4GiE', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-oR5ja2Iy4GiE'


update alertPeriod set finishTime = '00.00.00' where FilialCode = 'NOFILIAL'

update alertPeriod set startTime = '00.00.00' where FilialCode = 'NOFILIAL'

update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-oR5ja2Iy4GiE'

update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-oR5ja2Iy4GiE'
788351 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-oR5ja2Iy4GiE'
788351 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, SENDED, , , 9SD0C9DZ-9289-4A09-oR5ja2Iy4GiE, 03f2cb57-288a-4e28-89bb-b72e305b8a99]
788355 [main] INFO  kkm.UnitTests - SENDED
788355 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
788355 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
788356 [main] INFO  kkm.UnitTests - End test

