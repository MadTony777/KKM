144  [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckNoCashier()
3174 [main] INFO  kkm.UnitTests - End test

3184 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageEmail()
35822 [main] INFO  kkm.UnitTests - {"checkId":"be20876c-67a7-4c17-9c62-551ce38484c9"}
275904 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.29/_search?q=%20message:%20%22CID=0d5a7c21-c9e7-4139-8288-db556b2612ff11%22%20
276117 [main] INFO  kkm.UnitTests - Response message : {"took":65,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":57.91185,"hits":[{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"XSxzmXMBfrYj4vM9-8Hk","_score":57.91185,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":2362003,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-29T07:22:35.038Z","timestamp":"2020-07-29T10:22:35,038","thread":"qtp524044206-1522","message":"KkmService: REST response Operation 'SendMessage' was complete with body: ReceiptResponse{correlationId='null', checkId='be20876c-67a7-4c17-9c62-551ce38484c9', error=null} | exid=ID-esb-stage-42112-1596001282592-55-7467 CID=0d5a7c21-c9e7-4139-8288-db556b2612ff11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"aCxzmXMBfrYj4vM9wpNb","_score":57.694363,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":2357623,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-29T07:22:34.968Z","timestamp":"2020-07-29T10:22:34,968","thread":"qtp524044206-1522","message":"KkmService: REST request  Operation 'SendMessage' was call with body: SendMessageRequest{checkId='be20876c-67a7-4c17-9c62-551ce38484c9', messageType='email', messageAddress='EPolikarpova@VSK.RU'} | exid=ID-esb-stage-42112-1596001282592-55-7467 CID=0d5a7c21-c9e7-4139-8288-db556b2612ff11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"XyxzmXMBfrYj4vM9wpNY","_score":55.405544,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":2357147,"@timestamp":"2020-07-29T07:22:34.968Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-29T10:22:34,968","thread":"qtp524044206-1522","message":"KkmService: REST request  Operation 'SendMessage' was call with headers: {breadcrumbId=ID-esb-stage-42112-1596001282592-55-7466, JMSCorrelationID=0d5a7c21-c9e7-4139-8288-db556b2612ff11, operationName=SendMessage, X-VSK-CorrelationId=0d5a7c21-c9e7-4139-8288-db556b2612ff11} | exid=ID-esb-stage-42112-1596001282592-55-7467 CID=0d5a7c21-c9e7-4139-8288-db556b2612ff11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"VixzmXMBfrYj4vM9wpMM","_score":52.028046,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":2358660,"beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"@timestamp":"2020-07-29T07:22:34.997Z","timestamp":"2020-07-29T10:22:34,997","thread":"thread #1855 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-42112-1596001282592-55-7466, CamelHttpMethod=GET, JMSCorrelationID=0d5a7c21-c9e7-4139-8288-db556b2612ff11, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/be20876c-67a7-4c17-9c62-551ce38484c9/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=0d5a7c21-c9e7-4139-8288-db556b2612ff11} | exId=ID-esb-stage-42112-1596001282592-55-7469 CID=0d5a7c21-c9e7-4139-8288-db556b2612ff11 |\n ","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"ZCxzmXMBfrYj4vM9wpNZ","_score":52.028046,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":2358022,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-29T07:22:34.997Z","timestamp":"2020-07-29T10:22:34,997","thread":"thread #1855 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-42112-1596001282592-55-7466, CamelHttpMethod=GET, JMSCorrelationID=0d5a7c21-c9e7-4139-8288-db556b2612ff11, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/be20876c-67a7-4c17-9c62-551ce38484c9/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=0d5a7c21-c9e7-4139-8288-db556b2612ff11} | exId=ID-esb-stage-42112-1596001282592-55-7469 CID=0d5a7c21-c9e7-4139-8288-db556b2612ff11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"VyxzmXMBfrYj4vM9wpMM","_score":46.94093,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":2359302,"@timestamp":"2020-07-29T07:22:35.037Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-29T10:22:35,037","thread":"thread #1855 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-42112-1596001282592-55-7466, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Wed, 29 Jul 2020 07:22:36 GMT, JMSCorrelationID=0d5a7c21-c9e7-4139-8288-db556b2612ff11, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/be20876c-67a7-4c17-9c62-551ce38484c9/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=0d5a7c21-c9e7-4139-8288-db556b2612ff11} | exid=ID-esb-stage-42112-1596001282592-55-7469 CID=0d5a7c21-c9e7-4139-8288-db556b2612ff11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"YCxzmXMBfrYj4vM9wpNY","_score":46.94093,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":2361108,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-29T07:22:35.038Z","timestamp":"2020-07-29T10:22:35,038","thread":"qtp524044206-1522","message":"KkmService: REST response Operation 'SendMessage' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-42112-1596001282592-55-7466, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Wed, 29 Jul 2020 07:22:36 GMT, JMSCorrelationID=0d5a7c21-c9e7-4139-8288-db556b2612ff11, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/be20876c-67a7-4c17-9c62-551ce38484c9/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=0d5a7c21-c9e7-4139-8288-db556b2612ff11} | exid=ID-esb-stage-42112-1596001282592-55-7467 CID=0d5a7c21-c9e7-4139-8288-db556b2612ff11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"XCxzmXMBfrYj4vM9wpNX","_score":45.82088,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":2360178,"@timestamp":"2020-07-29T07:22:35.037Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-29T10:22:35,037","thread":"thread #1855 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-42112-1596001282592-55-7466, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Wed, 29 Jul 2020 07:22:36 GMT, JMSCorrelationID=0d5a7c21-c9e7-4139-8288-db556b2612ff11, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/be20876c-67a7-4c17-9c62-551ce38484c9/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=0d5a7c21-c9e7-4139-8288-db556b2612ff11} | exid=ID-esb-stage-42112-1596001282592-55-7469 CID=0d5a7c21-c9e7-4139-8288-db556b2612ff11 |\n {\"checkId\":\"be20876c-67a7-4c17-9c62-551ce38484c9\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
276119 [main] INFO  kkm.UnitTests - End test

276122 [main] INFO  kkm.UnitTests - Starting test: KKM_WAcheckStatus()
278689 [main] INFO  kkm.UnitTests - End test

278692 [main] INFO  kkm.UnitTests - Starting test: KKM_getStatus()
281056 [main] INFO  kkm.UnitTests - End test

281058 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceledAlredy()
284095 [main] INFO  kkm.UnitTests - End test

284096 [main] INFO  kkm.UnitTests - Starting test: KKM_getDocCustomer()
284266 [main] INFO  kkm.UnitTests - {"requestInfo":{"customerName":"?????? ???? ????????","customerDocSerial":"1000","customerDocNum":"111000","customerPhone":"+79257777777","customerEmail":"test@gmail.com","paymentType":"INCOME","paymentDatetime":"2019.05.31T16:45:45","systemId":"SHOP","amount":2000.5},"receiptInfo":{"id":"e58d48a3-e8ab-425b-8101-5b61f99fe736","datetimeRequest":"2019.05.31T16:45:45","datetimeReceipt":"2019.05.31T16:45:45","receiptStatus":"NEW","documentIndex":0,"paymentMethod":"PREPAYMENT","terminal":"112344256"},"positions":[{"name":"????????? ?????? ? ?????????????","price":1000.25,"quantity":2,"tax":"VAT20","taxSum":1000.25,"paymentMethod":"PREPAYMENT","subjectType":"PRODUCT"}]}
284267 [main] INFO  kkm.UnitTests - End test

284270 [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckCashier()
300129 [main] INFO  kkm.UnitTests - End test

300131 [main] INFO  kkm.UnitTests - Starting test: KKM_DB1()
300449 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
300453 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
300456 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
301008 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000901797'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000901797'
select * from ProcessStatus where srcID = 'ЖПлато_000901797'
301009 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
301012 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
361348 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000901797'
361349 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000901797]
421356 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000901797%22%20&size=500
421610 [main] INFO  kkm.UnitTests - Response message : {"took":166,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":2,"relation":"eq"},"max_score":11.881863,"hits":[{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"XRRRmXMBfrYj4vM9ZnI7","_score":11.881863,"_source":{"@timestamp":"2020-07-29T06:45:09.390Z","log":{"offset":3895481,"file":{"path":"/var/lib/docker/containers/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91-json.log"}},"message":"{\"ts\":\"2020-07-29T06:45:09.387+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"6e2f6498be95a5b7\",\"spanId\":\"6e2f6498be95a5b7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"6e2f6498be95a5b7\",\"X-B3-TraceId\":\"6e2f6498be95a5b7\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task_id":"wsunza2qrd02kzp8b2jcnhwz4","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"stream":"stdout","container":{"id":"10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91","name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"Bi53mXMBfrYj4vM918FF","_score":11.881863,"_source":{"@timestamp":"2020-07-29T07:27:09.329Z","stream":"stdout","message":"{\"ts\":\"2020-07-29T07:27:09.328+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"7493a7b1b6ee66ea\",\"spanId\":\"7493a7b1b6ee66ea\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7493a7b1b6ee66ea\",\"X-B3-TraceId\":\"7493a7b1b6ee66ea\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91","name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_id":"wsunza2qrd02kzp8b2jcnhwz4","com_docker_swarm_task_name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task":"","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"log":{"file":{"path":"/var/lib/docker/containers/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91-json.log"},"offset":5891430},"input":{"type":"container"},"ecs":{"version":"1.0.1"}}}]}}
421613 [main] INFO  kkm.UnitTests - End test

421621 [main] INFO  kkm.UnitTests - Starting test: KKM_DB2()
421804 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
421805 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
421807 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
422493 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
422493 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
422496 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
482821 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
482821 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, nothing, ЖПлато_000898541]
542824 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
543007 [main] INFO  kkm.UnitTests - Response message : {"took":98,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":2,"relation":"eq"},"max_score":11.091025,"hits":[{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"YRVTmXMBfrYj4vM9Ny8j","_score":11.091025,"_source":{"@timestamp":"2020-07-29T06:47:09.261Z","host":{"name":"25805977eece"},"agent":{"id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece"},"log":{"offset":3997905,"file":{"path":"/var/lib/docker/containers/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91-json.log"}},"stream":"stdout","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task_id":"wsunza2qrd02kzp8b2jcnhwz4"}}},"message":"{\"ts\":\"2020-07-29T06:47:09.261+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"1a1aed4ace483f60\",\"spanId\":\"1a1aed4ace483f60\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"1a1aed4ace483f60\",\"X-B3-TraceId\":\"1a1aed4ace483f60\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91","name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"li95mXMBfrYj4vM9rPQT","_score":11.091025,"_source":{"@timestamp":"2020-07-29T07:29:09.370Z","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"wsunza2qrd02kzp8b2jcnhwz4","com_docker_swarm_task_name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","Description":"KKM Commutator Service","Version":"97"}}},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-29T07:29:09.370+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"e3f35a6d7ec23a6e\",\"spanId\":\"e3f35a6d7ec23a6e\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"e3f35a6d7ec23a6e\",\"X-B3-TraceId\":\"e3f35a6d7ec23a6e\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","log":{"offset":5993845,"file":{"path":"/var/lib/docker/containers/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91-json.log"}},"container":{"name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"}}}]}}
543011 [main] INFO  kkm.UnitTests - End test

543014 [main] INFO  kkm.UnitTests - Starting test: KKM_DB3()
543200 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-lf0ibazxhEMM', '6631187873', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-lf0ibazxhEMM','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-lf0ibazxhEMM', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-lf0ibazxhEMM', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-lf0ibazxhEMM'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-lf0ibazxhEMM'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-lf0ibazxhEMM'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-lf0ibazxhEMM'
654110 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-lf0ibazxhEMM'
654111 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-lf0ibazxhEMM, 72017d69-ca7d-4c0a-b538-a6a456909bf8]
654115 [main] INFO  kkm.UnitTests - Status: DONE
654115 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
654115 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
674409 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-lf0ibazxhEMM%22%20&size=500
674560 [main] INFO  kkm.UnitTests - Response message : {"took":98,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":28.117716,"hits":[{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"fzF7mXMBfrYj4vM9gB7n","_score":28.117716,"_source":{"@timestamp":"2020-07-29T07:31:09.335Z","message":"{\"ts\":\"2020-07-29T07:31:09.335+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"3fc75d23f3ae1c42\",\"spanId\":\"3fc75d23f3ae1c42\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3fc75d23f3ae1c42\",\"X-B3-TraceId\":\"3fc75d23f3ae1c42\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-yuHKCFMRASzE\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-lf0ibazxhEMM\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task_id":"wsunza2qrd02kzp8b2jcnhwz4","com_docker_swarm_task_name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4"}}},"container":{"id":"10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91","name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"log":{"file":{"path":"/var/lib/docker/containers/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91-json.log"},"offset":6103851},"stream":"stdout","input":{"type":"container"}}}]}}
674728 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
674753 [main] INFO  kkm.UnitTests - End test

674756 [main] INFO  kkm.UnitTests - Starting test: KKM_DB4()
674950 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ymj4C1hClsgk', '2255450276', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ymj4C1hClsgk','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ymj4C1hClsgk', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ymj4C1hClsgk', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-ymj4C1hClsgk'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-ymj4C1hClsgk'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-ymj4C1hClsgk'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-ymj4C1hClsgk'
785728 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-ymj4C1hClsgk'
785729 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-ymj4C1hClsgk, 9ef88bb9-4e22-4fc1-816b-d89c9f683b2b]
785733 [main] INFO  kkm.UnitTests - Status: FAIL
785733 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
785733 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
805998 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-ymj4C1hClsgk%22%20&size=500
806106 [main] INFO  kkm.UnitTests - Response message : {"took":55,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.671667,"hits":[{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"aDJ9mXMBfrYj4vM9rwWW","_score":27.671667,"_source":{"@timestamp":"2020-07-29T07:33:31.152Z","log":{"file":{"path":"/var/lib/docker/containers/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91-json.log"},"offset":6260190},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task_id":"wsunza2qrd02kzp8b2jcnhwz4","com_docker_swarm_task_name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"host":{"name":"25805977eece"},"stream":"stdout","message":"{\"ts\":\"2020-07-29T07:33:31.152+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"fa178016ec3ef2e8\",\"spanId\":\"fa178016ec3ef2e8\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"fa178016ec3ef2e8\",\"X-B3-TraceId\":\"fa178016ec3ef2e8\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-mddMhvbjLNhb\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-ymj4C1hClsgk\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91"},"ecs":{"version":"1.0.1"}}}]}}
806292 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
806317 [main] INFO  kkm.UnitTests - End test

806320 [main] INFO  kkm.UnitTests - Starting test: KKM_DB5()
806489 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-qUhsNsHg2cRl', '2686414603', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-qUhsNsHg2cRl','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-qUhsNsHg2cRl', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-qUhsNsHg2cRl', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-qUhsNsHg2cRl'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-qUhsNsHg2cRl'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-qUhsNsHg2cRl'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-qUhsNsHg2cRl'
917184 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-qUhsNsHg2cRl'
917184 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-qUhsNsHg2cRl, 36c30511-2e9f-49e9-acf8-9891e6cdbb5f]
917188 [main] INFO  kkm.UnitTests - Status: DONE
917189 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
917189 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
937353 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-qUhsNsHg2cRl%22%20&size=500
937426 [main] INFO  kkm.UnitTests - Response message : {"took":21,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.305292,"hits":[{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"ADJ_mXMBfrYj4vM9hKdj","_score":27.305292,"_source":{"@timestamp":"2020-07-29T07:35:31.151Z","log":{"file":{"path":"/var/lib/docker/containers/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91-json.log"},"offset":6404679},"stream":"stdout","docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task_id":"wsunza2qrd02kzp8b2jcnhwz4","com_docker_swarm_task_name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4"}}},"ecs":{"version":"1.0.1"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"message":"{\"ts\":\"2020-07-29T07:35:31.151+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"ffcf2fd39b6f9613\",\"spanId\":\"ffcf2fd39b6f9613\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"ffcf2fd39b6f9613\",\"X-B3-TraceId\":\"ffcf2fd39b6f9613\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-n70rXz0rtouy\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-qUhsNsHg2cRl\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"container":{"id":"10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91","name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}}]}}
937594 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
937616 [main] INFO  kkm.UnitTests - End test

937616 [main] INFO  kkm.UnitTests - Starting test: KKM_DB6()
937763 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NLSmxjvP8F4V', '5568556395', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NLSmxjvP8F4V','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NLSmxjvP8F4V', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NLSmxjvP8F4V', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-NLSmxjvP8F4V'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-NLSmxjvP8F4V'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-NLSmxjvP8F4V'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-NLSmxjvP8F4V'
1048445 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-NLSmxjvP8F4V'
1048446 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-NLSmxjvP8F4V, null]
1048450 [main] INFO  kkm.UnitTests - Status: null
1048451 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1048451 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1068456 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1068658 [main] INFO  kkm.UnitTests - Response message : {"took":149,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":915,"relation":"eq"},"max_score":5.379316,"hits":[{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"rf0XmXMBfrYj4vM9eFm9","_score":5.379316,"_source":{"@timestamp":"2020-07-29T05:41:54.776Z","stream":"stdout","container":{"id":"10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91","name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task_id":"wsunza2qrd02kzp8b2jcnhwz4","com_docker_swarm_task_name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-29T05:41:54.776+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","log":{"file":{"path":"/var/lib/docker/containers/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91-json.log"},"offset":774733},"input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"B_sTmXMBfrYj4vM9CvsN","_score":5.379316,"_source":{"@timestamp":"2020-07-29T05:37:04.465Z","stream":"stdout","message":"{\"ts\":\"2020-07-29T05:37:04.465+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"62e2d31dcb80d736173fb7e85934038ac76ec61c312962d9634bd58d365f0c62","name":"kkm-commutator_service.1.2pbd7jxr2c7wllzbjwsph1jut","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"2pbd7jxr2c7wllzbjwsph1jut","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.2pbd7jxr2c7wllzbjwsph1jut","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":774748,"file":{"path":"/var/lib/docker/containers/62e2d31dcb80d736173fb7e85934038ac76ec61c312962d9634bd58d365f0c62/62e2d31dcb80d736173fb7e85934038ac76ec61c312962d9634bd58d365f0c62-json.log"}},"input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"TfwVmXMBfrYj4vM9QrzI","_score":5.379316,"_source":{"@timestamp":"2020-07-29T05:39:29.651Z","log":{"offset":774726,"file":{"path":"/var/lib/docker/containers/9d280eb0a36e4977eabf56abd3c9c5ffb708b06d0d6538bafa1fa41060ad38ea/9d280eb0a36e4977eabf56abd3c9c5ffb708b06d0d6538bafa1fa41060ad38ea-json.log"}},"message":"{\"ts\":\"2020-07-29T05:39:29.651+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_id":"m7ssfcwmousg94nnggw1yhb7u","com_docker_swarm_task_name":"kkm-commutator_service.1.m7ssfcwmousg94nnggw1yhb7u","Version":"97"}}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout","input":{"type":"container"},"container":{"id":"9d280eb0a36e4977eabf56abd3c9c5ffb708b06d0d6538bafa1fa41060ad38ea","name":"kkm-commutator_service.1.m7ssfcwmousg94nnggw1yhb7u","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"iLTul3MBfrYj4vM9J2qE","_score":3.7078743,"_source":{"@timestamp":"2020-07-29T00:17:09.132Z","message":"{\"ts\":\"2020-07-29T00:17:09.132+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"c08269c3925bea42\",\"spanId\":\"c08269c3925bea42\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c08269c3925bea42\",\"X-B3-TraceId\":\"c08269c3925bea42\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":41901711,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}},"stream":"stdout","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp"},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"QrTul3MBfrYj4vM9fXF2","_score":3.7078743,"_source":{"@timestamp":"2020-07-29T00:17:31.137Z","container":{"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp"}}},"host":{"name":"25805977eece"},"stream":"stdout","message":"{\"ts\":\"2020-07-29T00:17:31.137+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"6dee41e4d13328a5\",\"spanId\":\"6dee41e4d13328a5\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"6dee41e4d13328a5\",\"X-B3-TraceId\":\"6dee41e4d13328a5\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","ecs":{"version":"1.0.1"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"log":{"offset":41916611,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}},"input":{"type":"container"}}}]}}
1068853 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
1068882 [main] INFO  kkm.UnitTests - End test

1068884 [main] INFO  kkm.UnitTests - Starting test: KKM_DB7()
1069074 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Cvz7s2MQW1zF', '8608790852', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Cvz7s2MQW1zF','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Cvz7s2MQW1zF', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Cvz7s2MQW1zF', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-Cvz7s2MQW1zF'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-Cvz7s2MQW1zF'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-Cvz7s2MQW1zF'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-Cvz7s2MQW1zF'
1179820 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-Cvz7s2MQW1zF'
1179821 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-Cvz7s2MQW1zF, null]
1179824 [main] INFO  kkm.UnitTests - Status: null
1179824 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1179824 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1199825 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1200034 [main] INFO  kkm.UnitTests - Response message : {"took":102,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":919,"relation":"eq"},"max_score":5.378802,"hits":[{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"rf0XmXMBfrYj4vM9eFm9","_score":5.378802,"_source":{"@timestamp":"2020-07-29T05:41:54.776Z","stream":"stdout","container":{"id":"10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91","name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task_id":"wsunza2qrd02kzp8b2jcnhwz4","com_docker_swarm_task_name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-29T05:41:54.776+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","log":{"file":{"path":"/var/lib/docker/containers/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91-json.log"},"offset":774733},"input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"B_sTmXMBfrYj4vM9CvsN","_score":5.378802,"_source":{"@timestamp":"2020-07-29T05:37:04.465Z","stream":"stdout","message":"{\"ts\":\"2020-07-29T05:37:04.465+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"62e2d31dcb80d736173fb7e85934038ac76ec61c312962d9634bd58d365f0c62","name":"kkm-commutator_service.1.2pbd7jxr2c7wllzbjwsph1jut","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"2pbd7jxr2c7wllzbjwsph1jut","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.2pbd7jxr2c7wllzbjwsph1jut","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":774748,"file":{"path":"/var/lib/docker/containers/62e2d31dcb80d736173fb7e85934038ac76ec61c312962d9634bd58d365f0c62/62e2d31dcb80d736173fb7e85934038ac76ec61c312962d9634bd58d365f0c62-json.log"}},"input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"TfwVmXMBfrYj4vM9QrzI","_score":5.378802,"_source":{"@timestamp":"2020-07-29T05:39:29.651Z","log":{"offset":774726,"file":{"path":"/var/lib/docker/containers/9d280eb0a36e4977eabf56abd3c9c5ffb708b06d0d6538bafa1fa41060ad38ea/9d280eb0a36e4977eabf56abd3c9c5ffb708b06d0d6538bafa1fa41060ad38ea-json.log"}},"message":"{\"ts\":\"2020-07-29T05:39:29.651+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_id":"m7ssfcwmousg94nnggw1yhb7u","com_docker_swarm_task_name":"kkm-commutator_service.1.m7ssfcwmousg94nnggw1yhb7u","Version":"97"}}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout","input":{"type":"container"},"container":{"id":"9d280eb0a36e4977eabf56abd3c9c5ffb708b06d0d6538bafa1fa41060ad38ea","name":"kkm-commutator_service.1.m7ssfcwmousg94nnggw1yhb7u","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"iLTul3MBfrYj4vM9J2qE","_score":3.7075574,"_source":{"@timestamp":"2020-07-29T00:17:09.132Z","message":"{\"ts\":\"2020-07-29T00:17:09.132+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"c08269c3925bea42\",\"spanId\":\"c08269c3925bea42\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c08269c3925bea42\",\"X-B3-TraceId\":\"c08269c3925bea42\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":41901711,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}},"stream":"stdout","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp"},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"QrTul3MBfrYj4vM9fXF2","_score":3.7075574,"_source":{"@timestamp":"2020-07-29T00:17:31.137Z","container":{"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp"}}},"host":{"name":"25805977eece"},"stream":"stdout","message":"{\"ts\":\"2020-07-29T00:17:31.137+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"6dee41e4d13328a5\",\"spanId\":\"6dee41e4d13328a5\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"6dee41e4d13328a5\",\"X-B3-TraceId\":\"6dee41e4d13328a5\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","ecs":{"version":"1.0.1"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"log":{"offset":41916611,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}},"input":{"type":"container"}}}]}}
1200254 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1200280 [main] INFO  kkm.UnitTests - End test

1200282 [main] INFO  kkm.UnitTests - Starting test: KKM_DB8()
1200426 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Ume2KIvJd9lE', '1535527239', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Ume2KIvJd9lE','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Ume2KIvJd9lE', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Ume2KIvJd9lE', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-Ume2KIvJd9lE'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-Ume2KIvJd9lE'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-Ume2KIvJd9lE'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-Ume2KIvJd9lE'
1311234 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-Ume2KIvJd9lE'
1311234 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-Ume2KIvJd9lE, null]
1311235 [main] INFO  kkm.UnitTests - Status: null
1311235 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1311235 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1331236 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1331436 [main] INFO  kkm.UnitTests - Response message : {"took":148,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":923,"relation":"eq"},"max_score":5.3777742,"hits":[{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"rf0XmXMBfrYj4vM9eFm9","_score":5.3777742,"_source":{"@timestamp":"2020-07-29T05:41:54.776Z","stream":"stdout","container":{"id":"10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91","name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task_id":"wsunza2qrd02kzp8b2jcnhwz4","com_docker_swarm_task_name":"kkm-commutator_service.1.wsunza2qrd02kzp8b2jcnhwz4","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-29T05:41:54.776+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","log":{"file":{"path":"/var/lib/docker/containers/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91/10e6876b18b8cce75cad33d2b0cccefca9937167396c219db5512a76c2104a91-json.log"},"offset":774733},"input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"B_sTmXMBfrYj4vM9CvsN","_score":5.3777742,"_source":{"@timestamp":"2020-07-29T05:37:04.465Z","stream":"stdout","message":"{\"ts\":\"2020-07-29T05:37:04.465+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"62e2d31dcb80d736173fb7e85934038ac76ec61c312962d9634bd58d365f0c62","name":"kkm-commutator_service.1.2pbd7jxr2c7wllzbjwsph1jut","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"2pbd7jxr2c7wllzbjwsph1jut","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.2pbd7jxr2c7wllzbjwsph1jut","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":774748,"file":{"path":"/var/lib/docker/containers/62e2d31dcb80d736173fb7e85934038ac76ec61c312962d9634bd58d365f0c62/62e2d31dcb80d736173fb7e85934038ac76ec61c312962d9634bd58d365f0c62-json.log"}},"input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"TfwVmXMBfrYj4vM9QrzI","_score":5.3777742,"_source":{"@timestamp":"2020-07-29T05:39:29.651Z","log":{"offset":774726,"file":{"path":"/var/lib/docker/containers/9d280eb0a36e4977eabf56abd3c9c5ffb708b06d0d6538bafa1fa41060ad38ea/9d280eb0a36e4977eabf56abd3c9c5ffb708b06d0d6538bafa1fa41060ad38ea-json.log"}},"message":"{\"ts\":\"2020-07-29T05:39:29.651+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_id":"m7ssfcwmousg94nnggw1yhb7u","com_docker_swarm_task_name":"kkm-commutator_service.1.m7ssfcwmousg94nnggw1yhb7u","Version":"97"}}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout","input":{"type":"container"},"container":{"id":"9d280eb0a36e4977eabf56abd3c9c5ffb708b06d0d6538bafa1fa41060ad38ea","name":"kkm-commutator_service.1.m7ssfcwmousg94nnggw1yhb7u","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"iLTul3MBfrYj4vM9J2qE","_score":3.7069144,"_source":{"@timestamp":"2020-07-29T00:17:09.132Z","message":"{\"ts\":\"2020-07-29T00:17:09.132+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"c08269c3925bea42\",\"spanId\":\"c08269c3925bea42\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c08269c3925bea42\",\"X-B3-TraceId\":\"c08269c3925bea42\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":41901711,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}},"stream":"stdout","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp"},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.29","_type":"_doc","_id":"QrTul3MBfrYj4vM9fXF2","_score":3.7069144,"_source":{"@timestamp":"2020-07-29T00:17:31.137Z","container":{"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp"}}},"host":{"name":"25805977eece"},"stream":"stdout","message":"{\"ts\":\"2020-07-29T00:17:31.137+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"6dee41e4d13328a5\",\"spanId\":\"6dee41e4d13328a5\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"6dee41e4d13328a5\",\"X-B3-TraceId\":\"6dee41e4d13328a5\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","ecs":{"version":"1.0.1"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"log":{"offset":41916611,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}},"input":{"type":"container"}}}]}}
1331609 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
1331631 [main] INFO  kkm.UnitTests - End test

1331632 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageWasCanceled()
1334285 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/d7e1bcfb-e616-4500-aff3-67696887b862/messages/email/EPolikarpova@VSK.RU
1334285 [main] INFO  kkm.UnitTests - Response Code : 400
1334286 [main] INFO  kkm.UnitTests - {"checkId":"d7e1bcfb-e616-4500-aff3-67696887b862","error":{"code":"CHECK_WAS_CANCELLED","message":"Receipt was already cancelled"}}
1334286 [main] INFO  kkm.UnitTests - End test

1334288 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceleNotFound()
1334316 [main] INFO  kkm.UnitTests - End test

1334317 [main] INFO  kkm.UnitTests - Starting test: KKM_makeAndCancelCheckCashier()
1576824 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.29/_search?q=%20message:%20%22CID=d20c2915-da5e-41a6-b36f-32b91771fc7e2%22%20
1576923 [main] INFO  kkm.UnitTests - Response message : {"took":17,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":59.293167,"hits":[{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"bDWHmXMBfrYj4vM9qNPW","_score":59.293167,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":746066,"@timestamp":"2020-07-29T07:44:15.934Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-29T10:44:15,934","thread":"qtp524044206-7071","message":"KkmService: REST request  Operation 'CancelReceipt' was call with body: c56ae00c-bc9f-45b7-b67b-53ba254e9811 | exid=ID-esb-stage-42112-1596001282592-55-9987 CID=d20c2915-da5e-41a6-b36f-32b91771fc7e2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"dzWHmXMBfrYj4vM94OxJ","_score":56.602295,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":750187,"@timestamp":"2020-07-29T07:44:15.989Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-29T10:44:15,989","thread":"qtp524044206-7071","message":"KkmService: REST response Operation 'CancelReceipt' was complete with body: CancelReceiptResponse{correlationId='null', checkId='c56ae00c-bc9f-45b7-b67b-53ba254e9811', canceledCheckId='ff0b44b1-5ae5-400e-adc9-f6abf8bde9ee', error=null} | exid=ID-esb-stage-42112-1596001282592-55-9987 CID=d20c2915-da5e-41a6-b36f-32b91771fc7e2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"vjWHmXMBfrYj4vM9qdSD","_score":55.346413,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":745589,"beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"@timestamp":"2020-07-29T07:44:15.934Z","timestamp":"2020-07-29T10:44:15,934","thread":"qtp524044206-7071","message":"KkmService: REST request  Operation 'CancelReceipt' was call with headers: {breadcrumbId=ID-esb-stage-42112-1596001282592-55-9986, JMSCorrelationID=d20c2915-da5e-41a6-b36f-32b91771fc7e2, operationName=CancelReceipt, X-VSK-CorrelationId=d20c2915-da5e-41a6-b36f-32b91771fc7e2} | exid=ID-esb-stage-42112-1596001282592-55-9987 CID=d20c2915-da5e-41a6-b36f-32b91771fc7e2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"oDWHmXMBfrYj4vM9qdWM","_score":52.62209,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":746377,"@timestamp":"2020-07-29T07:44:15.934Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-29T10:44:15,934","thread":"thread #1826 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-42112-1596001282592-55-9986, CamelHttpMethod=PUT, JMSCorrelationID=d20c2915-da5e-41a6-b36f-32b91771fc7e2, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/c56ae00c-bc9f-45b7-b67b-53ba254e9811/cancel, X-VSK-CorrelationId=d20c2915-da5e-41a6-b36f-32b91771fc7e2} | exId=ID-esb-stage-42112-1596001282592-55-9989 CID=d20c2915-da5e-41a6-b36f-32b91771fc7e2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"TjWHmXMBfrYj4vM9qdRT","_score":51.182453,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":746988,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-29T07:44:15.934Z","timestamp":"2020-07-29T10:44:15,934","thread":"thread #1826 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-42112-1596001282592-55-9986, CamelHttpMethod=PUT, JMSCorrelationID=d20c2915-da5e-41a6-b36f-32b91771fc7e2, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/c56ae00c-bc9f-45b7-b67b-53ba254e9811/cancel, X-VSK-CorrelationId=d20c2915-da5e-41a6-b36f-32b91771fc7e2} | exId=ID-esb-stage-42112-1596001282592-55-9989 CID=d20c2915-da5e-41a6-b36f-32b91771fc7e2 |\n c56ae00c-bc9f-45b7-b67b-53ba254e9811","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"vzWHmXMBfrYj4vM9qdSD","_score":47.90593,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":749362,"@timestamp":"2020-07-29T07:44:15.989Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-29T10:44:15,989","thread":"qtp524044206-7071","message":"KkmService: REST response Operation 'CancelReceipt' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-42112-1596001282592-55-9986, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Wed, 29 Jul 2020 07:44:16 GMT, JMSCorrelationID=d20c2915-da5e-41a6-b36f-32b91771fc7e2, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/c56ae00c-bc9f-45b7-b67b-53ba254e9811/cancel, X-VSK-CorrelationId=d20c2915-da5e-41a6-b36f-32b91771fc7e2} | exid=ID-esb-stage-42112-1596001282592-55-9987 CID=d20c2915-da5e-41a6-b36f-32b91771fc7e2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"KzWHmXMBfrYj4vM9qdWF","_score":47.90593,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":747639,"@timestamp":"2020-07-29T07:44:15.989Z","beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"timestamp":"2020-07-29T10:44:15,989","thread":"thread #1826 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-42112-1596001282592-55-9986, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Wed, 29 Jul 2020 07:44:16 GMT, JMSCorrelationID=d20c2915-da5e-41a6-b36f-32b91771fc7e2, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/c56ae00c-bc9f-45b7-b67b-53ba254e9811/cancel, X-VSK-CorrelationId=d20c2915-da5e-41a6-b36f-32b91771fc7e2} | exid=ID-esb-stage-42112-1596001282592-55-9989 CID=d20c2915-da5e-41a6-b36f-32b91771fc7e2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.29","_type":"_doc","_id":"5TWHmXMBfrYj4vM9qNPl","_score":46.709846,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"offset":748445,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-29T07:44:15.989Z","timestamp":"2020-07-29T10:44:15,989","thread":"thread #1826 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-42112-1596001282592-55-9986, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Wed, 29 Jul 2020 07:44:16 GMT, JMSCorrelationID=d20c2915-da5e-41a6-b36f-32b91771fc7e2, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/c56ae00c-bc9f-45b7-b67b-53ba254e9811/cancel, X-VSK-CorrelationId=d20c2915-da5e-41a6-b36f-32b91771fc7e2} | exid=ID-esb-stage-42112-1596001282592-55-9989 CID=d20c2915-da5e-41a6-b36f-32b91771fc7e2 |\n {\"checkId\":\"c56ae00c-bc9f-45b7-b67b-53ba254e9811\",\"canceledCheckId\":\"ff0b44b1-5ae5-400e-adc9-f6abf8bde9ee\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27766","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
1576924 [main] INFO  kkm.UnitTests - End test

1576927 [main] INFO  kkm.UnitTests - Starting test: KKM_SIPheckStatus()
1579550 [main] INFO  kkm.UnitTests - End test

1579553 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageNotFound()
1579589 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/fa23215b-6994-43db-88dd-fa3a1dc0dfb6/messages/email/EPolikarpova@VSK.RU
1579589 [main] INFO  kkm.UnitTests - Response Code : 400
1579590 [main] INFO  kkm.UnitTests - {"checkId":"fa23215b-6994-43db-88dd-fa3a1dc0dfb6","error":{"code":"RECEIPT_NOTE_FOUND","message":"Receipt with specified ID not found"}}
1579590 [main] INFO  kkm.UnitTests - End test

1579592 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt_negative()
1579675 [main] INFO  kkm.UnitTests - End test

1579677 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt()
1583462 [main] INFO  kkm.UnitTests - End test

