306  [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckNoCashier()
5008 [main] INFO  kkm.UnitTests - End test

5021 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageEmail()
277788 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-test-2020.07.27/_search?q=%20message:%20%22CID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211%22%20
277947 [main] INFO  kkm.UnitTests - Response message : {"took":61,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":36.838306,"hits":[{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"Om2ojnMBtD96ebe8xpL3","_score":36.838306,"_source":{"level":"trace","@timestamp":"2020-07-27T05:04:32.902Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST response Operation 'SendMessage' was complete with body: ReceiptResponse{correlationId='null', checkId='1f2392ce-0516-4ce4-8855-b93764dc24a1', error=null} | exid=ID-esb-test01-44636-1595582182562-71-2457 CID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211","thread":"qtp1519322088-251262","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:04:32,902","input":{"type":"log"},"offset":923632,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"722ojnMBtD96ebe8jI2L","_score":36.727745,"_source":{"level":"trace","@timestamp":"2020-07-27T05:04:32.880Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST request  Operation 'SendMessage' was call with body: SendMessageRequest{checkId='1f2392ce-0516-4ce4-8855-b93764dc24a1', messageType='email', messageAddress='EPolikarpova@VSK.RU'} | exid=ID-esb-test01-44636-1595582182562-71-2457 CID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211","thread":"qtp1519322088-251262","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:04:32,880","input":{"type":"log"},"offset":919286,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"7W2ojnMBtD96ebe8jI2L","_score":35.55397,"_source":{"level":"debug","@timestamp":"2020-07-27T05:04:32.880Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST request  Operation 'SendMessage' was call with headers: {breadcrumbId=ID-esb-test01-44636-1595582182562-71-2456, JMSCorrelationID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211, operationName=SendMessage, X-VSK-CorrelationId=0eae4a4f-2277-4363-a1f8-7b7afba88e8211} | exid=ID-esb-test01-44636-1595582182562-71-2457 CID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211","thread":"qtp1519322088-251262","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:04:32,880","input":{"type":"log"},"offset":918808,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"8G2ojnMBtD96ebe8jI2L","_score":33.787045,"_source":{"level":"debug","@timestamp":"2020-07-27T05:04:32.881Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-test01-44636-1595582182562-71-2456, CamelHttpMethod=GET, JMSCorrelationID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211, operationName=SendMessage, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/1f2392ce-0516-4ce4-8855-b93764dc24a1/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=0eae4a4f-2277-4363-a1f8-7b7afba88e8211} | exId=ID-esb-test01-44636-1595582182562-71-2459 CID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211","thread":"thread #4031 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:04:32,881","input":{"type":"log"},"offset":919686,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"8W2ojnMBtD96ebe8jI2L","_score":33.787045,"_source":{"level":"trace","@timestamp":"2020-07-27T05:04:32.881Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-test01-44636-1595582182562-71-2456, CamelHttpMethod=GET, JMSCorrelationID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211, operationName=SendMessage, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/1f2392ce-0516-4ce4-8855-b93764dc24a1/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=0eae4a4f-2277-4363-a1f8-7b7afba88e8211} | exId=ID-esb-test01-44636-1595582182562-71-2459 CID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211 |\n ","thread":"thread #4031 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"@version":"1","environment":"test","timestamp":"2020-07-27T08:04:32,881","input":{"type":"log"},"offset":920317,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"8m2ojnMBtD96ebe8jI2L","_score":31.04427,"_source":{"level":"debug","@timestamp":"2020-07-27T05:04:32.901Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-44636-1595582182562-71-2456, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 05:04:32 GMT, JMSCorrelationID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/1f2392ce-0516-4ce4-8855-b93764dc24a1/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=0eae4a4f-2277-4363-a1f8-7b7afba88e8211} | exid=ID-esb-test01-44636-1595582182562-71-2459 CID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211","thread":"thread #4031 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:04:32,901","input":{"type":"log"},"offset":920952,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"9G2ojnMBtD96ebe8jI2L","_score":31.04427,"_source":{"level":"debug","@timestamp":"2020-07-27T05:04:32.902Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST response Operation 'SendMessage' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-44636-1595582182562-71-2456, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 05:04:32 GMT, JMSCorrelationID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/1f2392ce-0516-4ce4-8855-b93764dc24a1/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=0eae4a4f-2277-4363-a1f8-7b7afba88e8211} | exid=ID-esb-test01-44636-1595582182562-71-2457 CID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211","thread":"qtp1519322088-251262","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:04:32,902","input":{"type":"log"},"offset":922744,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"822ojnMBtD96ebe8jI2L","_score":30.426771,"_source":{"level":"trace","@timestamp":"2020-07-27T05:04:32.902Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-44636-1595582182562-71-2456, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 05:04:32 GMT, JMSCorrelationID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/1f2392ce-0516-4ce4-8855-b93764dc24a1/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=0eae4a4f-2277-4363-a1f8-7b7afba88e8211} | exid=ID-esb-test01-44636-1595582182562-71-2459 CID=0eae4a4f-2277-4363-a1f8-7b7afba88e8211 |\n {\"checkId\":\"1f2392ce-0516-4ce4-8855-b93764dc24a1\"}","thread":"thread #4031 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"@version":"1","environment":"test","timestamp":"2020-07-27T08:04:32,902","input":{"type":"log"},"offset":921821,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}}]}}
277949 [main] INFO  kkm.UnitTests - End test

277952 [main] INFO  kkm.UnitTests - Starting test: KKM_WAcheckStatus()
279920 [main] INFO  kkm.UnitTests - End test

279923 [main] INFO  kkm.UnitTests - Starting test: KKM_getStatus()
284414 [main] INFO  kkm.UnitTests - End test

284417 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceledAlredy()
287525 [main] INFO  kkm.UnitTests - End test

287529 [main] INFO  kkm.UnitTests - Starting test: KKM_getDocCustomer()
287807 [main] INFO  kkm.UnitTests - End test

287810 [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckCashier()
305860 [main] INFO  kkm.UnitTests - End test

305864 [main] INFO  kkm.UnitTests - Starting test: KKM_DB1()
306570 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
306576 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000902849
306577 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000902849
307144 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000902849'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000902849'
select * from ProcessStatus where srcID = 'ЖПлато_000902849'
307146 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000902849]
307149 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000902849]
367426 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000902849'
367426 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000902849]
427441 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000902849%22%20&size=500
427557 [main] INFO  kkm.UnitTests - Response message : {"took":37,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":11.311498,"hits":[{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"um6tjnMBtD96ebe8UFOE","_score":11.311498,"_source":{"@timestamp":"2020-07-27T05:09:49.868Z","agent":{"id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a"},"ecs":{"version":"1.0.1"},"json":{"thread":"scheduling-1","spanId":"26e0991598889782","ts":"2020-07-27T05:09:49.866+00:00","level":"INFO","traceId":"26e0991598889782","X-B3-SpanId":"26e0991598889782","X-VSK-ReceiptKeys":[{"srcID":"ЖПлато_000902849","systemCode":"AXAPTA","entityCode":"PaymentOrder"}],"class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","caller_file_name":"KkmCommutatorService.java","spanExportable":"true","X-Span-Export":"true","msg":"ReadyForSendingReceiptKeys selected ","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_line_number":84,"X-B3-TraceId":"26e0991598889782"},"stream":"stdout","container":{"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"44fcff07405a"},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_task":"","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn"}}},"log":{"offset":91747021,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"message":"{\"ts\":\"2020-07-27T05:09:49.866+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"26e0991598889782\",\"spanId\":\"26e0991598889782\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"26e0991598889782\",\"X-B3-TraceId\":\"26e0991598889782\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000902849\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"}}}]}}
427559 [main] INFO  kkm.UnitTests - End test

427563 [main] INFO  kkm.UnitTests - Starting test: KKM_DB2()
427707 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
427707 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
427711 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
428403 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
428404 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
428406 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
488695 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
488695 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, DONE, nothing, ЖПлато_000898541]
548700 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
548761 [main] INFO  kkm.UnitTests - Response message : {"took":9,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":10.581424,"hits":[{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"xG6vjnMBtD96ebe8MdYT","_score":10.581424,"_source":{"@timestamp":"2020-07-27T05:11:49.823Z","log":{"offset":91811962,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T05:11:49.823+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"c22fb3325e879858\",\"spanId\":\"c22fb3325e879858\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c22fb3325e879858\",\"X-B3-TraceId\":\"c22fb3325e879858\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","Version":"97"}}},"json":{"caller_file_name":"KkmCommutatorService.java","X-Span-Export":"true","spanId":"c22fb3325e879858","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_line_number":84,"thread":"scheduling-1","traceId":"c22fb3325e879858","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000898541"}],"ts":"2020-07-27T05:11:49.823+00:00","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","spanExportable":"true","X-B3-SpanId":"c22fb3325e879858","X-B3-TraceId":"c22fb3325e879858","msg":"ReadyForSendingReceiptKeys selected ","level":"INFO"}}}]}}
548762 [main] INFO  kkm.UnitTests - End test

548766 [main] INFO  kkm.UnitTests - Starting test: KKM_DB3()
548906 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-y5NbZvuX8UyF', '2558153411', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-y5NbZvuX8UyF','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-y5NbZvuX8UyF', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-y5NbZvuX8UyF', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-y5NbZvuX8UyF'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-y5NbZvuX8UyF'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-y5NbZvuX8UyF'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-y5NbZvuX8UyF'
659950 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-y5NbZvuX8UyF'
659951 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, SENDED, , , 9SD0C9DZ-9289-4A09-y5NbZvuX8UyF, 647bf97b-b73e-431a-b375-ce3358c4ff96]
659954 [main] INFO  kkm.UnitTests - Status: SENDED
659954 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
659955 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
680123 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-y5NbZvuX8UyF%22%20&size=500
680330 [main] INFO  kkm.UnitTests - Response message : {"took":96,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":0,"relation":"eq"},"max_score":null,"hits":[]}}
680482 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
680516 [main] INFO  kkm.UnitTests - End test

680563 [main] INFO  kkm.UnitTests - Starting test: KKM_DB4()
680694 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-W45E8l8R9TdT', '2174908996', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-W45E8l8R9TdT','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-W45E8l8R9TdT', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-W45E8l8R9TdT', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-W45E8l8R9TdT'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-W45E8l8R9TdT'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-W45E8l8R9TdT'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-W45E8l8R9TdT'
791688 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-W45E8l8R9TdT'
791689 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-W45E8l8R9TdT, 16d9a678-6feb-444a-b24f-7abf39f83be6]
791691 [main] INFO  kkm.UnitTests - Status: FAIL
791692 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
791692 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
812141 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-W45E8l8R9TdT%22%20&size=500
812352 [main] INFO  kkm.UnitTests - Response message : {"took":150,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":28.481838,"hits":[{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"NHCzjnMBtD96ebe8zEb2","_score":28.481838,"_source":{"@timestamp":"2020-07-27T05:16:49.798Z","json":{"logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","traceId":"93b7b7b820f2a727","method":"getReadyForSendingReceiptKeys","caller_file_name":"KkmCommutatorService.java","caller_line_number":84,"level":"INFO","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","spanExportable":"true","X-B3-SpanId":"93b7b7b820f2a727","X-B3-TraceId":"93b7b7b820f2a727","msg":"ReadyForSendingReceiptKeys selected ","ts":"2020-07-27T05:16:49.798+00:00","spanId":"93b7b7b820f2a727","X-Span-Export":"true","X-VSK-ReceiptKeys":[{"srcID":"9SD0C9DZ-9289-4A09-W45E8l8R9TdT","systemCode":"ADINSURE","entityCode":"Payment"}]},"stream":"stdout","message":"{\"ts\":\"2020-07-27T05:16:49.798+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"93b7b7b820f2a727\",\"spanId\":\"93b7b7b820f2a727\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"93b7b7b820f2a727\",\"X-B3-TraceId\":\"93b7b7b820f2a727\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-W45E8l8R9TdT\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"agent":{"hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc"},"log":{"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"},"offset":92011572},"input":{"type":"container"},"container":{"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Version":"97","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator"}}}}}]}}
812481 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
812505 [main] INFO  kkm.UnitTests - End test

812508 [main] INFO  kkm.UnitTests - Starting test: KKM_DB5()
812631 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw', '4297350772', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw'
923640 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw'
923641 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw, 3e14df98-9a8b-402c-9671-e18ea5a11076]
923644 [main] INFO  kkm.UnitTests - Status: DONE
923644 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
923644 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
943737 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-DwUYgdJ1VcAw%22%20&size=500
943823 [main] INFO  kkm.UnitTests - Response message : {"took":25,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":25.746899,"hits":[{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"zHC1jnMBtD96ebe8lnAZ","_score":25.746899,"_source":{"@timestamp":"2020-07-27T05:18:49.360Z","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Description":"KKM Commutator Service","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","Version":"97"}}},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"json":{"ts":"2020-07-27T05:18:49.360+00:00","method":"getReadyForSendingReceiptKeys","caller_file_name":"KkmCommutatorService.java","thread":"scheduling-1","traceId":"c74aa38757e9b89a","level":"INFO","X-B3-SpanId":"c74aa38757e9b89a","msg":"ReadyForSendingReceiptKeys selected ","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_line_number":84,"spanId":"c74aa38757e9b89a","X-VSK-ReceiptKeys":[{"systemCode":"ADINSURE","entityCode":"Payment","srcID":"9SD0C9DZ-9289-4A09-Msa4Iv6ICN8k"},{"systemCode":"ADINSURE","entityCode":"Payment","srcID":"9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw"}],"class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","spanExportable":"true","X-Span-Export":"true","X-B3-TraceId":"c74aa38757e9b89a"},"stream":"stdout","message":"{\"ts\":\"2020-07-27T05:18:49.360+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"c74aa38757e9b89a\",\"spanId\":\"c74aa38757e9b89a\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c74aa38757e9b89a\",\"X-B3-TraceId\":\"c74aa38757e9b89a\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-Msa4Iv6ICN8k\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-DwUYgdJ1VcAw\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","host":{"name":"44fcff07405a"},"log":{"offset":92088942,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"ecs":{"version":"1.0.1"}}}]}}
943956 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
943982 [main] INFO  kkm.UnitTests - End test

943984 [main] INFO  kkm.UnitTests - Starting test: KKM_DB6()
944113 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4UlWeqtgzluy', '5066259170', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4UlWeqtgzluy','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4UlWeqtgzluy', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4UlWeqtgzluy', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-4UlWeqtgzluy'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-4UlWeqtgzluy'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-4UlWeqtgzluy'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-4UlWeqtgzluy'
1055091 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-4UlWeqtgzluy'
1055091 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-4UlWeqtgzluy, null]
1055094 [main] INFO  kkm.UnitTests - Status: null
1055094 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1055094 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1075097 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1075212 [main] INFO  kkm.UnitTests - Response message : {"took":63,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":321,"relation":"eq"},"max_score":3.638728,"hits":[{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"aUCbjXMBtD96ebe8or6T","_score":3.638728,"_source":{"@timestamp":"2020-07-27T00:10:49.863Z","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Description":"KKM Commutator Service","com_docker_swarm_task":"","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_stack_namespace":"kkm-commutator"}}},"agent":{"id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a"},"log":{"offset":85100050,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"message":"{\"ts\":\"2020-07-27T00:10:49.863+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"78ab81cd08734626\",\"spanId\":\"78ab81cd08734626\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"78ab81cd08734626\",\"X-B3-TraceId\":\"78ab81cd08734626\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349"},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"spanId":"78ab81cd08734626","spanExportable":"true","level":"INFO","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","traceId":"78ab81cd08734626","msg":"ReadyForSendingReceiptKeys is EMPTY","ts":"2020-07-27T00:10:49.863+00:00","X-B3-TraceId":"78ab81cd08734626","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_line_number":82,"thread":"scheduling-1","X-Span-Export":"true","X-B3-SpanId":"78ab81cd08734626","caller_file_name":"KkmCommutatorService.java"}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"nD-XjXMBtD96ebe8-YQM","_score":3.638728,"_source":{"@timestamp":"2020-07-27T00:06:49.676Z","log":{"offset":85012930,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:06:49.676+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"8d19326d1a64143c\",\"spanId\":\"8d19326d1a64143c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8d19326d1a64143c\",\"X-B3-TraceId\":\"8d19326d1a64143c\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"json":{"method":"getReadyForSendingReceiptKeys","thread":"scheduling-1","X-B3-SpanId":"8d19326d1a64143c","X-B3-TraceId":"8d19326d1a64143c","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","spanExportable":"true","ts":"2020-07-27T00:06:49.676+00:00","caller_line_number":82,"X-Span-Export":"true","level":"INFO","spanId":"8d19326d1a64143c","msg":"ReadyForSendingReceiptKeys is EMPTY","traceId":"8d19326d1a64143c"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"Yz6WjXMBtD96ebe8JNlF","_score":3.638728,"_source":{"@timestamp":"2020-07-27T00:04:49.795Z","host":{"name":"44fcff07405a"},"json":{"logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","spanId":"be2f69405a2a38c0","msg":"ReadyForSendingReceiptKeys is EMPTY","ts":"2020-07-27T00:04:49.795+00:00","method":"getReadyForSendingReceiptKeys","X-B3-SpanId":"be2f69405a2a38c0","level":"INFO","traceId":"be2f69405a2a38c0","spanExportable":"true","X-Span-Export":"true","caller_file_name":"KkmCommutatorService.java","caller_line_number":82,"X-B3-TraceId":"be2f69405a2a38c0","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService"},"log":{"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"},"offset":84969373},"message":"{\"ts\":\"2020-07-27T00:04:49.795+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"be2f69405a2a38c0\",\"spanId\":\"be2f69405a2a38c0\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"be2f69405a2a38c0\",\"X-B3-TraceId\":\"be2f69405a2a38c0\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"stream":"stdout","docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"2kCZjXMBtD96ebe8zSbO","_score":3.638728,"_source":{"@timestamp":"2020-07-27T00:08:49.698Z","message":"{\"ts\":\"2020-07-27T00:08:49.698+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"53340c91439d4923\",\"spanId\":\"53340c91439d4923\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"53340c91439d4923\",\"X-B3-TraceId\":\"53340c91439d4923\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"log":{"offset":85056491,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"caller_line_number":82,"traceId":"53340c91439d4923","X-Span-Export":"true","X-B3-SpanId":"53340c91439d4923","method":"getReadyForSendingReceiptKeys","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","spanId":"53340c91439d4923","level":"INFO","X-B3-TraceId":"53340c91439d4923","msg":"ReadyForSendingReceiptKeys is EMPTY","caller_file_name":"KkmCommutatorService.java","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","spanExportable":"true","ts":"2020-07-27T00:08:49.698+00:00"},"input":{"type":"container"},"container":{"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"jT6UjXMBtD96ebe8T3J9","_score":3.638728,"_source":{"@timestamp":"2020-07-27T00:02:49.735Z","message":"{\"ts\":\"2020-07-27T00:02:49.735+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"20201fb71c08eaef\",\"spanId\":\"20201fb71c08eaef\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"20201fb71c08eaef\",\"X-B3-TraceId\":\"20201fb71c08eaef\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"json":{"spanExportable":"true","X-B3-SpanId":"20201fb71c08eaef","level":"INFO","caller_file_name":"KkmCommutatorService.java","caller_line_number":82,"X-Span-Export":"true","ts":"2020-07-27T00:02:49.735+00:00","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","traceId":"20201fb71c08eaef","spanId":"20201fb71c08eaef","X-B3-TraceId":"20201fb71c08eaef","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","msg":"ReadyForSendingReceiptKeys is EMPTY"},"log":{"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"},"offset":84925821},"input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Version":"97","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"stream":"stdout"}}]}}
1075345 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
1075368 [main] INFO  kkm.UnitTests - End test

1075369 [main] INFO  kkm.UnitTests - Starting test: KKM_DB7()
1075498 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-U9iLIWWDpEIK', '9342638646', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-U9iLIWWDpEIK','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-U9iLIWWDpEIK', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-U9iLIWWDpEIK', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-U9iLIWWDpEIK'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-U9iLIWWDpEIK'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-U9iLIWWDpEIK'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-U9iLIWWDpEIK'
1186491 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-U9iLIWWDpEIK'
1186491 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-U9iLIWWDpEIK, null]
1186494 [main] INFO  kkm.UnitTests - Status: null
1186494 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1186495 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1206499 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1206606 [main] INFO  kkm.UnitTests - Response message : {"took":53,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":323,"relation":"eq"},"max_score":3.6386006,"hits":[{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"aUCbjXMBtD96ebe8or6T","_score":3.6386006,"_source":{"@timestamp":"2020-07-27T00:10:49.863Z","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Description":"KKM Commutator Service","com_docker_swarm_task":"","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_stack_namespace":"kkm-commutator"}}},"agent":{"id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a"},"log":{"offset":85100050,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"message":"{\"ts\":\"2020-07-27T00:10:49.863+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"78ab81cd08734626\",\"spanId\":\"78ab81cd08734626\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"78ab81cd08734626\",\"X-B3-TraceId\":\"78ab81cd08734626\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349"},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"spanId":"78ab81cd08734626","spanExportable":"true","level":"INFO","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","traceId":"78ab81cd08734626","msg":"ReadyForSendingReceiptKeys is EMPTY","ts":"2020-07-27T00:10:49.863+00:00","X-B3-TraceId":"78ab81cd08734626","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_line_number":82,"thread":"scheduling-1","X-Span-Export":"true","X-B3-SpanId":"78ab81cd08734626","caller_file_name":"KkmCommutatorService.java"}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"nD-XjXMBtD96ebe8-YQM","_score":3.6386006,"_source":{"@timestamp":"2020-07-27T00:06:49.676Z","log":{"offset":85012930,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:06:49.676+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"8d19326d1a64143c\",\"spanId\":\"8d19326d1a64143c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8d19326d1a64143c\",\"X-B3-TraceId\":\"8d19326d1a64143c\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"json":{"method":"getReadyForSendingReceiptKeys","thread":"scheduling-1","X-B3-SpanId":"8d19326d1a64143c","X-B3-TraceId":"8d19326d1a64143c","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","spanExportable":"true","ts":"2020-07-27T00:06:49.676+00:00","caller_line_number":82,"X-Span-Export":"true","level":"INFO","spanId":"8d19326d1a64143c","msg":"ReadyForSendingReceiptKeys is EMPTY","traceId":"8d19326d1a64143c"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"Yz6WjXMBtD96ebe8JNlF","_score":3.6386006,"_source":{"@timestamp":"2020-07-27T00:04:49.795Z","host":{"name":"44fcff07405a"},"json":{"logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","spanId":"be2f69405a2a38c0","msg":"ReadyForSendingReceiptKeys is EMPTY","ts":"2020-07-27T00:04:49.795+00:00","method":"getReadyForSendingReceiptKeys","X-B3-SpanId":"be2f69405a2a38c0","level":"INFO","traceId":"be2f69405a2a38c0","spanExportable":"true","X-Span-Export":"true","caller_file_name":"KkmCommutatorService.java","caller_line_number":82,"X-B3-TraceId":"be2f69405a2a38c0","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService"},"log":{"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"},"offset":84969373},"message":"{\"ts\":\"2020-07-27T00:04:49.795+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"be2f69405a2a38c0\",\"spanId\":\"be2f69405a2a38c0\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"be2f69405a2a38c0\",\"X-B3-TraceId\":\"be2f69405a2a38c0\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"stream":"stdout","docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"2kCZjXMBtD96ebe8zSbO","_score":3.6386006,"_source":{"@timestamp":"2020-07-27T00:08:49.698Z","message":"{\"ts\":\"2020-07-27T00:08:49.698+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"53340c91439d4923\",\"spanId\":\"53340c91439d4923\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"53340c91439d4923\",\"X-B3-TraceId\":\"53340c91439d4923\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"log":{"offset":85056491,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"caller_line_number":82,"traceId":"53340c91439d4923","X-Span-Export":"true","X-B3-SpanId":"53340c91439d4923","method":"getReadyForSendingReceiptKeys","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","spanId":"53340c91439d4923","level":"INFO","X-B3-TraceId":"53340c91439d4923","msg":"ReadyForSendingReceiptKeys is EMPTY","caller_file_name":"KkmCommutatorService.java","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","spanExportable":"true","ts":"2020-07-27T00:08:49.698+00:00"},"input":{"type":"container"},"container":{"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"jT6UjXMBtD96ebe8T3J9","_score":3.6386006,"_source":{"@timestamp":"2020-07-27T00:02:49.735Z","message":"{\"ts\":\"2020-07-27T00:02:49.735+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"20201fb71c08eaef\",\"spanId\":\"20201fb71c08eaef\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"20201fb71c08eaef\",\"X-B3-TraceId\":\"20201fb71c08eaef\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"json":{"spanExportable":"true","X-B3-SpanId":"20201fb71c08eaef","level":"INFO","caller_file_name":"KkmCommutatorService.java","caller_line_number":82,"X-Span-Export":"true","ts":"2020-07-27T00:02:49.735+00:00","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","traceId":"20201fb71c08eaef","spanId":"20201fb71c08eaef","X-B3-TraceId":"20201fb71c08eaef","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","msg":"ReadyForSendingReceiptKeys is EMPTY"},"log":{"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"},"offset":84925821},"input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Version":"97","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"stream":"stdout"}}]}}
1206738 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1206763 [main] INFO  kkm.UnitTests - End test

1206766 [main] INFO  kkm.UnitTests - Starting test: KKM_DB8()
1206904 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-vUjIFHuYRoko', '2909917157', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-vUjIFHuYRoko','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-vUjIFHuYRoko', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-vUjIFHuYRoko', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-vUjIFHuYRoko'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-vUjIFHuYRoko'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-vUjIFHuYRoko'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-vUjIFHuYRoko'
1317790 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-vUjIFHuYRoko'
1317791 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-vUjIFHuYRoko, null]
1317794 [main] INFO  kkm.UnitTests - Status: null
1317794 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1317794 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1337800 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1337860 [main] INFO  kkm.UnitTests - Response message : {"took":6,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":325,"relation":"eq"},"max_score":3.638408,"hits":[{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"aUCbjXMBtD96ebe8or6T","_score":3.638408,"_source":{"@timestamp":"2020-07-27T00:10:49.863Z","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Description":"KKM Commutator Service","com_docker_swarm_task":"","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_stack_namespace":"kkm-commutator"}}},"agent":{"id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a"},"log":{"offset":85100050,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"message":"{\"ts\":\"2020-07-27T00:10:49.863+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"78ab81cd08734626\",\"spanId\":\"78ab81cd08734626\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"78ab81cd08734626\",\"X-B3-TraceId\":\"78ab81cd08734626\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349"},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"spanId":"78ab81cd08734626","spanExportable":"true","level":"INFO","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","traceId":"78ab81cd08734626","msg":"ReadyForSendingReceiptKeys is EMPTY","ts":"2020-07-27T00:10:49.863+00:00","X-B3-TraceId":"78ab81cd08734626","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_line_number":82,"thread":"scheduling-1","X-Span-Export":"true","X-B3-SpanId":"78ab81cd08734626","caller_file_name":"KkmCommutatorService.java"}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"nD-XjXMBtD96ebe8-YQM","_score":3.638408,"_source":{"@timestamp":"2020-07-27T00:06:49.676Z","log":{"offset":85012930,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:06:49.676+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"8d19326d1a64143c\",\"spanId\":\"8d19326d1a64143c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8d19326d1a64143c\",\"X-B3-TraceId\":\"8d19326d1a64143c\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"json":{"method":"getReadyForSendingReceiptKeys","thread":"scheduling-1","X-B3-SpanId":"8d19326d1a64143c","X-B3-TraceId":"8d19326d1a64143c","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","spanExportable":"true","ts":"2020-07-27T00:06:49.676+00:00","caller_line_number":82,"X-Span-Export":"true","level":"INFO","spanId":"8d19326d1a64143c","msg":"ReadyForSendingReceiptKeys is EMPTY","traceId":"8d19326d1a64143c"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"Yz6WjXMBtD96ebe8JNlF","_score":3.638408,"_source":{"@timestamp":"2020-07-27T00:04:49.795Z","host":{"name":"44fcff07405a"},"json":{"logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","spanId":"be2f69405a2a38c0","msg":"ReadyForSendingReceiptKeys is EMPTY","ts":"2020-07-27T00:04:49.795+00:00","method":"getReadyForSendingReceiptKeys","X-B3-SpanId":"be2f69405a2a38c0","level":"INFO","traceId":"be2f69405a2a38c0","spanExportable":"true","X-Span-Export":"true","caller_file_name":"KkmCommutatorService.java","caller_line_number":82,"X-B3-TraceId":"be2f69405a2a38c0","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService"},"log":{"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"},"offset":84969373},"message":"{\"ts\":\"2020-07-27T00:04:49.795+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"be2f69405a2a38c0\",\"spanId\":\"be2f69405a2a38c0\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"be2f69405a2a38c0\",\"X-B3-TraceId\":\"be2f69405a2a38c0\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"stream":"stdout","docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"2kCZjXMBtD96ebe8zSbO","_score":3.638408,"_source":{"@timestamp":"2020-07-27T00:08:49.698Z","message":"{\"ts\":\"2020-07-27T00:08:49.698+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"53340c91439d4923\",\"spanId\":\"53340c91439d4923\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"53340c91439d4923\",\"X-B3-TraceId\":\"53340c91439d4923\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"log":{"offset":85056491,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"caller_line_number":82,"traceId":"53340c91439d4923","X-Span-Export":"true","X-B3-SpanId":"53340c91439d4923","method":"getReadyForSendingReceiptKeys","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","spanId":"53340c91439d4923","level":"INFO","X-B3-TraceId":"53340c91439d4923","msg":"ReadyForSendingReceiptKeys is EMPTY","caller_file_name":"KkmCommutatorService.java","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","spanExportable":"true","ts":"2020-07-27T00:08:49.698+00:00"},"input":{"type":"container"},"container":{"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}}}},{"_index":"kkm-commutator-test-2020.07.27","_type":"_doc","_id":"jT6UjXMBtD96ebe8T3J9","_score":3.638408,"_source":{"@timestamp":"2020-07-27T00:02:49.735Z","message":"{\"ts\":\"2020-07-27T00:02:49.735+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"20201fb71c08eaef\",\"spanId\":\"20201fb71c08eaef\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"20201fb71c08eaef\",\"X-B3-TraceId\":\"20201fb71c08eaef\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"json":{"spanExportable":"true","X-B3-SpanId":"20201fb71c08eaef","level":"INFO","caller_file_name":"KkmCommutatorService.java","caller_line_number":82,"X-Span-Export":"true","ts":"2020-07-27T00:02:49.735+00:00","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","traceId":"20201fb71c08eaef","spanId":"20201fb71c08eaef","X-B3-TraceId":"20201fb71c08eaef","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","msg":"ReadyForSendingReceiptKeys is EMPTY"},"log":{"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"},"offset":84925821},"input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Version":"97","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"stream":"stdout"}}]}}
1338000 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
1338026 [main] INFO  kkm.UnitTests - End test

1338033 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageWasCanceled()
1341173 [main] INFO  kkm.UnitTests - End test

1341176 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceleNotFound()
1341205 [main] INFO  kkm.UnitTests - End test

1341208 [main] INFO  kkm.UnitTests - Starting test: KKM_makeAndCancelCheckCashier()
1585765 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-test-2020.07.27/_search?q=%20message:%20%22CID=466c2d81-d445-4278-8816-45cfd537f6872%22%20
1585992 [main] INFO  kkm.UnitTests - Response message : {"took":45,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":34.35726,"hits":[{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"ZXG8jnMBtD96ebe8bu1s","_score":34.35726,"_source":{"level":"trace","@timestamp":"2020-07-27T05:26:20.912Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST request  Operation 'CancelReceipt' was call with body: 6c8e08d2-0d09-4454-901c-f54c5a437194 | exid=ID-esb-test01-44636-1595582182562-71-5342 CID=466c2d81-d445-4278-8816-45cfd537f6872","thread":"qtp1519322088-251262","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:26:20,912","input":{"type":"log"},"offset":4992792,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"93G8jnMBtD96ebe8qfIB","_score":32.94502,"_source":{"level":"trace","@timestamp":"2020-07-27T05:26:20.944Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST response Operation 'CancelReceipt' was complete with body: CancelReceiptResponse{correlationId='null', checkId='6c8e08d2-0d09-4454-901c-f54c5a437194', canceledCheckId='86af7643-aa04-4fc0-9fab-94ca28011cbc', error=null} | exid=ID-esb-test01-44636-1595582182562-71-5342 CID=466c2d81-d445-4278-8816-45cfd537f6872","thread":"qtp1519322088-251262","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:26:20,944","input":{"type":"log"},"offset":4996879,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"ZnG8jnMBtD96ebe8bu1s","_score":32.281555,"_source":{"level":"debug","@timestamp":"2020-07-27T05:26:20.912Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST request  Operation 'CancelReceipt' was call with headers: {breadcrumbId=ID-esb-test01-44636-1595582182562-71-5341, JMSCorrelationID=466c2d81-d445-4278-8816-45cfd537f6872, operationName=CancelReceipt, X-VSK-CorrelationId=466c2d81-d445-4278-8816-45cfd537f6872} | exid=ID-esb-test01-44636-1595582182562-71-5342 CID=466c2d81-d445-4278-8816-45cfd537f6872","thread":"qtp1519322088-251262","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:26:20,912","input":{"type":"log"},"offset":4992313,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"enG8jnMBtD96ebe8bu11","_score":30.832735,"_source":{"level":"debug","@timestamp":"2020-07-27T05:26:20.912Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-test01-44636-1595582182562-71-5341, CamelHttpMethod=PUT, JMSCorrelationID=466c2d81-d445-4278-8816-45cfd537f6872, operationName=CancelReceipt, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/6c8e08d2-0d09-4454-901c-f54c5a437194/cancel, X-VSK-CorrelationId=466c2d81-d445-4278-8816-45cfd537f6872} | exId=ID-esb-test01-44636-1595582182562-71-5344 CID=466c2d81-d445-4278-8816-45cfd537f6872","thread":"thread #4038 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:26:20,912","input":{"type":"log"},"offset":4993104,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"cXG8jnMBtD96ebe8bu10","_score":30.061768,"_source":{"level":"trace","@timestamp":"2020-07-27T05:26:20.912Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-test01-44636-1595582182562-71-5341, CamelHttpMethod=PUT, JMSCorrelationID=466c2d81-d445-4278-8816-45cfd537f6872, operationName=CancelReceipt, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/6c8e08d2-0d09-4454-901c-f54c5a437194/cancel, X-VSK-CorrelationId=466c2d81-d445-4278-8816-45cfd537f6872} | exId=ID-esb-test01-44636-1595582182562-71-5344 CID=466c2d81-d445-4278-8816-45cfd537f6872 |\n 6c8e08d2-0d09-4454-901c-f54c5a437194","thread":"thread #4038 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"@version":"1","environment":"test","timestamp":"2020-07-27T08:26:20,912","input":{"type":"log"},"offset":4993708,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"Z3G8jnMBtD96ebe8bu1s","_score":28.293102,"_source":{"level":"debug","@timestamp":"2020-07-27T05:26:20.944Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST response Operation 'CancelReceipt' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-44636-1595582182562-71-5341, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 05:26:20 GMT, JMSCorrelationID=466c2d81-d445-4278-8816-45cfd537f6872, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/6c8e08d2-0d09-4454-901c-f54c5a437194/cancel, X-VSK-CorrelationId=466c2d81-d445-4278-8816-45cfd537f6872} | exid=ID-esb-test01-44636-1595582182562-71-5342 CID=466c2d81-d445-4278-8816-45cfd537f6872","thread":"qtp1519322088-251262","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:26:20,944","input":{"type":"log"},"offset":4996061,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"bHG8jnMBtD96ebe8bu1z","_score":28.293102,"_source":{"level":"debug","@timestamp":"2020-07-27T05:26:20.944Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-44636-1595582182562-71-5341, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 05:26:20 GMT, JMSCorrelationID=466c2d81-d445-4278-8816-45cfd537f6872, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/6c8e08d2-0d09-4454-901c-f54c5a437194/cancel, X-VSK-CorrelationId=466c2d81-d445-4278-8816-45cfd537f6872} | exid=ID-esb-test01-44636-1595582182562-71-5344 CID=466c2d81-d445-4278-8816-45cfd537f6872","thread":"thread #4038 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-27T08:26:20,944","input":{"type":"log"},"offset":4994352,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.27","_type":"_doc","_id":"dnG8jnMBtD96ebe8bu11","_score":27.64257,"_source":{"level":"trace","@timestamp":"2020-07-27T05:26:20.944Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-44636-1595582182562-71-5341, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 05:26:20 GMT, JMSCorrelationID=466c2d81-d445-4278-8816-45cfd537f6872, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/6c8e08d2-0d09-4454-901c-f54c5a437194/cancel, X-VSK-CorrelationId=466c2d81-d445-4278-8816-45cfd537f6872} | exid=ID-esb-test01-44636-1595582182562-71-5344 CID=466c2d81-d445-4278-8816-45cfd537f6872 |\n {\"checkId\":\"6c8e08d2-0d09-4454-901c-f54c5a437194\",\"canceledCheckId\":\"86af7643-aa04-4fc0-9fab-94ca28011cbc\"}","thread":"thread #4038 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38229","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"@version":"1","environment":"test","timestamp":"2020-07-27T08:26:20,944","input":{"type":"log"},"offset":4995151,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}}]}}
1585994 [main] INFO  kkm.UnitTests - End test

1585997 [main] INFO  kkm.UnitTests - Starting test: KKM_SIPheckStatus()
1588645 [main] INFO  kkm.UnitTests - End test

1588669 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageNotFound()
1588700 [main] INFO  kkm.UnitTests - End test

1588701 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt_negative()
1588781 [main] INFO  kkm.UnitTests - End test

1588782 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt()
1593351 [main] INFO  kkm.UnitTests - End test

