177  [main] INFO  kkm.UnitTests - Starting test: KKM_DB1()
913  [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
924  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
930  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
1325 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000901797'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000901797'
select * from ProcessStatus where srcID = 'ЖПлато_000901797'
1327 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
1331 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
61571 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000901797'
61572 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000901797]
121727 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000901797%22%20&size=500
121936 [main] INFO  kkm.UnitTests - Response message : {"took":49,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":3,"relation":"eq"},"max_score":11.623745,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"hFLbk3MBfrYj4vM9YCn9","_score":11.623745,"_source":{"@timestamp":"2020-07-28T05:18:09.050Z","stream":"stdout","message":"{\"ts\":\"2020-07-28T05:18:09.049+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"7bcb15b021cd67bc\",\"spanId\":\"7bcb15b021cd67bc\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7bcb15b021cd67bc\",\"X-B3-TraceId\":\"7bcb15b021cd67bc\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":2015445,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"input":{"type":"container"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"t28jlHMBfrYj4vM9swcX","_score":11.623745,"_source":{"@timestamp":"2020-07-28T06:37:09.214Z","message":"{\"ts\":\"2020-07-28T06:37:09.214+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"2152612f8d177669\",\"spanId\":\"2152612f8d177669\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"2152612f8d177669\",\"X-B3-TraceId\":\"2152612f8d177669\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":5422783,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"cKedlHMBfrYj4vM9ePoQ","_score":11.623745,"_source":{"@timestamp":"2020-07-28T08:50:09.187Z","message":"{\"ts\":\"2020-07-28T08:50:09.185+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"a70ffba3b9a82cb2\",\"spanId\":\"a70ffba3b9a82cb2\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a70ffba3b9a82cb2\",\"X-B3-TraceId\":\"a70ffba3b9a82cb2\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"container":{"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator"}}},"host":{"name":"25805977eece"},"log":{"offset":3540923,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}},"stream":"stdout","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"}}}]}}
121943 [main] INFO  kkm.UnitTests - End test

121948 [main] INFO  kkm.UnitTests - Starting test: KKM_DB2()
122090 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
122091 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
122092 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
122562 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
122563 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
122564 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
182808 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
182809 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, nothing, ЖПлато_000898541]
242811 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
242947 [main] INFO  kkm.UnitTests - Response message : {"took":84,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":3,"relation":"eq"},"max_score":10.805184,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"R1Pdk3MBfrYj4vM9NSHJ","_score":10.805184,"_source":{"@timestamp":"2020-07-28T05:20:09.216Z","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"log":{"offset":2117860,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-28T05:20:09.216+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"0592b363c004e718\",\"spanId\":\"0592b363c004e718\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"0592b363c004e718\",\"X-B3-TraceId\":\"0592b363c004e718\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"stream":"stdout","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"OHAllHMBfrYj4vM9iy7N","_score":10.805184,"_source":{"@timestamp":"2020-07-28T06:39:09.143Z","stream":"stdout","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-28T06:39:09.143+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"8b37c3c936fd3da1\",\"spanId\":\"8b37c3c936fd3da1\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8b37c3c936fd3da1\",\"X-B3-TraceId\":\"8b37c3c936fd3da1\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","log":{"offset":5525195,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"sKiflHMBfrYj4vM9TJPi","_score":10.805184,"_source":{"@timestamp":"2020-07-28T08:52:09.106Z","message":"{\"ts\":\"2020-07-28T08:52:09.105+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"ab918c3af3e42ce2\",\"spanId\":\"ab918c3af3e42ce2\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"ab918c3af3e42ce2\",\"X-B3-TraceId\":\"ab918c3af3e42ce2\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","host":{"name":"25805977eece"},"input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5"},"docker":{"container":{"labels":{"com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator"}}},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"ecs":{"version":"1.0.1"},"log":{"offset":3643316,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}},"stream":"stdout"}}]}}
242953 [main] INFO  kkm.UnitTests - End test

242957 [main] INFO  kkm.UnitTests - Starting test: KKM_DB3()
243088 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oo4rFluI6Hqg', '5878279450', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oo4rFluI6Hqg','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oo4rFluI6Hqg', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oo4rFluI6Hqg', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-oo4rFluI6Hqg'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-oo4rFluI6Hqg'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-oo4rFluI6Hqg'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-oo4rFluI6Hqg'
353992 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-oo4rFluI6Hqg'
353993 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-oo4rFluI6Hqg, 8601734b-985c-41a7-b6a0-f45d0267b96f]
353998 [main] INFO  kkm.UnitTests - Status: DONE
353998 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
353998 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
374173 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-oo4rFluI6Hqg%22%20&size=500
374226 [main] INFO  kkm.UnitTests - Response message : {"took":3,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":28.032707,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"SamhlHMBfrYj4vM9IT-z","_score":28.032707,"_source":{"@timestamp":"2020-07-28T08:54:09.090Z","container":{"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"input":{"type":"container"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T08:54:09.089+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"3b1fa44e85698b99\",\"spanId\":\"3b1fa44e85698b99\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3b1fa44e85698b99\",\"X-B3-TraceId\":\"3b1fa44e85698b99\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-LXp7ISaBx4qW\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-oo4rFluI6Hqg\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"log":{"offset":3753292,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}}}}]}}
374349 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
374378 [main] INFO  kkm.UnitTests - End test

374382 [main] INFO  kkm.UnitTests - Starting test: KKM_DB4()
374505 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-z0qYHys3pKeQ', '5056799434', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-z0qYHys3pKeQ','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-z0qYHys3pKeQ', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-z0qYHys3pKeQ', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-z0qYHys3pKeQ'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-z0qYHys3pKeQ'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-z0qYHys3pKeQ'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-z0qYHys3pKeQ'
485102 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-z0qYHys3pKeQ'
485103 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-z0qYHys3pKeQ, 2ee6a2f3-ba75-4d6b-bfdd-d9b80118b585]
485107 [main] INFO  kkm.UnitTests - Status: FAIL
485107 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
485108 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
505423 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-z0qYHys3pKeQ%22%20&size=500
505479 [main] INFO  kkm.UnitTests - Response message : {"took":4,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.66462,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"_qqilHMBfrYj4vM99nOM","_score":27.66462,"_source":{"@timestamp":"2020-07-28T08:56:09.092Z","log":{"offset":3902555,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}},"input":{"type":"container"},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"host":{"name":"25805977eece"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T08:56:09.092+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"8c952717e087ea4c\",\"spanId\":\"8c952717e087ea4c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8c952717e087ea4c\",\"X-B3-TraceId\":\"8c952717e087ea4c\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-z0qYHys3pKeQ\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-kt7UhTDCLJcf\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_stack_namespace":"kkm-commutator","Description":"KKM Commutator Service","Version":"97"}}},"container":{"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}}}}]}}
505614 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
505637 [main] INFO  kkm.UnitTests - End test

505638 [main] INFO  kkm.UnitTests - Starting test: KKM_DB5()
505762 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NTaWTnOxKZpR', '4953290081', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NTaWTnOxKZpR','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NTaWTnOxKZpR', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-NTaWTnOxKZpR', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-NTaWTnOxKZpR'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-NTaWTnOxKZpR'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-NTaWTnOxKZpR'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-NTaWTnOxKZpR'
616660 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-NTaWTnOxKZpR'
616661 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-NTaWTnOxKZpR, b9f34026-b43d-411a-9761-8d26b0eabf5e]
616664 [main] INFO  kkm.UnitTests - Status: DONE
616665 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
616665 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
636796 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-NTaWTnOxKZpR%22%20&size=500
636909 [main] INFO  kkm.UnitTests - Response message : {"took":4,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.351276,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"u6ullHMBfrYj4vM9OCe9","_score":27.351276,"_source":{"@timestamp":"2020-07-28T08:58:31.140Z","log":{"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"},"offset":4059926},"message":"{\"ts\":\"2020-07-28T08:58:31.140+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"a5723c2b30e82adb\",\"spanId\":\"a5723c2b30e82adb\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a5723c2b30e82adb\",\"X-B3-TraceId\":\"a5723c2b30e82adb\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-jTdE5ET2J6SY\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-NTaWTnOxKZpR\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"stream":"stdout","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5"},"host":{"name":"25805977eece"}}}]}}
637037 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
637062 [main] INFO  kkm.UnitTests - End test

637063 [main] INFO  kkm.UnitTests - Starting test: KKM_DB6()
637189 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-d45VP2iX6uE9', '1378256607', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-d45VP2iX6uE9','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-d45VP2iX6uE9', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-d45VP2iX6uE9', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-d45VP2iX6uE9'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-d45VP2iX6uE9'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-d45VP2iX6uE9'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-d45VP2iX6uE9'
747797 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-d45VP2iX6uE9'
747797 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-d45VP2iX6uE9, null]
747801 [main] INFO  kkm.UnitTests - Status: null
747802 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
747802 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
767805 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
767883 [main] INFO  kkm.UnitTests - Response message : {"took":24,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1083,"relation":"eq"},"max_score":5.2743363,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"FI1jlHMBfrYj4vM9QxmA","_score":5.2743363,"_source":{"@timestamp":"2020-07-28T07:46:35.437Z","message":"{\"ts\":\"2020-07-28T07:46:35.437+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"log":{"offset":774715,"file":{"path":"/var/lib/docker/containers/7d1cb021f62bd4f20a6792492003e0bb5f59f5e1fe414b3f89107ad6561a02aa/7d1cb021f62bd4f20a6792492003e0bb5f59f5e1fe414b3f89107ad6561a02aa-json.log"}},"stream":"stdout","container":{"id":"7d1cb021f62bd4f20a6792492003e0bb5f59f5e1fe414b3f89107ad6561a02aa","name":"kkm-commutator_service.1.wn6aqcjhnn7bzopeme19pbxnv","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","Version":"97","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"wn6aqcjhnn7bzopeme19pbxnv","Description":"KKM Commutator Service","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_name":"kkm-commutator_service.1.wn6aqcjhnn7bzopeme19pbxnv"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"uZFrlHMBfrYj4vM9RkHH","_score":5.2743363,"_source":{"@timestamp":"2020-07-28T07:55:20.162Z","stream":"stdout","input":{"type":"container"},"container":{"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"message":"{\"ts\":\"2020-07-28T07:55:20.161+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":""}}},"agent":{"id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece"},"log":{"offset":774730,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"KhG4knMBfrYj4vM9TT2U","_score":3.6458778,"_source":{"@timestamp":"2020-07-28T00:00:09.144Z","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":39011095},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:09.144+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3aeb83866d1badae\",\"spanId\":\"3aeb83866d1badae\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3aeb83866d1badae\",\"X-B3-TraceId\":\"3aeb83866d1badae\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"jRG4knMBfrYj4vM9x03M","_score":3.6458778,"_source":{"@timestamp":"2020-07-28T00:00:31.145Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:31.145+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"80a3bdd764703cc3\",\"spanId\":\"80a3bdd764703cc3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"80a3bdd764703cc3\",\"X-B3-TraceId\":\"80a3bdd764703cc3\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"log":{"offset":39024011,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"IBK_knMBfrYj4vM9j47e","_score":3.6458778,"_source":{"@timestamp":"2020-07-28T00:08:09.103Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":39344355,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:08:09.102+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"928d0efe630ecd07\",\"spanId\":\"928d0efe630ecd07\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"928d0efe630ecd07\",\"X-B3-TraceId\":\"928d0efe630ecd07\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"host":{"name":"25805977eece"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"}}}]}}
768004 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
768027 [main] INFO  kkm.UnitTests - End test

768028 [main] INFO  kkm.UnitTests - Starting test: KKM_DB7()
768147 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-6AOTJyrlnl1q', '0348649288', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-6AOTJyrlnl1q','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-6AOTJyrlnl1q', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-6AOTJyrlnl1q', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-6AOTJyrlnl1q'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-6AOTJyrlnl1q'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-6AOTJyrlnl1q'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-6AOTJyrlnl1q'
878761 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-6AOTJyrlnl1q'
878762 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-6AOTJyrlnl1q, null]
878765 [main] INFO  kkm.UnitTests - Status: null
878766 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
878766 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
898769 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
898826 [main] INFO  kkm.UnitTests - Response message : {"took":4,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1087,"relation":"eq"},"max_score":5.273654,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"FI1jlHMBfrYj4vM9QxmA","_score":5.273654,"_source":{"@timestamp":"2020-07-28T07:46:35.437Z","message":"{\"ts\":\"2020-07-28T07:46:35.437+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"log":{"offset":774715,"file":{"path":"/var/lib/docker/containers/7d1cb021f62bd4f20a6792492003e0bb5f59f5e1fe414b3f89107ad6561a02aa/7d1cb021f62bd4f20a6792492003e0bb5f59f5e1fe414b3f89107ad6561a02aa-json.log"}},"stream":"stdout","container":{"id":"7d1cb021f62bd4f20a6792492003e0bb5f59f5e1fe414b3f89107ad6561a02aa","name":"kkm-commutator_service.1.wn6aqcjhnn7bzopeme19pbxnv","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","Version":"97","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"wn6aqcjhnn7bzopeme19pbxnv","Description":"KKM Commutator Service","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_name":"kkm-commutator_service.1.wn6aqcjhnn7bzopeme19pbxnv"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"uZFrlHMBfrYj4vM9RkHH","_score":5.273654,"_source":{"@timestamp":"2020-07-28T07:55:20.162Z","stream":"stdout","input":{"type":"container"},"container":{"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"message":"{\"ts\":\"2020-07-28T07:55:20.161+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":""}}},"agent":{"id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece"},"log":{"offset":774730,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"KhG4knMBfrYj4vM9TT2U","_score":3.645439,"_source":{"@timestamp":"2020-07-28T00:00:09.144Z","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":39011095},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:09.144+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3aeb83866d1badae\",\"spanId\":\"3aeb83866d1badae\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3aeb83866d1badae\",\"X-B3-TraceId\":\"3aeb83866d1badae\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"jRG4knMBfrYj4vM9x03M","_score":3.645439,"_source":{"@timestamp":"2020-07-28T00:00:31.145Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:31.145+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"80a3bdd764703cc3\",\"spanId\":\"80a3bdd764703cc3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"80a3bdd764703cc3\",\"X-B3-TraceId\":\"80a3bdd764703cc3\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"log":{"offset":39024011,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"IBK_knMBfrYj4vM9j47e","_score":3.645439,"_source":{"@timestamp":"2020-07-28T00:08:09.103Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":39344355,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:08:09.102+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"928d0efe630ecd07\",\"spanId\":\"928d0efe630ecd07\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"928d0efe630ecd07\",\"X-B3-TraceId\":\"928d0efe630ecd07\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"host":{"name":"25805977eece"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"}}}]}}
898947 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
898971 [main] INFO  kkm.UnitTests - End test

898972 [main] INFO  kkm.UnitTests - Starting test: KKM_DB8()
899090 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oSpRYN7P51qZ', '0893855229', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oSpRYN7P51qZ','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oSpRYN7P51qZ', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-oSpRYN7P51qZ', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-oSpRYN7P51qZ'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-oSpRYN7P51qZ'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-oSpRYN7P51qZ'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-oSpRYN7P51qZ'
1009791 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-oSpRYN7P51qZ'
1009792 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-oSpRYN7P51qZ, null]
1009793 [main] INFO  kkm.UnitTests - Status: null
1009793 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1009793 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1029795 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1029847 [main] INFO  kkm.UnitTests - Response message : {"took":2,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1091,"relation":"eq"},"max_score":5.272977,"hits":[{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"FI1jlHMBfrYj4vM9QxmA","_score":5.272977,"_source":{"@timestamp":"2020-07-28T07:46:35.437Z","message":"{\"ts\":\"2020-07-28T07:46:35.437+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"log":{"offset":774715,"file":{"path":"/var/lib/docker/containers/7d1cb021f62bd4f20a6792492003e0bb5f59f5e1fe414b3f89107ad6561a02aa/7d1cb021f62bd4f20a6792492003e0bb5f59f5e1fe414b3f89107ad6561a02aa-json.log"}},"stream":"stdout","container":{"id":"7d1cb021f62bd4f20a6792492003e0bb5f59f5e1fe414b3f89107ad6561a02aa","name":"kkm-commutator_service.1.wn6aqcjhnn7bzopeme19pbxnv","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","Version":"97","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"wn6aqcjhnn7bzopeme19pbxnv","Description":"KKM Commutator Service","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_name":"kkm-commutator_service.1.wn6aqcjhnn7bzopeme19pbxnv"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"uZFrlHMBfrYj4vM9RkHH","_score":5.272977,"_source":{"@timestamp":"2020-07-28T07:55:20.162Z","stream":"stdout","input":{"type":"container"},"container":{"id":"c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5","name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"message":"{\"ts\":\"2020-07-28T07:55:20.161+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","docker":{"container":{"labels":{"Description":"KKM Commutator Service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_id":"tfc8zap7xda72td18pqja05sp","com_docker_swarm_task_name":"kkm-commutator_service.1.tfc8zap7xda72td18pqja05sp","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":""}}},"agent":{"id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece"},"log":{"offset":774730,"file":{"path":"/var/lib/docker/containers/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5/c87b0cb3741001705e46f06100dcbb96f6873150512bc54b78c6b2e3515bf8e5-json.log"}}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"KhG4knMBfrYj4vM9TT2U","_score":3.645003,"_source":{"@timestamp":"2020-07-28T00:00:09.144Z","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":39011095},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:09.144+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3aeb83866d1badae\",\"spanId\":\"3aeb83866d1badae\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3aeb83866d1badae\",\"X-B3-TraceId\":\"3aeb83866d1badae\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"jRG4knMBfrYj4vM9x03M","_score":3.645003,"_source":{"@timestamp":"2020-07-28T00:00:31.145Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:00:31.145+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"80a3bdd764703cc3\",\"spanId\":\"80a3bdd764703cc3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"80a3bdd764703cc3\",\"X-B3-TraceId\":\"80a3bdd764703cc3\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"log":{"offset":39024011,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.28","_type":"_doc","_id":"IBK_knMBfrYj4vM9j47e","_score":3.645003,"_source":{"@timestamp":"2020-07-28T00:08:09.103Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":39344355,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-28T00:08:09.102+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"928d0efe630ecd07\",\"spanId\":\"928d0efe630ecd07\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"928d0efe630ecd07\",\"X-B3-TraceId\":\"928d0efe630ecd07\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"host":{"name":"25805977eece"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"}}}]}}
1029964 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
1029986 [main] INFO  kkm.UnitTests - End test

