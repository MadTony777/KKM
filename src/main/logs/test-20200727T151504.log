158  [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckNoCashier()
6095 [main] INFO  kkm.UnitTests - End test

6107 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageEmail()
279879 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.27/_search?q=%20message:%20%22CID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11%22%20
280478 [main] INFO  kkm.UnitTests - Response message : {"took":503,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":59.727753,"hits":[{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"Pjr8j3MBfrYj4vM9fkNY","_score":59.727753,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":16827571,"@timestamp":"2020-07-27T11:15:41.813Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T14:15:41,813","thread":"qtp529223075-316698","message":"KkmService: REST response Operation 'SendMessage' was complete with body: ReceiptResponse{correlationId='null', checkId='4f134810-382e-4e42-a5f8-508f4c31400f', error=null} | exid=ID-esb-stage-37060-1595563687826-91-3822 CID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"ETr8j3MBfrYj4vM9fkNV","_score":59.485203,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":16823191,"@timestamp":"2020-07-27T11:15:41.787Z","beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"timestamp":"2020-07-27T14:15:41,787","thread":"qtp529223075-316698","message":"KkmService: REST request  Operation 'SendMessage' was call with body: SendMessageRequest{checkId='4f134810-382e-4e42-a5f8-508f4c31400f', messageType='email', messageAddress='EPolikarpova@VSK.RU'} | exid=ID-esb-stage-37060-1595563687826-91-3822 CID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"EDr8j3MBfrYj4vM9fkNV","_score":56.941555,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":16822715,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T11:15:41.786Z","timestamp":"2020-07-27T14:15:41,786","thread":"qtp529223075-316698","message":"KkmService: REST request  Operation 'SendMessage' was call with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-3821, JMSCorrelationID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11, operationName=SendMessage, X-VSK-CorrelationId=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11} | exid=ID-esb-stage-37060-1595563687826-91-3822 CID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"PTr8j3MBfrYj4vM9fkNY","_score":53.217785,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"offset":16824228,"@timestamp":"2020-07-27T11:15:41.787Z","beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"timestamp":"2020-07-27T14:15:41,787","thread":"thread #5176 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-3821, CamelHttpMethod=GET, JMSCorrelationID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/4f134810-382e-4e42-a5f8-508f4c31400f/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11} | exId=ID-esb-stage-37060-1595563687826-91-3824 CID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11 |\n ","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"cTr8j3MBfrYj4vM9fkNh","_score":53.217785,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":16823590,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T11:15:41.787Z","timestamp":"2020-07-27T14:15:41,787","thread":"thread #5176 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-3821, CamelHttpMethod=GET, JMSCorrelationID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/4f134810-382e-4e42-a5f8-508f4c31400f/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11} | exId=ID-esb-stage-37060-1595563687826-91-3824 CID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"Ejr8j3MBfrYj4vM9fkNV","_score":47.67506,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":16826676,"@timestamp":"2020-07-27T11:15:41.813Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T14:15:41,813","thread":"qtp529223075-316698","message":"KkmService: REST response Operation 'SendMessage' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-3821, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 11:15:43 GMT, JMSCorrelationID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/4f134810-382e-4e42-a5f8-508f4c31400f/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11} | exid=ID-esb-stage-37060-1595563687826-91-3822 CID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"Djr8j3MBfrYj4vM9fkTy","_score":47.67506,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":16824870,"@timestamp":"2020-07-27T11:15:41.813Z","beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"timestamp":"2020-07-27T14:15:41,813","thread":"thread #5176 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-3821, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 11:15:43 GMT, JMSCorrelationID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/4f134810-382e-4e42-a5f8-508f4c31400f/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11} | exid=ID-esb-stage-37060-1595563687826-91-3824 CID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"5zr8j3MBfrYj4vM9fkJL","_score":46.465202,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"offset":16825746,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T11:15:41.813Z","timestamp":"2020-07-27T14:15:41,813","thread":"thread #5176 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-3821, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 11:15:43 GMT, JMSCorrelationID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/4f134810-382e-4e42-a5f8-508f4c31400f/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11} | exid=ID-esb-stage-37060-1595563687826-91-3824 CID=28bc8ccb-46a0-482b-ac97-c92baecf3c9d11 |\n {\"checkId\":\"4f134810-382e-4e42-a5f8-508f4c31400f\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
280480 [main] INFO  kkm.UnitTests - End test

280484 [main] INFO  kkm.UnitTests - Starting test: KKM_WAcheckStatus()
280612 [main] INFO  kkm.UnitTests - End test

280618 [main] INFO  kkm.UnitTests - Starting test: KKM_getStatus()
283104 [main] INFO  kkm.UnitTests - End test

283107 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceledAlredy()
288024 [main] INFO  kkm.UnitTests - End test

288025 [main] INFO  kkm.UnitTests - Starting test: KKM_getDocCustomer()
288236 [main] INFO  kkm.UnitTests - End test

288238 [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckCashier()
298408 [main] INFO  kkm.UnitTests - End test

298409 [main] INFO  kkm.UnitTests - Starting test: KKM_DB1()
298833 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
298840 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
298842 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
299372 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000901797'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000901797'
select * from ProcessStatus where srcID = 'ЖПлато_000901797'
299373 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
299375 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
359657 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000901797'
359658 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000901797]
419669 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000901797%22%20&size=500
419771 [main] INFO  kkm.UnitTests - Response message : {"took":38,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":12.709757,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"vTwAkHMBfrYj4vM9b3_O","_score":12.709757,"_source":{"@timestamp":"2020-07-27T11:20:09.272Z","docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97"}}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T11:20:09.272+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"c85a8beba546c52a\",\"spanId\":\"c85a8beba546c52a\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c85a8beba546c52a\",\"X-B3-TraceId\":\"c85a8beba546c52a\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":7228587},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}}]}}
419773 [main] INFO  kkm.UnitTests - End test

419777 [main] INFO  kkm.UnitTests - Starting test: KKM_DB2()
419926 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
419927 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
419928 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
420537 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
420538 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
420539 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
480805 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
480806 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, nothing, ЖПлато_000898541]
540814 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
540967 [main] INFO  kkm.UnitTests - Response message : {"took":100,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":4,"relation":"eq"},"max_score":10.690662,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"LbnajnMBfrYj4vM9jMFx","_score":10.690662,"_source":{"@timestamp":"2020-07-27T05:59:09.416Z","message":"{\"ts\":\"2020-07-27T05:59:09.415+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"f9e5edb1eb62c047\",\"spanId\":\"f9e5edb1eb62c047\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"f9e5edb1eb62c047\",\"X-B3-TraceId\":\"f9e5edb1eb62c047\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":43427463,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"JMkDj3MBfrYj4vM9ve66","_score":10.690662,"_source":{"@timestamp":"2020-07-27T06:44:09.676Z","docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T06:44:09.676+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"8fe5b5fc982cc728\",\"spanId\":\"8fe5b5fc982cc728\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8fe5b5fc982cc728\",\"X-B3-TraceId\":\"8fe5b5fc982cc728\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"log":{"offset":45502972,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"GSraj3MBfrYj4vM9AsTR","_score":10.690662,"_source":{"@timestamp":"2020-07-27T10:38:09.163Z","stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":5301396},"message":"{\"ts\":\"2020-07-27T10:38:09.163+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"cf2482f94452280f\",\"spanId\":\"cf2482f94452280f\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"cf2482f94452280f\",\"X-B3-TraceId\":\"cf2482f94452280f\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"agent":{"id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"uT0CkHMBfrYj4vM9SFWD","_score":10.690662,"_source":{"@timestamp":"2020-07-27T11:22:09.278Z","stream":"stdout","host":{"name":"25805977eece"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":7330995},"message":"{\"ts\":\"2020-07-27T11:22:09.278+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"3058ec4d001562df\",\"spanId\":\"3058ec4d001562df\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3058ec4d001562df\",\"X-B3-TraceId\":\"3058ec4d001562df\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"}}}]}}
540969 [main] INFO  kkm.UnitTests - End test

540970 [main] INFO  kkm.UnitTests - Starting test: KKM_DB3()
541109 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-eArnnN59ygMK', '8310774437', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-eArnnN59ygMK','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-eArnnN59ygMK', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-eArnnN59ygMK', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-eArnnN59ygMK'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-eArnnN59ygMK'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-eArnnN59ygMK'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-eArnnN59ygMK'
652128 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-eArnnN59ygMK'
652129 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-eArnnN59ygMK, ee20ddaf-a834-4ee9-820d-70029ce18548]
652130 [main] INFO  kkm.UnitTests - Status: DONE
652130 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
652130 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
672258 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-eArnnN59ygMK%22%20&size=500
672356 [main] INFO  kkm.UnitTests - Response message : {"took":45,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.409311,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"LD4EkHMBfrYj4vM9HYJS","_score":27.409311,"_source":{"@timestamp":"2020-07-27T11:24:09.287Z","stream":"stdout","message":"{\"ts\":\"2020-07-27T11:24:09.287+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"27e5da85dfff9b67\",\"spanId\":\"27e5da85dfff9b67\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"27e5da85dfff9b67\",\"X-B3-TraceId\":\"27e5da85dfff9b67\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-J3tCmlc3WsyO\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-eArnnN59ygMK\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"host":{"name":"25805977eece"},"log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":7441012},"docker":{"container":{"labels":{"com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"}}}]}}
672475 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
672500 [main] INFO  kkm.UnitTests - End test

672501 [main] INFO  kkm.UnitTests - Starting test: KKM_DB4()
672624 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-XmyHbfd3orfW', '2080009633', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-XmyHbfd3orfW','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-XmyHbfd3orfW', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-XmyHbfd3orfW', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-XmyHbfd3orfW'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-XmyHbfd3orfW'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-XmyHbfd3orfW'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-XmyHbfd3orfW'
783453 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-XmyHbfd3orfW'
783454 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-XmyHbfd3orfW, d9bd8168-4252-4a46-a643-f2833df23ac9]
783458 [main] INFO  kkm.UnitTests - Status: FAIL
783458 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
783458 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
803909 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-XmyHbfd3orfW%22%20&size=500
804283 [main] INFO  kkm.UnitTests - Response message : {"took":320,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.188631,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"X0AGkHMBfrYj4vM9Uw_L","_score":27.188631,"_source":{"@timestamp":"2020-07-27T11:26:31.135Z","stream":"stdout","log":{"offset":7591088,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"message":"{\"ts\":\"2020-07-27T11:26:31.135+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"e00af7141fab7a18\",\"spanId\":\"e00af7141fab7a18\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"e00af7141fab7a18\",\"X-B3-TraceId\":\"e00af7141fab7a18\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-XmyHbfd3orfW\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"}}}]}}
804413 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
804437 [main] INFO  kkm.UnitTests - End test

804438 [main] INFO  kkm.UnitTests - Starting test: KKM_DB5()
804564 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Wtty7y4YNeat', '0773690648', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Wtty7y4YNeat','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Wtty7y4YNeat', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Wtty7y4YNeat', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-Wtty7y4YNeat'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-Wtty7y4YNeat'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-Wtty7y4YNeat'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-Wtty7y4YNeat'
915484 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-Wtty7y4YNeat'
915485 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-Wtty7y4YNeat, a15c1019-4418-4a4b-83b4-347d30d1a971]
915486 [main] INFO  kkm.UnitTests - Status: DONE
915487 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
915487 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
935650 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-Wtty7y4YNeat%22%20&size=500
935775 [main] INFO  kkm.UnitTests - Response message : {"took":6,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":26.986383,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"qUAIkHMBfrYj4vM9KOia","_score":26.986383,"_source":{"@timestamp":"2020-07-27T11:28:31.155Z","host":{"name":"25805977eece"},"log":{"offset":7735562,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T11:28:31.155+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"f9e81855cf8924b6\",\"spanId\":\"f9e81855cf8924b6\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"f9e81855cf8924b6\",\"X-B3-TraceId\":\"f9e81855cf8924b6\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-997qfFUmsEes\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-Wtty7y4YNeat\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}}]}}
935903 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
935927 [main] INFO  kkm.UnitTests - End test

935927 [main] INFO  kkm.UnitTests - Starting test: KKM_DB6()
936048 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UZF9DRwLB35p', '0961824404', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UZF9DRwLB35p','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UZF9DRwLB35p', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UZF9DRwLB35p', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-UZF9DRwLB35p'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-UZF9DRwLB35p'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-UZF9DRwLB35p'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-UZF9DRwLB35p'
1046775 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-UZF9DRwLB35p'
1046776 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-UZF9DRwLB35p, null]
1046779 [main] INFO  kkm.UnitTests - Status: null
1046780 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1046780 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1066785 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1066887 [main] INFO  kkm.UnitTests - Response message : {"took":43,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1386,"relation":"eq"},"max_score":3.5667205,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"o3aSjXMBfrYj4vM9LZH0","_score":3.5667205,"_source":{"@timestamp":"2020-07-27T00:00:09.153Z","ecs":{"version":"1.0.1"},"log":{"offset":28726039,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-27T00:00:09.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"d452230b2efe5ab7\",\"spanId\":\"d452230b2efe5ab7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d452230b2efe5ab7\",\"X-B3-TraceId\":\"d452230b2efe5ab7\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"OXaSjXMBfrYj4vM9UpQ9","_score":3.5667205,"_source":{"@timestamp":"2020-07-27T00:00:31.122Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"host":{"name":"25805977eece"},"input":{"type":"container"},"message":"{\"ts\":\"2020-07-27T00:00:31.122+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3dd65d6f98321076\",\"spanId\":\"3dd65d6f98321076\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3dd65d6f98321076\",\"X-B3-TraceId\":\"3dd65d6f98321076\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":28738954},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"X3ifjXMBfrYj4vM9nQx0","_score":3.5667205,"_source":{"@timestamp":"2020-07-27T00:15:09.048Z","stream":"stdout","log":{"offset":29337267,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T00:15:09.047+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9146b30fd146e783\",\"spanId\":\"9146b30fd146e783\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9146b30fd146e783\",\"X-B3-TraceId\":\"9146b30fd146e783\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"V3igjXMBfrYj4vM9AyUJ","_score":3.5667205,"_source":{"@timestamp":"2020-07-27T00:15:31.138Z","message":"{\"ts\":\"2020-07-27T00:15:31.138+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a1eefa1f7c6d7600\",\"spanId\":\"a1eefa1f7c6d7600\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a1eefa1f7c6d7600\",\"X-B3-TraceId\":\"a1eefa1f7c6d7600\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":29358423,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"r3igjXMBfrYj4vM9gyr3","_score":3.5667205,"_source":{"@timestamp":"2020-07-27T00:16:09.021Z","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":29383923,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:16:09.021+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7cd409989dfdfa52\",\"spanId\":\"7cd409989dfdfa52\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7cd409989dfdfa52\",\"X-B3-TraceId\":\"7cd409989dfdfa52\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
1067240 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
1067268 [main] INFO  kkm.UnitTests - End test

1067270 [main] INFO  kkm.UnitTests - Starting test: KKM_DB7()
1067391 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-nnug4g9eOBya', '7988922060', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-nnug4g9eOBya','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-nnug4g9eOBya', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-nnug4g9eOBya', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-nnug4g9eOBya'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-nnug4g9eOBya'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-nnug4g9eOBya'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-nnug4g9eOBya'
1178228 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-nnug4g9eOBya'
1178228 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-nnug4g9eOBya, null]
1178229 [main] INFO  kkm.UnitTests - Status: null
1178230 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1178230 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1198235 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1198386 [main] INFO  kkm.UnitTests - Response message : {"took":96,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1390,"relation":"eq"},"max_score":3.5665834,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"o3aSjXMBfrYj4vM9LZH0","_score":3.5665834,"_source":{"@timestamp":"2020-07-27T00:00:09.153Z","ecs":{"version":"1.0.1"},"log":{"offset":28726039,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-27T00:00:09.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"d452230b2efe5ab7\",\"spanId\":\"d452230b2efe5ab7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d452230b2efe5ab7\",\"X-B3-TraceId\":\"d452230b2efe5ab7\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"OXaSjXMBfrYj4vM9UpQ9","_score":3.5665834,"_source":{"@timestamp":"2020-07-27T00:00:31.122Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"host":{"name":"25805977eece"},"input":{"type":"container"},"message":"{\"ts\":\"2020-07-27T00:00:31.122+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3dd65d6f98321076\",\"spanId\":\"3dd65d6f98321076\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3dd65d6f98321076\",\"X-B3-TraceId\":\"3dd65d6f98321076\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":28738954},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"X3ifjXMBfrYj4vM9nQx0","_score":3.5665834,"_source":{"@timestamp":"2020-07-27T00:15:09.048Z","stream":"stdout","log":{"offset":29337267,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T00:15:09.047+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9146b30fd146e783\",\"spanId\":\"9146b30fd146e783\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9146b30fd146e783\",\"X-B3-TraceId\":\"9146b30fd146e783\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"V3igjXMBfrYj4vM9AyUJ","_score":3.5665834,"_source":{"@timestamp":"2020-07-27T00:15:31.138Z","message":"{\"ts\":\"2020-07-27T00:15:31.138+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a1eefa1f7c6d7600\",\"spanId\":\"a1eefa1f7c6d7600\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a1eefa1f7c6d7600\",\"X-B3-TraceId\":\"a1eefa1f7c6d7600\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":29358423,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"r3igjXMBfrYj4vM9gyr3","_score":3.5665834,"_source":{"@timestamp":"2020-07-27T00:16:09.021Z","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":29383923,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:16:09.021+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7cd409989dfdfa52\",\"spanId\":\"7cd409989dfdfa52\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7cd409989dfdfa52\",\"X-B3-TraceId\":\"7cd409989dfdfa52\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
1198510 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1198532 [main] INFO  kkm.UnitTests - End test

1198533 [main] INFO  kkm.UnitTests - Starting test: KKM_DB8()
1198650 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-o4MMKsE1dcM0', '5840112284', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-o4MMKsE1dcM0','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-o4MMKsE1dcM0', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-o4MMKsE1dcM0', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-o4MMKsE1dcM0'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-o4MMKsE1dcM0'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-o4MMKsE1dcM0'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-o4MMKsE1dcM0'
1309613 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-o4MMKsE1dcM0'
1309613 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-o4MMKsE1dcM0, null]
1309617 [main] INFO  kkm.UnitTests - Status: null
1309617 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1309618 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1329624 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1329694 [main] INFO  kkm.UnitTests - Response message : {"took":11,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1394,"relation":"eq"},"max_score":3.5664842,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"o3aSjXMBfrYj4vM9LZH0","_score":3.5664842,"_source":{"@timestamp":"2020-07-27T00:00:09.153Z","ecs":{"version":"1.0.1"},"log":{"offset":28726039,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-27T00:00:09.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"d452230b2efe5ab7\",\"spanId\":\"d452230b2efe5ab7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d452230b2efe5ab7\",\"X-B3-TraceId\":\"d452230b2efe5ab7\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"OXaSjXMBfrYj4vM9UpQ9","_score":3.5664842,"_source":{"@timestamp":"2020-07-27T00:00:31.122Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"host":{"name":"25805977eece"},"input":{"type":"container"},"message":"{\"ts\":\"2020-07-27T00:00:31.122+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3dd65d6f98321076\",\"spanId\":\"3dd65d6f98321076\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3dd65d6f98321076\",\"X-B3-TraceId\":\"3dd65d6f98321076\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":28738954},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"X3ifjXMBfrYj4vM9nQx0","_score":3.5664842,"_source":{"@timestamp":"2020-07-27T00:15:09.048Z","stream":"stdout","log":{"offset":29337267,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T00:15:09.047+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9146b30fd146e783\",\"spanId\":\"9146b30fd146e783\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9146b30fd146e783\",\"X-B3-TraceId\":\"9146b30fd146e783\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"V3igjXMBfrYj4vM9AyUJ","_score":3.5664842,"_source":{"@timestamp":"2020-07-27T00:15:31.138Z","message":"{\"ts\":\"2020-07-27T00:15:31.138+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a1eefa1f7c6d7600\",\"spanId\":\"a1eefa1f7c6d7600\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a1eefa1f7c6d7600\",\"X-B3-TraceId\":\"a1eefa1f7c6d7600\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":29358423,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"r3igjXMBfrYj4vM9gyr3","_score":3.5664842,"_source":{"@timestamp":"2020-07-27T00:16:09.021Z","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":29383923,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:16:09.021+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7cd409989dfdfa52\",\"spanId\":\"7cd409989dfdfa52\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7cd409989dfdfa52\",\"X-B3-TraceId\":\"7cd409989dfdfa52\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
1329810 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
1329833 [main] INFO  kkm.UnitTests - End test

1329834 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageWasCanceled()
1333197 [main] INFO  kkm.UnitTests - End test

1333199 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceleNotFound()
1333409 [main] INFO  kkm.UnitTests - End test

1333412 [main] INFO  kkm.UnitTests - Starting test: KKM_makeAndCancelCheckCashier()
1576177 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.27/_search?q=%20message:%20%22CID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2%22%20
1576892 [main] INFO  kkm.UnitTests - Response message : {"took":659,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":62.411304,"hits":[{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"LkQQkHMBfrYj4vM9gZn6","_score":62.411304,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":3176413,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T11:37:18.112Z","timestamp":"2020-07-27T14:37:18,112","thread":"qtp529223075-319578","message":"KkmService: REST request  Operation 'CancelReceipt' was call with body: 3525a190-af73-4546-8247-9a004f1df21e | exid=ID-esb-stage-37060-1595563687826-91-5742 CID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"UkQQkHMBfrYj4vM9u6xm","_score":59.415783,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":3180534,"@timestamp":"2020-07-27T11:37:18.154Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T14:37:18,154","thread":"qtp529223075-319578","message":"KkmService: REST response Operation 'CancelReceipt' was complete with body: CancelReceiptResponse{correlationId='null', checkId='3525a190-af73-4546-8247-9a004f1df21e', canceledCheckId='73c812d6-8129-4967-abcb-3bd42093a79c', error=null} | exid=ID-esb-stage-37060-1595563687826-91-5742 CID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"KkQQkHMBfrYj4vM9gpoO","_score":58.023327,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":3175936,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T11:37:18.111Z","timestamp":"2020-07-27T14:37:18,111","thread":"qtp529223075-319578","message":"KkmService: REST request  Operation 'CancelReceipt' was call with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-5741, JMSCorrelationID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2, operationName=CancelReceipt, X-VSK-CorrelationId=64ee61e0-03a3-4244-9a0b-ea72e4880bed2} | exid=ID-esb-stage-37060-1595563687826-91-5742 CID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"s0QQkHMBfrYj4vM9gZn6","_score":55.01492,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":3176724,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T11:37:18.112Z","timestamp":"2020-07-27T14:37:18,112","thread":"thread #5167 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-5741, CamelHttpMethod=PUT, JMSCorrelationID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/3525a190-af73-4546-8247-9a004f1df21e/cancel, X-VSK-CorrelationId=64ee61e0-03a3-4244-9a0b-ea72e4880bed2} | exId=ID-esb-stage-37060-1595563687826-91-5744 CID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"sUQQkHMBfrYj4vM9gZjS","_score":53.431858,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"offset":3177335,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T11:37:18.112Z","timestamp":"2020-07-27T14:37:18,112","thread":"thread #5167 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-5741, CamelHttpMethod=PUT, JMSCorrelationID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/3525a190-af73-4546-8247-9a004f1df21e/cancel, X-VSK-CorrelationId=64ee61e0-03a3-4244-9a0b-ea72e4880bed2} | exId=ID-esb-stage-37060-1595563687826-91-5744 CID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2 |\n 3525a190-af73-4546-8247-9a004f1df21e","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"OUQQkHMBfrYj4vM9gZjH","_score":49.84605,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":3177986,"@timestamp":"2020-07-27T11:37:18.154Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T14:37:18,154","thread":"thread #5167 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-5741, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 11:37:19 GMT, JMSCorrelationID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/3525a190-af73-4546-8247-9a004f1df21e/cancel, X-VSK-CorrelationId=64ee61e0-03a3-4244-9a0b-ea72e4880bed2} | exid=ID-esb-stage-37060-1595563687826-91-5744 CID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"K0QQkHMBfrYj4vM9gpoO","_score":49.84605,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":3179709,"@timestamp":"2020-07-27T11:37:18.154Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T14:37:18,154","thread":"qtp529223075-319578","message":"KkmService: REST response Operation 'CancelReceipt' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-5741, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 11:37:19 GMT, JMSCorrelationID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/3525a190-af73-4546-8247-9a004f1df21e/cancel, X-VSK-CorrelationId=64ee61e0-03a3-4244-9a0b-ea72e4880bed2} | exid=ID-esb-stage-37060-1595563687826-91-5742 CID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"q0QQkHMBfrYj4vM9gpoa","_score":48.542973,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":3178792,"beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"@timestamp":"2020-07-27T11:37:18.154Z","timestamp":"2020-07-27T14:37:18,154","thread":"thread #5167 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-5741, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 11:37:19 GMT, JMSCorrelationID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/3525a190-af73-4546-8247-9a004f1df21e/cancel, X-VSK-CorrelationId=64ee61e0-03a3-4244-9a0b-ea72e4880bed2} | exid=ID-esb-stage-37060-1595563687826-91-5744 CID=64ee61e0-03a3-4244-9a0b-ea72e4880bed2 |\n {\"checkId\":\"3525a190-af73-4546-8247-9a004f1df21e\",\"canceledCheckId\":\"73c812d6-8129-4967-abcb-3bd42093a79c\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
1576893 [main] INFO  kkm.UnitTests - End test

1576895 [main] INFO  kkm.UnitTests - Starting test: KKM_SIPheckStatus()
1578935 [main] INFO  kkm.UnitTests - End test

1578937 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageNotFound()
1579103 [main] INFO  kkm.UnitTests - End test

1579104 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt_negative()
1579197 [main] INFO  kkm.UnitTests - End test

1579198 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt()
1582160 [main] INFO  kkm.UnitTests - End test

