200  [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckNoCashier()
4408 [main] INFO  kkm.UnitTests - End test

4424 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageEmail()
280861 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.27/_search?q=%20message:%20%22CID=1754a6c1-8e18-4076-ae09-9f5770cdc45211%22%20
281443 [main] INFO  kkm.UnitTests - Response message : {"took":480,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":54.93447,"hits":[{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"ISjUj3MBfrYj4vM95uKd","_score":54.93447,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1060956,"beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"@timestamp":"2020-07-27T10:32:19.355Z","timestamp":"2020-07-27T13:32:19,355","thread":"qtp529223075-301376","message":"KkmService: REST response Operation 'SendMessage' was complete with body: ReceiptResponse{correlationId='null', checkId='8694ac5b-5cae-469c-a3f3-fda052d6de8d', error=null} | exid=ID-esb-stage-37060-1595563687826-91-812 CID=1754a6c1-8e18-4076-ae09-9f5770cdc45211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"hCjUj3MBfrYj4vM9q8wJ","_score":54.714,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1056587,"@timestamp":"2020-07-27T10:32:19.317Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T13:32:19,317","thread":"qtp529223075-301376","message":"KkmService: REST request  Operation 'SendMessage' was call with body: SendMessageRequest{checkId='8694ac5b-5cae-469c-a3f3-fda052d6de8d', messageType='email', messageAddress='EPolikarpova@VSK.RU'} | exid=ID-esb-stage-37060-1595563687826-91-812 CID=1754a6c1-8e18-4076-ae09-9f5770cdc45211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"cyjUj3MBfrYj4vM9q8wA","_score":52.400715,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1056113,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T10:32:19.317Z","timestamp":"2020-07-27T13:32:19,317","thread":"qtp529223075-301376","message":"KkmService: REST request  Operation 'SendMessage' was call with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-811, JMSCorrelationID=1754a6c1-8e18-4076-ae09-9f5770cdc45211, operationName=SendMessage, X-VSK-CorrelationId=1754a6c1-8e18-4076-ae09-9f5770cdc45211} | exid=ID-esb-stage-37060-1595563687826-91-812 CID=1754a6c1-8e18-4076-ae09-9f5770cdc45211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"KSjUj3MBfrYj4vM9qsz5","_score":49.00997,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1056985,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T10:32:19.322Z","timestamp":"2020-07-27T13:32:19,322","thread":"thread #5122 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-811, CamelHttpMethod=GET, JMSCorrelationID=1754a6c1-8e18-4076-ae09-9f5770cdc45211, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/8694ac5b-5cae-469c-a3f3-fda052d6de8d/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=1754a6c1-8e18-4076-ae09-9f5770cdc45211} | exId=ID-esb-stage-37060-1595563687826-91-814 CID=1754a6c1-8e18-4076-ae09-9f5770cdc45211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"OijUj3MBfrYj4vM9qsz6","_score":49.00997,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"offset":1057621,"@timestamp":"2020-07-27T10:32:19.322Z","beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"timestamp":"2020-07-27T13:32:19,322","thread":"thread #5122 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-811, CamelHttpMethod=GET, JMSCorrelationID=1754a6c1-8e18-4076-ae09-9f5770cdc45211, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/8694ac5b-5cae-469c-a3f3-fda052d6de8d/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=1754a6c1-8e18-4076-ae09-9f5770cdc45211} | exId=ID-esb-stage-37060-1595563687826-91-814 CID=1754a6c1-8e18-4076-ae09-9f5770cdc45211 |\n ","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"dCjUj3MBfrYj4vM9q8wA","_score":43.953693,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1060063,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T10:32:19.354Z","timestamp":"2020-07-27T13:32:19,354","thread":"qtp529223075-301376","message":"KkmService: REST response Operation 'SendMessage' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-811, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 10:32:21 GMT, JMSCorrelationID=1754a6c1-8e18-4076-ae09-9f5770cdc45211, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/8694ac5b-5cae-469c-a3f3-fda052d6de8d/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=1754a6c1-8e18-4076-ae09-9f5770cdc45211} | exid=ID-esb-stage-37060-1595563687826-91-812 CID=1754a6c1-8e18-4076-ae09-9f5770cdc45211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"XSjUj3MBfrYj4vM9qsz8","_score":43.953693,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1058261,"beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"@timestamp":"2020-07-27T10:32:19.354Z","timestamp":"2020-07-27T13:32:19,354","thread":"thread #5122 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-811, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 10:32:21 GMT, JMSCorrelationID=1754a6c1-8e18-4076-ae09-9f5770cdc45211, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/8694ac5b-5cae-469c-a3f3-fda052d6de8d/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=1754a6c1-8e18-4076-ae09-9f5770cdc45211} | exid=ID-esb-stage-37060-1595563687826-91-814 CID=1754a6c1-8e18-4076-ae09-9f5770cdc45211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"TSjUj3MBfrYj4vM9qsz8","_score":42.84854,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1059135,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T10:32:19.354Z","timestamp":"2020-07-27T13:32:19,354","thread":"thread #5122 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-811, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 10:32:21 GMT, JMSCorrelationID=1754a6c1-8e18-4076-ae09-9f5770cdc45211, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/8694ac5b-5cae-469c-a3f3-fda052d6de8d/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=1754a6c1-8e18-4076-ae09-9f5770cdc45211} | exid=ID-esb-stage-37060-1595563687826-91-814 CID=1754a6c1-8e18-4076-ae09-9f5770cdc45211 |\n {\"checkId\":\"8694ac5b-5cae-469c-a3f3-fda052d6de8d\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
281445 [main] INFO  kkm.UnitTests - End test

281449 [main] INFO  kkm.UnitTests - Starting test: KKM_WAcheckStatus()
281588 [main] INFO  kkm.UnitTests - End test

281594 [main] INFO  kkm.UnitTests - Starting test: KKM_getStatus()
284172 [main] INFO  kkm.UnitTests - End test

284174 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceledAlredy()
288305 [main] INFO  kkm.UnitTests - End test

288308 [main] INFO  kkm.UnitTests - Starting test: KKM_getDocCustomer()
288497 [main] INFO  kkm.UnitTests - End test

288500 [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckCashier()
291724 [main] INFO  kkm.UnitTests - End test

291727 [main] INFO  kkm.UnitTests - Starting test: KKM_DB1()
292407 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
292414 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898622
292416 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898622
292915 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000898622'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898622'
select * from ProcessStatus where srcID = 'ЖПлато_000898622'
292916 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000898622]
292921 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000898622]
353170 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898622'
353170 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, , ЖПлато_000898622]
353172 [main] INFO  kkm.UnitTests - End test

353174 [main] INFO  kkm.UnitTests - Starting test: KKM_DB2()
353311 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
353312 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
353313 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
353791 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
353792 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
353796 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
414026 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
414027 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, nothing, ЖПлато_000898541]
474037 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
474203 [main] INFO  kkm.UnitTests - Response message : {"took":93,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":3,"relation":"eq"},"max_score":11.078738,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"LbnajnMBfrYj4vM9jMFx","_score":11.078738,"_source":{"@timestamp":"2020-07-27T05:59:09.416Z","message":"{\"ts\":\"2020-07-27T05:59:09.415+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"f9e5edb1eb62c047\",\"spanId\":\"f9e5edb1eb62c047\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"f9e5edb1eb62c047\",\"X-B3-TraceId\":\"f9e5edb1eb62c047\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":43427463,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"JMkDj3MBfrYj4vM9ve66","_score":11.078738,"_source":{"@timestamp":"2020-07-27T06:44:09.676Z","docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T06:44:09.676+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"8fe5b5fc982cc728\",\"spanId\":\"8fe5b5fc982cc728\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8fe5b5fc982cc728\",\"X-B3-TraceId\":\"8fe5b5fc982cc728\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"log":{"offset":45502972,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"GSraj3MBfrYj4vM9AsTR","_score":11.078738,"_source":{"@timestamp":"2020-07-27T10:38:09.163Z","stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":5301396},"message":"{\"ts\":\"2020-07-27T10:38:09.163+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"cf2482f94452280f\",\"spanId\":\"cf2482f94452280f\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"cf2482f94452280f\",\"X-B3-TraceId\":\"cf2482f94452280f\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"agent":{"id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece"}}}]}}
474208 [main] INFO  kkm.UnitTests - End test

474211 [main] INFO  kkm.UnitTests - Starting test: KKM_DB3()
474342 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-huxqFuTvf3rC', '9797660146', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-huxqFuTvf3rC','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-huxqFuTvf3rC', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-huxqFuTvf3rC', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-huxqFuTvf3rC'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-huxqFuTvf3rC'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-huxqFuTvf3rC'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-huxqFuTvf3rC'
585028 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-huxqFuTvf3rC'
585029 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-huxqFuTvf3rC, b84db2fd-0636-4f3f-b249-ec5365f1f4a7]
585034 [main] INFO  kkm.UnitTests - Status: DONE
585035 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
585035 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
605140 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-huxqFuTvf3rC%22%20&size=500
605240 [main] INFO  kkm.UnitTests - Response message : {"took":31,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":28.050869,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"byvbj3MBfrYj4vM9z4XS","_score":28.050869,"_source":{"@timestamp":"2020-07-27T10:40:09.375Z","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":5415543},"stream":"stdout","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"message":"{\"ts\":\"2020-07-27T10:40:09.375+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"b61c35367b018e2a\",\"spanId\":\"b61c35367b018e2a\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"b61c35367b018e2a\",\"X-B3-TraceId\":\"b61c35367b018e2a\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-huxqFuTvf3rC\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-xapLuN0ZPFrW\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}}}}]}}
605361 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
605384 [main] INFO  kkm.UnitTests - End test

605385 [main] INFO  kkm.UnitTests - Starting test: KKM_DB4()
605502 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-5dvgbTlDZC0l', '6791018762', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-5dvgbTlDZC0l','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-5dvgbTlDZC0l', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-5dvgbTlDZC0l', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-5dvgbTlDZC0l'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-5dvgbTlDZC0l'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-5dvgbTlDZC0l'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-5dvgbTlDZC0l'
716118 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-5dvgbTlDZC0l'
716119 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-5dvgbTlDZC0l, b8d38006-4407-481e-8b27-356c3b8998b8]
716123 [main] INFO  kkm.UnitTests - Status: FAIL
716124 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
716124 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
736579 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-5dvgbTlDZC0l%22%20&size=500
736658 [main] INFO  kkm.UnitTests - Response message : {"took":26,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.734556,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"cSzdj3MBfrYj4vM9rIBy","_score":27.734556,"_source":{"@timestamp":"2020-07-27T10:42:09.224Z","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97"}}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T10:42:09.224+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"310ac807bccaad5c\",\"spanId\":\"310ac807bccaad5c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"310ac807bccaad5c\",\"X-B3-TraceId\":\"310ac807bccaad5c\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-5dvgbTlDZC0l\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-BxPKidICPNrY\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","host":{"name":"25805977eece"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"log":{"offset":5555708,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"ecs":{"version":"1.0.1"}}}]}}
736785 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
736809 [main] INFO  kkm.UnitTests - End test

736810 [main] INFO  kkm.UnitTests - Starting test: KKM_DB5()
736934 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-2kITiHwGBcpx', '0303861159', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-2kITiHwGBcpx','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-2kITiHwGBcpx', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-2kITiHwGBcpx', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-2kITiHwGBcpx'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-2kITiHwGBcpx'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-2kITiHwGBcpx'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-2kITiHwGBcpx'
847660 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-2kITiHwGBcpx'
847661 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-2kITiHwGBcpx, 894e1600-a802-4858-a234-42fd4c372516]
847665 [main] INFO  kkm.UnitTests - Status: DONE
847665 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
847665 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
867785 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-2kITiHwGBcpx%22%20&size=500
867899 [main] INFO  kkm.UnitTests - Response message : {"took":9,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.45508,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"ZS3fj3MBfrYj4vM9eRWz","_score":27.45508,"_source":{"@timestamp":"2020-07-27T10:44:09.242Z","log":{"offset":5702616,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","input":{"type":"container"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"message":"{\"ts\":\"2020-07-27T10:44:09.242+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"dd50ee109e67b74a\",\"spanId\":\"dd50ee109e67b74a\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"dd50ee109e67b74a\",\"X-B3-TraceId\":\"dd50ee109e67b74a\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-aLGNls6lPxjF\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-2kITiHwGBcpx\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"}}}]}}
868028 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
868055 [main] INFO  kkm.UnitTests - End test

868058 [main] INFO  kkm.UnitTests - Starting test: KKM_DB6()
868205 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-J3tCmlc3WsyO', '1741049999', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-J3tCmlc3WsyO','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-J3tCmlc3WsyO', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-J3tCmlc3WsyO', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-J3tCmlc3WsyO'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-J3tCmlc3WsyO'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-J3tCmlc3WsyO'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-J3tCmlc3WsyO'
979129 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-J3tCmlc3WsyO'
979129 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-J3tCmlc3WsyO, null]
979131 [main] INFO  kkm.UnitTests - Status: null
979131 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
979131 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
999136 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
999324 [main] INFO  kkm.UnitTests - Response message : {"took":133,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1296,"relation":"eq"},"max_score":3.5592182,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"o3aSjXMBfrYj4vM9LZH0","_score":3.5592182,"_source":{"@timestamp":"2020-07-27T00:00:09.153Z","ecs":{"version":"1.0.1"},"log":{"offset":28726039,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-27T00:00:09.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"d452230b2efe5ab7\",\"spanId\":\"d452230b2efe5ab7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d452230b2efe5ab7\",\"X-B3-TraceId\":\"d452230b2efe5ab7\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"OXaSjXMBfrYj4vM9UpQ9","_score":3.5592182,"_source":{"@timestamp":"2020-07-27T00:00:31.122Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"host":{"name":"25805977eece"},"input":{"type":"container"},"message":"{\"ts\":\"2020-07-27T00:00:31.122+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3dd65d6f98321076\",\"spanId\":\"3dd65d6f98321076\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3dd65d6f98321076\",\"X-B3-TraceId\":\"3dd65d6f98321076\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":28738954},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"X3ifjXMBfrYj4vM9nQx0","_score":3.5592182,"_source":{"@timestamp":"2020-07-27T00:15:09.048Z","stream":"stdout","log":{"offset":29337267,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T00:15:09.047+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9146b30fd146e783\",\"spanId\":\"9146b30fd146e783\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9146b30fd146e783\",\"X-B3-TraceId\":\"9146b30fd146e783\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"V3igjXMBfrYj4vM9AyUJ","_score":3.5592182,"_source":{"@timestamp":"2020-07-27T00:15:31.138Z","message":"{\"ts\":\"2020-07-27T00:15:31.138+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a1eefa1f7c6d7600\",\"spanId\":\"a1eefa1f7c6d7600\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a1eefa1f7c6d7600\",\"X-B3-TraceId\":\"a1eefa1f7c6d7600\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":29358423,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"r3igjXMBfrYj4vM9gyr3","_score":3.5592182,"_source":{"@timestamp":"2020-07-27T00:16:09.021Z","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":29383923,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:16:09.021+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7cd409989dfdfa52\",\"spanId\":\"7cd409989dfdfa52\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7cd409989dfdfa52\",\"X-B3-TraceId\":\"7cd409989dfdfa52\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
999440 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
999474 [main] INFO  kkm.UnitTests - End test

999475 [main] INFO  kkm.UnitTests - Starting test: KKM_DB7()
999597 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp', '1428281715', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp'
1110169 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp'
1110170 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-ZLiWUyCVy1xp, null]
1110174 [main] INFO  kkm.UnitTests - Status: null
1110175 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1110175 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1130176 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1130227 [main] INFO  kkm.UnitTests - Response message : {"took":2,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1300,"relation":"eq"},"max_score":3.5590937,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"o3aSjXMBfrYj4vM9LZH0","_score":3.5590937,"_source":{"@timestamp":"2020-07-27T00:00:09.153Z","ecs":{"version":"1.0.1"},"log":{"offset":28726039,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-27T00:00:09.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"d452230b2efe5ab7\",\"spanId\":\"d452230b2efe5ab7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d452230b2efe5ab7\",\"X-B3-TraceId\":\"d452230b2efe5ab7\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"OXaSjXMBfrYj4vM9UpQ9","_score":3.5590937,"_source":{"@timestamp":"2020-07-27T00:00:31.122Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"host":{"name":"25805977eece"},"input":{"type":"container"},"message":"{\"ts\":\"2020-07-27T00:00:31.122+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3dd65d6f98321076\",\"spanId\":\"3dd65d6f98321076\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3dd65d6f98321076\",\"X-B3-TraceId\":\"3dd65d6f98321076\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":28738954},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"X3ifjXMBfrYj4vM9nQx0","_score":3.5590937,"_source":{"@timestamp":"2020-07-27T00:15:09.048Z","stream":"stdout","log":{"offset":29337267,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T00:15:09.047+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9146b30fd146e783\",\"spanId\":\"9146b30fd146e783\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9146b30fd146e783\",\"X-B3-TraceId\":\"9146b30fd146e783\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"V3igjXMBfrYj4vM9AyUJ","_score":3.5590937,"_source":{"@timestamp":"2020-07-27T00:15:31.138Z","message":"{\"ts\":\"2020-07-27T00:15:31.138+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a1eefa1f7c6d7600\",\"spanId\":\"a1eefa1f7c6d7600\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a1eefa1f7c6d7600\",\"X-B3-TraceId\":\"a1eefa1f7c6d7600\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":29358423,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"r3igjXMBfrYj4vM9gyr3","_score":3.5590937,"_source":{"@timestamp":"2020-07-27T00:16:09.021Z","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":29383923,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:16:09.021+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7cd409989dfdfa52\",\"spanId\":\"7cd409989dfdfa52\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7cd409989dfdfa52\",\"X-B3-TraceId\":\"7cd409989dfdfa52\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
1130357 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1130386 [main] INFO  kkm.UnitTests - End test

1130386 [main] INFO  kkm.UnitTests - Starting test: KKM_DB8()
1130508 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-997qfFUmsEes', '4690915448', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-997qfFUmsEes','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-997qfFUmsEes', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-997qfFUmsEes', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-997qfFUmsEes'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-997qfFUmsEes'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-997qfFUmsEes'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-997qfFUmsEes'
1241242 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-997qfFUmsEes'
1241243 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-997qfFUmsEes, null]
1241247 [main] INFO  kkm.UnitTests - Status: null
1241248 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1241248 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1261251 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1261305 [main] INFO  kkm.UnitTests - Response message : {"took":2,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1306,"relation":"eq"},"max_score":3.559035,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"o3aSjXMBfrYj4vM9LZH0","_score":3.559035,"_source":{"@timestamp":"2020-07-27T00:00:09.153Z","ecs":{"version":"1.0.1"},"log":{"offset":28726039,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-27T00:00:09.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"d452230b2efe5ab7\",\"spanId\":\"d452230b2efe5ab7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d452230b2efe5ab7\",\"X-B3-TraceId\":\"d452230b2efe5ab7\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"OXaSjXMBfrYj4vM9UpQ9","_score":3.559035,"_source":{"@timestamp":"2020-07-27T00:00:31.122Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"host":{"name":"25805977eece"},"input":{"type":"container"},"message":"{\"ts\":\"2020-07-27T00:00:31.122+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3dd65d6f98321076\",\"spanId\":\"3dd65d6f98321076\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3dd65d6f98321076\",\"X-B3-TraceId\":\"3dd65d6f98321076\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":28738954},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"X3ifjXMBfrYj4vM9nQx0","_score":3.559035,"_source":{"@timestamp":"2020-07-27T00:15:09.048Z","stream":"stdout","log":{"offset":29337267,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T00:15:09.047+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9146b30fd146e783\",\"spanId\":\"9146b30fd146e783\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9146b30fd146e783\",\"X-B3-TraceId\":\"9146b30fd146e783\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"V3igjXMBfrYj4vM9AyUJ","_score":3.559035,"_source":{"@timestamp":"2020-07-27T00:15:31.138Z","message":"{\"ts\":\"2020-07-27T00:15:31.138+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a1eefa1f7c6d7600\",\"spanId\":\"a1eefa1f7c6d7600\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a1eefa1f7c6d7600\",\"X-B3-TraceId\":\"a1eefa1f7c6d7600\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":29358423,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"r3igjXMBfrYj4vM9gyr3","_score":3.559035,"_source":{"@timestamp":"2020-07-27T00:16:09.021Z","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":29383923,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:16:09.021+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7cd409989dfdfa52\",\"spanId\":\"7cd409989dfdfa52\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7cd409989dfdfa52\",\"X-B3-TraceId\":\"7cd409989dfdfa52\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
1261427 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
1261454 [main] INFO  kkm.UnitTests - End test

1261455 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageWasCanceled()
1264179 [main] INFO  kkm.UnitTests - End test

1264182 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceleNotFound()
1264222 [main] INFO  kkm.UnitTests - End test

1264225 [main] INFO  kkm.UnitTests - Starting test: KKM_makeAndCancelCheckCashier()
1520991 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.27/_search?q=%20message:%20%22CID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2%22%20
1523234 [main] INFO  kkm.UnitTests - Response message : {"took":2185,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":50.71176,"hits":[{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"gTDnj3MBfrYj4vM9mEsM","_score":50.71176,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":19292136,"@timestamp":"2020-07-27T10:52:59.435Z","beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"timestamp":"2020-07-27T13:52:59,435","thread":"qtp529223075-309123","message":"KkmService: REST request  Operation 'CancelReceipt' was call with body: 577f082c-364d-4ff2-a73b-f9b6dcc3db21 | exid=ID-esb-stage-37060-1595563687826-91-3037 CID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"ajDnj3MBfrYj4vM9z2X4","_score":48.300808,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":19296257,"@timestamp":"2020-07-27T10:52:59.482Z","beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"timestamp":"2020-07-27T13:52:59,482","thread":"qtp529223075-309123","message":"KkmService: REST response Operation 'CancelReceipt' was complete with body: CancelReceiptResponse{correlationId='null', checkId='577f082c-364d-4ff2-a73b-f9b6dcc3db21', canceledCheckId='d885c077-9a03-463f-96f0-58eba1331ad2', error=null} | exid=ID-esb-stage-37060-1595563687826-91-3037 CID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"7DDnj3MBfrYj4vM9mEoD","_score":47.179306,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":19291659,"@timestamp":"2020-07-27T10:52:59.435Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T13:52:59,435","thread":"qtp529223075-309123","message":"KkmService: REST request  Operation 'CancelReceipt' was call with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-3036, JMSCorrelationID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2, operationName=CancelReceipt, X-VSK-CorrelationId=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2} | exid=ID-esb-stage-37060-1595563687826-91-3037 CID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"CjDnj3MBfrYj4vM9mEsD","_score":44.754585,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":19292447,"beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"@timestamp":"2020-07-27T10:52:59.436Z","timestamp":"2020-07-27T13:52:59,436","thread":"thread #5142 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-3036, CamelHttpMethod=PUT, JMSCorrelationID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/577f082c-364d-4ff2-a73b-f9b6dcc3db21/cancel, X-VSK-CorrelationId=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2} | exId=ID-esb-stage-37060-1595563687826-91-3039 CID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"YzDnj3MBfrYj4vM9mEsL","_score":43.47774,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":19293058,"@timestamp":"2020-07-27T10:52:59.436Z","beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"timestamp":"2020-07-27T13:52:59,436","thread":"thread #5142 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-91-3036, CamelHttpMethod=PUT, JMSCorrelationID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/577f082c-364d-4ff2-a73b-f9b6dcc3db21/cancel, X-VSK-CorrelationId=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2} | exId=ID-esb-stage-37060-1595563687826-91-3039 CID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2 |\n 577f082c-364d-4ff2-a73b-f9b6dcc3db21","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"7TDnj3MBfrYj4vM9mEoD","_score":40.58315,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":19295432,"@timestamp":"2020-07-27T10:52:59.482Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T13:52:59,482","thread":"qtp529223075-309123","message":"KkmService: REST response Operation 'CancelReceipt' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-3036, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 10:53:00 GMT, JMSCorrelationID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/577f082c-364d-4ff2-a73b-f9b6dcc3db21/cancel, X-VSK-CorrelationId=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2} | exid=ID-esb-stage-37060-1595563687826-91-3037 CID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"RTDnj3MBfrYj4vM9mEsL","_score":40.58315,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":19293709,"@timestamp":"2020-07-27T10:52:59.482Z","beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"timestamp":"2020-07-27T13:52:59,482","thread":"thread #5142 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-3036, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 10:53:00 GMT, JMSCorrelationID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/577f082c-364d-4ff2-a73b-f9b6dcc3db21/cancel, X-VSK-CorrelationId=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2} | exid=ID-esb-stage-37060-1595563687826-91-3039 CID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"KDDnj3MBfrYj4vM9mEsE","_score":39.530437,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":19294515,"beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"@timestamp":"2020-07-27T10:52:59.482Z","timestamp":"2020-07-27T13:52:59,482","thread":"thread #5142 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-91-3036, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 10:53:00 GMT, JMSCorrelationID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/577f082c-364d-4ff2-a73b-f9b6dcc3db21/cancel, X-VSK-CorrelationId=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2} | exid=ID-esb-stage-37060-1595563687826-91-3039 CID=780ad32c-3d8d-486a-9ca9-dfa1a435c1bf2 |\n {\"checkId\":\"577f082c-364d-4ff2-a73b-f9b6dcc3db21\",\"canceledCheckId\":\"d885c077-9a03-463f-96f0-58eba1331ad2\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
1523235 [main] INFO  kkm.UnitTests - End test

1523238 [main] INFO  kkm.UnitTests - Starting test: KKM_SIPheckStatus()
1525901 [main] INFO  kkm.UnitTests - End test

1525904 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageNotFound()
1525966 [main] INFO  kkm.UnitTests - End test

1525968 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt_negative()
1526117 [main] INFO  kkm.UnitTests - End test

1526119 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt()
1528518 [main] INFO  kkm.UnitTests - End test

