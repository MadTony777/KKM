176  [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGatewayWithStubs_DONE()
401  [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
403  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
406  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
912  [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
913  [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
916  [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
61210 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
61211 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, nothing, ЖПлато_000898541]
122314 [main] INFO  kkm.UnitTests - End test

122323 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_Error()
122487 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
122488 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
122489 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
122941 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000901797'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000901797'
select * from ProcessStatus where srcID = 'ЖПлато_000901797'
122942 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
122946 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
183280 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000901797'
183281 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000901797]
243439 [main] INFO  kkm.UnitTests - End test

243450 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_NOFILIAL()
243664 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-AWYO9CFQxcHB', '1010349834', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-AWYO9CFQxcHB','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-AWYO9CFQxcHB', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-AWYO9CFQxcHB', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-AWYO9CFQxcHB'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-AWYO9CFQxcHB'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-AWYO9CFQxcHB'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-AWYO9CFQxcHB'
354435 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-AWYO9CFQxcHB'
354435 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-AWYO9CFQxcHB, null]
354437 [main] INFO  kkm.UnitTests - Status: null
354437 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
354437 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
374762 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
374796 [main] INFO  kkm.UnitTests - End test

374801 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_UTC12_DONE()
374988 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-rvxmw3zznIOR', '4500639989', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-rvxmw3zznIOR','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-rvxmw3zznIOR', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-rvxmw3zznIOR', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-rvxmw3zznIOR'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-rvxmw3zznIOR'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-rvxmw3zznIOR'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-rvxmw3zznIOR'
485927 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-rvxmw3zznIOR'
485928 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-rvxmw3zznIOR, null]
485931 [main] INFO  kkm.UnitTests - Status: null
485931 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
485931 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
506222 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
506247 [main] INFO  kkm.UnitTests - End test

506252 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_UTC2_FAIL()
506455 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DlZTjJsgxq7i', '8832270862', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DlZTjJsgxq7i','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DlZTjJsgxq7i', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DlZTjJsgxq7i', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-DlZTjJsgxq7i'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-DlZTjJsgxq7i'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-DlZTjJsgxq7i'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-DlZTjJsgxq7i'
617235 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-DlZTjJsgxq7i'
617236 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-DlZTjJsgxq7i, null]
617239 [main] INFO  kkm.UnitTests - Status: null
617239 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
617240 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
637537 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
637561 [main] INFO  kkm.UnitTests - End test

637566 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_UTC12_DONE()
637746 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-SxkubUhhUzA8', '7187211482', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-SxkubUhhUzA8','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-SxkubUhhUzA8', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-SxkubUhhUzA8', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-SxkubUhhUzA8'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-SxkubUhhUzA8'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-SxkubUhhUzA8'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-SxkubUhhUzA8'
748453 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-SxkubUhhUzA8'
748453 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, SENDED, , , 9SD0C9DZ-9289-4A09-SxkubUhhUzA8, b175daad-6bb5-4fa9-bed3-4df62872c712]
748456 [main] INFO  kkm.UnitTests - Status: SENDED
748457 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
748457 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
748623 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/b175daad-6bb5-4fa9-bed3-4df62872c712
748623 [main] INFO  kkm.UnitTests - Response Code : 200
748649 [main] INFO  kkm.UnitTests - [DONE]
768736 [main] INFO  kkm.UnitTests - End test

768745 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_NOFILIAL()
768980 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-umyuv51u7xVG', '2977427165', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-umyuv51u7xVG','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-umyuv51u7xVG', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-umyuv51u7xVG', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-umyuv51u7xVG'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-umyuv51u7xVG'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-umyuv51u7xVG'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-umyuv51u7xVG'
879946 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-umyuv51u7xVG'
879947 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-umyuv51u7xVG, dd95712b-9c38-4c2f-b47e-1b132e3aadc8]
879950 [main] INFO  kkm.UnitTests - Status: DONE
879950 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
879951 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
880069 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/dd95712b-9c38-4c2f-b47e-1b132e3aadc8
880069 [main] INFO  kkm.UnitTests - Response Code : 200
880072 [main] INFO  kkm.UnitTests - [DONE]
900166 [main] INFO  kkm.UnitTests - End test

900173 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_UTC2_FAIL()
900317 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-JT3OsHpGPOdZ', '8628552342', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-JT3OsHpGPOdZ','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-JT3OsHpGPOdZ', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-JT3OsHpGPOdZ', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-JT3OsHpGPOdZ'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-JT3OsHpGPOdZ'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-JT3OsHpGPOdZ'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-JT3OsHpGPOdZ'
1011210 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-JT3OsHpGPOdZ'
1011211 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-JT3OsHpGPOdZ, fc157e8e-e6c9-46b4-88d3-3a998cb201d2]
1011215 [main] INFO  kkm.UnitTests - Status: FAIL
1011215 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
1011215 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
1011725 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/fc157e8e-e6c9-46b4-88d3-3a998cb201d2
1011726 [main] INFO  kkm.UnitTests - Response Code : 200
1011727 [main] INFO  kkm.UnitTests - [FAIL]
1031821 [main] INFO  kkm.UnitTests - End test

