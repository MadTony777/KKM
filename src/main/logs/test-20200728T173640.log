140  [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckNoCashier()
3042 [main] INFO  kkm.UnitTests - End test

3051 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageEmail()
276088 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-test-2020.07.28/_search?q=%20message:%20%22CID=19986892-4318-4ae2-afba-3075cc70eec711%22%20
276491 [main] INFO  kkm.UnitTests - Response message : {"took":302,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":50.06614,"hits":[{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"j9-klXMBtD96ebe8ik7i","_score":50.06614,"_source":{"level":"trace","@timestamp":"2020-07-28T13:37:16.747Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST response Operation 'SendMessage' was complete with body: ReceiptResponse{correlationId='null', checkId='a638a394-0812-4254-9c4e-f7c3e19dd9c4', error=null} | exid=ID-esb-test01-39552-1595922638059-71-3452 CID=19986892-4318-4ae2-afba-3075cc70eec711","thread":"qtp1413042234-26078","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:37:16,747","input":{"type":"log"},"offset":35432355,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"09-klXMBtD96ebe8UDNO","_score":49.886005,"_source":{"level":"trace","@timestamp":"2020-07-28T13:37:16.728Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST request  Operation 'SendMessage' was call with body: SendMessageRequest{checkId='a638a394-0812-4254-9c4e-f7c3e19dd9c4', messageType='email', messageAddress='EPolikarpova@VSK.RU'} | exid=ID-esb-test01-39552-1595922638059-71-3452 CID=19986892-4318-4ae2-afba-3075cc70eec711","thread":"qtp1413042234-26078","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:37:16,728","input":{"type":"log"},"offset":35428009,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"0t-klXMBtD96ebe8UDNO","_score":47.98677,"_source":{"level":"debug","@timestamp":"2020-07-28T13:37:16.728Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST request  Operation 'SendMessage' was call with headers: {breadcrumbId=ID-esb-test01-39552-1595922638059-71-3451, JMSCorrelationID=19986892-4318-4ae2-afba-3075cc70eec711, operationName=SendMessage, X-VSK-CorrelationId=19986892-4318-4ae2-afba-3075cc70eec711} | exid=ID-esb-test01-39552-1595922638059-71-3452 CID=19986892-4318-4ae2-afba-3075cc70eec711","thread":"qtp1413042234-26078","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:37:16,728","input":{"type":"log"},"offset":35427531,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"1N-klXMBtD96ebe8UDNO","_score":45.172585,"_source":{"level":"debug","@timestamp":"2020-07-28T13:37:16.729Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-test01-39552-1595922638059-71-3451, CamelHttpMethod=GET, JMSCorrelationID=19986892-4318-4ae2-afba-3075cc70eec711, operationName=SendMessage, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/a638a394-0812-4254-9c4e-f7c3e19dd9c4/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=19986892-4318-4ae2-afba-3075cc70eec711} | exId=ID-esb-test01-39552-1595922638059-71-3454 CID=19986892-4318-4ae2-afba-3075cc70eec711","thread":"thread #4028 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:37:16,729","input":{"type":"log"},"offset":35428409,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"1d-klXMBtD96ebe8UDNO","_score":45.172585,"_source":{"level":"trace","@timestamp":"2020-07-28T13:37:16.729Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-test01-39552-1595922638059-71-3451, CamelHttpMethod=GET, JMSCorrelationID=19986892-4318-4ae2-afba-3075cc70eec711, operationName=SendMessage, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/a638a394-0812-4254-9c4e-f7c3e19dd9c4/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=19986892-4318-4ae2-afba-3075cc70eec711} | exId=ID-esb-test01-39552-1595922638059-71-3454 CID=19986892-4318-4ae2-afba-3075cc70eec711 |\n ","thread":"thread #4028 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"@version":"1","environment":"test","timestamp":"2020-07-28T16:37:16,729","input":{"type":"log"},"offset":35429040,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"1t-klXMBtD96ebe8UDNO","_score":40.907635,"_source":{"level":"debug","@timestamp":"2020-07-28T13:37:16.746Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-39552-1595922638059-71-3451, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 13:37:16 GMT, JMSCorrelationID=19986892-4318-4ae2-afba-3075cc70eec711, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/a638a394-0812-4254-9c4e-f7c3e19dd9c4/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=19986892-4318-4ae2-afba-3075cc70eec711} | exid=ID-esb-test01-39552-1595922638059-71-3454 CID=19986892-4318-4ae2-afba-3075cc70eec711","thread":"thread #4028 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:37:16,746","input":{"type":"log"},"offset":35429675,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"2N-klXMBtD96ebe8UDNO","_score":40.907635,"_source":{"level":"debug","@timestamp":"2020-07-28T13:37:16.747Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST response Operation 'SendMessage' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-39552-1595922638059-71-3451, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 13:37:16 GMT, JMSCorrelationID=19986892-4318-4ae2-afba-3075cc70eec711, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/a638a394-0812-4254-9c4e-f7c3e19dd9c4/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=19986892-4318-4ae2-afba-3075cc70eec711} | exid=ID-esb-test01-39552-1595922638059-71-3452 CID=19986892-4318-4ae2-afba-3075cc70eec711","thread":"qtp1413042234-26078","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:37:16,747","input":{"type":"log"},"offset":35431467,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"19-klXMBtD96ebe8UDNO","_score":39.964333,"_source":{"level":"trace","@timestamp":"2020-07-28T13:37:16.747Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-39552-1595922638059-71-3451, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 13:37:16 GMT, JMSCorrelationID=19986892-4318-4ae2-afba-3075cc70eec711, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/a638a394-0812-4254-9c4e-f7c3e19dd9c4/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=19986892-4318-4ae2-afba-3075cc70eec711} | exid=ID-esb-test01-39552-1595922638059-71-3454 CID=19986892-4318-4ae2-afba-3075cc70eec711 |\n {\"checkId\":\"a638a394-0812-4254-9c4e-f7c3e19dd9c4\"}","thread":"thread #4028 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"@version":"1","environment":"test","timestamp":"2020-07-28T16:37:16,747","input":{"type":"log"},"offset":35430544,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}}]}}
276493 [main] INFO  kkm.UnitTests - End test

276498 [main] INFO  kkm.UnitTests - Starting test: KKM_WAcheckStatus()
279108 [main] INFO  kkm.UnitTests - End test

279113 [main] INFO  kkm.UnitTests - Starting test: KKM_getStatus()
284590 [main] INFO  kkm.UnitTests - End test

284593 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceledAlredy()
288622 [main] INFO  kkm.UnitTests - End test

288624 [main] INFO  kkm.UnitTests - Starting test: KKM_getDocCustomer()
288951 [main] INFO  kkm.UnitTests - End test

288954 [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckCashier()
320547 [main] INFO  kkm.UnitTests - End test

320550 [main] INFO  kkm.UnitTests - Starting test: KKM_DB1()
320894 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
320897 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000902849
320899 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000902849
321478 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000902849'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000902849'
select * from ProcessStatus where srcID = 'ЖПлато_000902849'
321479 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000902849]
321484 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000902849]
381799 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000902849'
381800 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000902849]
441812 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000902849%22%20&size=500
442056 [main] INFO  kkm.UnitTests - Response message : {"took":154,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":3,"relation":"eq"},"max_score":11.886193,"hits":[{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"Dnj2k3MBtD96ebe8fEGF","_score":11.886193,"_source":{"@timestamp":"2020-07-28T05:47:49.687Z","container":{"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"json":{"msg":"ReadyForSendingReceiptKeys selected ","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","X-B3-SpanId":"6fbed80fb871dc3c","spanId":"6fbed80fb871dc3c","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000902849"}],"ts":"2020-07-28T05:47:49.687+00:00","thread":"scheduling-1","caller_line_number":84,"spanExportable":"true","X-Span-Export":"true","X-B3-TraceId":"6fbed80fb871dc3c","level":"INFO","caller_file_name":"KkmCommutatorService.java","traceId":"6fbed80fb871dc3c","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys"},"log":{"offset":124785881,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Description":"KKM Commutator Service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"stream":"stdout","message":"{\"ts\":\"2020-07-28T05:47:49.687+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"6fbed80fb871dc3c\",\"spanId\":\"6fbed80fb871dc3c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"6fbed80fb871dc3c\",\"X-B3-TraceId\":\"6fbed80fb871dc3c\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000902849\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}"}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"gNiOlXMBtD96ebe8yc1a","_score":11.886193,"_source":{"@timestamp":"2020-07-28T13:13:50.137Z","host":{"name":"44fcff07405a"},"agent":{"ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat"},"json":{"msg":"ReadyForSendingReceiptKeys selected ","spanExportable":"true","X-Span-Export":"true","X-B3-SpanId":"cd5eb5b1cfb9c30b","X-B3-TraceId":"cd5eb5b1cfb9c30b","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","spanId":"cd5eb5b1cfb9c30b","ts":"2020-07-28T13:13:50.133+00:00","thread":"scheduling-1","X-VSK-ReceiptKeys":[{"srcID":"ЖПлато_000902849","systemCode":"AXAPTA","entityCode":"PaymentOrder"}],"level":"INFO","method":"getReadyForSendingReceiptKeys","caller_line_number":84,"traceId":"cd5eb5b1cfb9c30b"},"log":{"file":{"path":"/var/lib/docker/containers/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919-json.log"},"offset":8443609},"stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-28T13:13:50.133+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"cd5eb5b1cfb9c30b\",\"spanId\":\"cd5eb5b1cfb9c30b\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"cd5eb5b1cfb9c30b\",\"X-B3-TraceId\":\"cd5eb5b1cfb9c30b\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000902849\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919","name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","Version":"97","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"mell1zgqaxfs52lz4o568c33e","com_docker_stack_namespace":"kkm-commutator"}}}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"P-GplXMBtD96ebe8XkLC","_score":11.886193,"_source":{"@timestamp":"2020-07-28T13:42:50.050Z","log":{"file":{"path":"/var/lib/docker/containers/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919-json.log"},"offset":9254676},"message":"{\"ts\":\"2020-07-28T13:42:50.050+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"0f04e8d1f3b6d232\",\"spanId\":\"0f04e8d1f3b6d232\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"0f04e8d1f3b6d232\",\"X-B3-TraceId\":\"0f04e8d1f3b6d232\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000902849\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","host":{"name":"44fcff07405a"},"json":{"class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","thread":"scheduling-1","spanId":"0f04e8d1f3b6d232","X-B3-TraceId":"0f04e8d1f3b6d232","msg":"ReadyForSendingReceiptKeys selected ","caller_file_name":"KkmCommutatorService.java","spanExportable":"true","X-Span-Export":"true","traceId":"0f04e8d1f3b6d232","ts":"2020-07-28T13:42:50.050+00:00","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","level":"INFO","caller_line_number":84,"X-B3-SpanId":"0f04e8d1f3b6d232","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000902849"}]},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"stream":"stdout","input":{"type":"container"},"container":{"id":"dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919","name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task":"","Version":"97","com_docker_swarm_task_id":"mell1zgqaxfs52lz4o568c33e","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service"}}},"ecs":{"version":"1.0.1"}}}]}}
442060 [main] INFO  kkm.UnitTests - End test

442064 [main] INFO  kkm.UnitTests - Starting test: KKM_DB2()
442237 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
442237 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
442238 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
442982 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
442983 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
442986 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
503351 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
503351 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, DONE, nothing, ЖПлато_000898541]
563358 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
563538 [main] INFO  kkm.UnitTests - Response message : {"took":91,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":3,"relation":"eq"},"max_score":11.09636,"hits":[{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"aXj4k3MBtD96ebe8UYVe","_score":11.09636,"_source":{"@timestamp":"2020-07-28T05:49:50.048Z","ecs":{"version":"1.0.1"},"json":{"logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","spanId":"24a9e57798576c78","X-B3-TraceId":"24a9e57798576c78","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000898541"}],"caller_line_number":84,"traceId":"24a9e57798576c78","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","spanExportable":"true","X-B3-SpanId":"24a9e57798576c78","msg":"ReadyForSendingReceiptKeys selected ","ts":"2020-07-28T05:49:50.048+00:00","level":"INFO","method":"getReadyForSendingReceiptKeys","caller_file_name":"KkmCommutatorService.java","X-Span-Export":"true"},"container":{"id":"00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349","name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","Version":"97","com_docker_swarm_task_id":"y0jav1ig1ifqrahe5mljlvlbn","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.y0jav1ig1ifqrahe5mljlvlbn"}}},"host":{"name":"44fcff07405a"},"input":{"type":"container"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"log":{"offset":124853335,"file":{"path":"/var/lib/docker/containers/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349/00ca793697af82fc761399c20f40ffa23f75f34f7713112fd967a0fa8bb57349-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-28T05:49:50.048+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"24a9e57798576c78\",\"spanId\":\"24a9e57798576c78\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"24a9e57798576c78\",\"X-B3-TraceId\":\"24a9e57798576c78\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}"}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"GdmQlXMBtD96ebe8tbJa","_score":11.09636,"_source":{"@timestamp":"2020-07-28T13:15:49.744Z","message":"{\"ts\":\"2020-07-28T13:15:49.744+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"022eceec969a35cb\",\"spanId\":\"022eceec969a35cb\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"022eceec969a35cb\",\"X-B3-TraceId\":\"022eceec969a35cb\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"container":{"id":"dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919","name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task":"","Version":"97","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"mell1zgqaxfs52lz4o568c33e","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e"}}},"json":{"spanId":"022eceec969a35cb","X-Span-Export":"true","msg":"ReadyForSendingReceiptKeys selected ","ts":"2020-07-28T13:15:49.744+00:00","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","X-B3-SpanId":"022eceec969a35cb","X-B3-TraceId":"022eceec969a35cb","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000898541"}],"caller_line_number":84,"spanExportable":"true","thread":"scheduling-1","traceId":"022eceec969a35cb","level":"INFO","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys"},"stream":"stdout","log":{"file":{"path":"/var/lib/docker/containers/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919-json.log"},"offset":8508529},"host":{"name":"44fcff07405a"},"agent":{"id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a"},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"3eGrlXMBtD96ebe8O4dk","_score":11.09636,"_source":{"@timestamp":"2020-07-28T13:44:49.935Z","docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Version":"97","com_docker_swarm_task_id":"mell1zgqaxfs52lz4o568c33e","Description":"KKM Commutator Service"}}},"container":{"id":"dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919","name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"ecs":{"version":"1.0.1"},"json":{"X-B3-SpanId":"18dc5db57af02175","level":"INFO","caller_file_name":"KkmCommutatorService.java","caller_line_number":84,"spanId":"18dc5db57af02175","X-Span-Export":"true","X-VSK-ReceiptKeys":[{"systemCode":"AXAPTA","entityCode":"PaymentOrder","srcID":"ЖПлато_000898541"}],"class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","method":"getReadyForSendingReceiptKeys","msg":"ReadyForSendingReceiptKeys selected ","ts":"2020-07-28T13:44:49.935+00:00","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","thread":"scheduling-1","traceId":"18dc5db57af02175","spanExportable":"true","X-B3-TraceId":"18dc5db57af02175"},"stream":"stdout","input":{"type":"container"},"host":{"name":"44fcff07405a"},"log":{"offset":9319589,"file":{"path":"/var/lib/docker/containers/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919-json.log"}},"message":"{\"ts\":\"2020-07-28T13:44:49.935+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"18dc5db57af02175\",\"spanId\":\"18dc5db57af02175\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"18dc5db57af02175\",\"X-B3-TraceId\":\"18dc5db57af02175\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}"}}]}}
563539 [main] INFO  kkm.UnitTests - End test

563540 [main] INFO  kkm.UnitTests - Starting test: KKM_DB3()
563718 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jRHJdxCYKi2q', '4621409865', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jRHJdxCYKi2q','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jRHJdxCYKi2q', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jRHJdxCYKi2q', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-jRHJdxCYKi2q'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-jRHJdxCYKi2q'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-jRHJdxCYKi2q'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-jRHJdxCYKi2q'
674924 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-jRHJdxCYKi2q'
674925 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-jRHJdxCYKi2q, null]
674929 [main] INFO  kkm.UnitTests - Status: null
674930 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
674930 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
675076 [main] INFO  kkm.UnitTests - End test

675082 [main] INFO  kkm.UnitTests - Starting test: KKM_DB4()
675537 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Ig6xH841vUwE', '2111178862', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Ig6xH841vUwE','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Ig6xH841vUwE', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-Ig6xH841vUwE', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-Ig6xH841vUwE'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-Ig6xH841vUwE'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-Ig6xH841vUwE'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-Ig6xH841vUwE'
786299 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-Ig6xH841vUwE'
786300 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-Ig6xH841vUwE, 3bf316e6-cde6-440f-ab15-b85850b54130]
786303 [main] INFO  kkm.UnitTests - Status: FAIL
786303 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
786303 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
806774 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-Ig6xH841vUwE%22%20&size=500
806934 [main] INFO  kkm.UnitTests - Response message : {"took":104,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.97043,"hits":[{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"beGulXMBtD96ebe85esC","_score":27.97043,"_source":{"@timestamp":"2020-07-28T13:48:50.064Z","stream":"stdout","message":"{\"ts\":\"2020-07-28T13:48:50.064+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"8fb0e2267a11e53c\",\"spanId\":\"8fb0e2267a11e53c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8fb0e2267a11e53c\",\"X-B3-TraceId\":\"8fb0e2267a11e53c\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-Ig6xH841vUwE\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-HdWwZNTxGSyT\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task":"","com_docker_swarm_task_id":"mell1zgqaxfs52lz4o568c33e","com_docker_stack_namespace":"kkm-commutator","Version":"97"}}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"log":{"offset":9435638,"file":{"path":"/var/lib/docker/containers/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919-json.log"}},"input":{"type":"container"},"container":{"id":"dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919","name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc"},"json":{"ts":"2020-07-28T13:48:50.064+00:00","thread":"scheduling-1","X-B3-TraceId":"8fb0e2267a11e53c","spanId":"8fb0e2267a11e53c","X-Span-Export":"true","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","caller_line_number":84,"method":"getReadyForSendingReceiptKeys","X-VSK-ReceiptKeys":[{"entityCode":"Payment","srcID":"9SD0C9DZ-9289-4A09-Ig6xH841vUwE","systemCode":"ADINSURE"},{"srcID":"9SD0C9DZ-9289-4A09-HdWwZNTxGSyT","systemCode":"ADINSURE","entityCode":"Payment"}],"msg":"ReadyForSendingReceiptKeys selected ","level":"INFO","traceId":"8fb0e2267a11e53c","spanExportable":"true","X-B3-SpanId":"8fb0e2267a11e53c"}}}]}}
807104 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
807127 [main] INFO  kkm.UnitTests - End test

807128 [main] INFO  kkm.UnitTests - Starting test: KKM_DB5()
807275 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-btxbEHn4108z', '0520679262', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-btxbEHn4108z','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-btxbEHn4108z', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-btxbEHn4108z', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-btxbEHn4108z'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-btxbEHn4108z'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-btxbEHn4108z'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-btxbEHn4108z'
918053 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-btxbEHn4108z'
918054 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, SENDED, , , 9SD0C9DZ-9289-4A09-btxbEHn4108z, a2a11db5-8478-4beb-adb6-cb99791cb697]
918058 [main] INFO  kkm.UnitTests - Status: SENDED
918059 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
918059 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
938179 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-btxbEHn4108z%22%20&size=500
938303 [main] INFO  kkm.UnitTests - Response message : {"took":68,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":29.910538,"hits":[{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"d-KxlXMBtD96ebe8lDak","_score":29.910538,"_source":{"@timestamp":"2020-07-28T13:51:49.734Z","stream":"stdout","message":"{\"ts\":\"2020-07-28T13:51:49.734+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"0b398893295830a1\",\"spanId\":\"0b398893295830a1\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"0b398893295830a1\",\"X-B3-TraceId\":\"0b398893295830a1\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-btxbEHn4108z\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919","name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"44fcff07405a"},"ecs":{"version":"1.0.1"},"json":{"level":"INFO","thread":"scheduling-1","traceId":"0b398893295830a1","spanExportable":"true","X-VSK-ReceiptKeys":[{"entityCode":"Payment","srcID":"9SD0C9DZ-9289-4A09-btxbEHn4108z","systemCode":"ADINSURE"}],"method":"getReadyForSendingReceiptKeys","caller_line_number":84,"X-Span-Export":"true","X-B3-SpanId":"0b398893295830a1","msg":"ReadyForSendingReceiptKeys selected ","X-B3-TraceId":"0b398893295830a1","ts":"2020-07-28T13:51:49.734+00:00","logger":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","class":"ru.vsk.integration.kkmcommutator.KkmCommutatorService","caller_file_name":"KkmCommutatorService.java","spanId":"0b398893295830a1"},"log":{"offset":9604161,"file":{"path":"/var/lib/docker/containers/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919/dbafdac905a7d93f760aebfc04aaeca8053b6fb2ffab62d382ba83492a254919-json.log"}},"input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_task_name":"kkm-commutator_service.1.mell1zgqaxfs52lz4o568c33e","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"mell1zgqaxfs52lz4o568c33e","com_docker_stack_namespace":"kkm-commutator","Version":"97"}}},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"}}}]}}
938450 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
938475 [main] INFO  kkm.UnitTests - End test

938477 [main] INFO  kkm.UnitTests - Starting test: KKM_DB6()
938612 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DhYdWkCfszER', '9203298019', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DhYdWkCfszER','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DhYdWkCfszER', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-DhYdWkCfszER', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-DhYdWkCfszER'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-DhYdWkCfszER'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-DhYdWkCfszER'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-DhYdWkCfszER'
1049639 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-DhYdWkCfszER'
1049639 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-DhYdWkCfszER, null]
1049641 [main] INFO  kkm.UnitTests - Status: null
1049641 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1049641 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1069643 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1069870 [main] INFO  kkm.UnitTests - Response message : {"took":126,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":830,"relation":"eq"},"max_score":5.8959613,"hits":[{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"wn4SlHMBtD96ebe8gSaN","_score":5.8959613,"_source":{"@timestamp":"2020-07-28T06:18:28.490Z","message":"{\"ts\":\"2020-07-28T06:18:28.490+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"57e437f34a0beb3c6a3b32cad03743bcc9d525dc0291e5b85c64d23f39656d7e","name":"kkm-commutator_service.1.j63jfc2rrb1frfwtpfuck4vct","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_name":"kkm-commutator_service.1.j63jfc2rrb1frfwtpfuck4vct","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"j63jfc2rrb1frfwtpfuck4vct"}}},"agent":{"hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc"},"log":{"file":{"path":"/var/lib/docker/containers/57e437f34a0beb3c6a3b32cad03743bcc9d525dc0291e5b85c64d23f39656d7e/57e437f34a0beb3c6a3b32cad03743bcc9d525dc0291e5b85c64d23f39656d7e-json.log"},"offset":774735},"stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main","ts":"2020-07-28T06:18:28.490+00:00","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","level":"DEBUG"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"BIAWlHMBtD96ebe870j-","_score":5.8959613,"_source":{"@timestamp":"2020-07-28T06:23:19.021Z","docker":{"container":{"labels":{"Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_id":"ofdo77dg3rffuyxfs4c9a1bam","com_docker_swarm_task":"","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_name":"kkm-commutator_service.1.ofdo77dg3rffuyxfs4c9a1bam","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service"}}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"log":{"offset":774719,"file":{"path":"/var/lib/docker/containers/74c28b05d7d676ed52d7cfae695d0c6204b939bcd2ef9487f86e1f6ce2ee81e3/74c28b05d7d676ed52d7cfae695d0c6204b939bcd2ef9487f86e1f6ce2ee81e3-json.log"}},"stream":"stdout","container":{"id":"74c28b05d7d676ed52d7cfae695d0c6204b939bcd2ef9487f86e1f6ce2ee81e3","name":"kkm-commutator_service.1.ofdo77dg3rffuyxfs4c9a1bam","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","ts":"2020-07-28T06:23:19.021+00:00","caller_line_number":52,"thread":"main","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner"},"message":"{\"ts\":\"2020-07-28T06:23:19.021+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"2YEblHMBtD96ebe8XSeH","_score":5.8959613,"_source":{"@timestamp":"2020-07-28T06:28:09.814Z","log":{"offset":774722,"file":{"path":"/var/lib/docker/containers/bb55ebd4eca00da09b03fc26ff74b4baff268683ccb0bd3cc186c4fb4bf80ea4/bb55ebd4eca00da09b03fc26ff74b4baff268683ccb0bd3cc186c4fb4bf80ea4-json.log"}},"stream":"stdout","container":{"id":"bb55ebd4eca00da09b03fc26ff74b4baff268683ccb0bd3cc186c4fb4bf80ea4","name":"kkm-commutator_service.1.34roz8bya8etp5y2qoor4kd4k","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-28T06:28:09.813+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"34roz8bya8etp5y2qoor4kd4k","com_docker_swarm_task_name":"kkm-commutator_service.1.34roz8bya8etp5y2qoor4kd4k","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"44fcff07405a"},"json":{"ts":"2020-07-28T06:28:09.813+00:00","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","level":"DEBUG","caller_line_number":52,"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"xX8UlHMBtD96ebe8tT6V","_score":5.8959613,"_source":{"@timestamp":"2020-07-28T06:20:54.083Z","stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"json":{"ts":"2020-07-28T06:20:54.082+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"},"log":{"offset":774694,"file":{"path":"/var/lib/docker/containers/d115086562fa14e39f3fe6fcd3cebce8350de839ec3ccedb94b25cd59672acc8/d115086562fa14e39f3fe6fcd3cebce8350de839ec3ccedb94b25cd59672acc8-json.log"}},"message":"{\"ts\":\"2020-07-28T06:20:54.082+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"d115086562fa14e39f3fe6fcd3cebce8350de839ec3ccedb94b25cd59672acc8","name":"kkm-commutator_service.1.awj32heo9emed6t7shgrseekq","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Description":"KKM Commutator Service","com_docker_swarm_task_id":"awj32heo9emed6t7shgrseekq","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.awj32heo9emed6t7shgrseekq"}}},"host":{"name":"44fcff07405a"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"eIAZlHMBtD96ebe8Jty2","_score":5.8959613,"_source":{"@timestamp":"2020-07-28T06:25:44.689Z","message":"{\"ts\":\"2020-07-28T06:25:44.688+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","json":{"logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","level":"DEBUG","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","ts":"2020-07-28T06:25:44.688+00:00","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main"},"host":{"name":"44fcff07405a"},"log":{"offset":774742,"file":{"path":"/var/lib/docker/containers/a77fe783a6db40a1ce6aff5fe786217bfc7123e35b24fb463acc7e155cdfe40f/a77fe783a6db40a1ce6aff5fe786217bfc7123e35b24fb463acc7e155cdfe40f-json.log"}},"stream":"stdout","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Version":"97","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.izow478m6qpisgkwmpe5jbwqw","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"izow478m6qpisgkwmpe5jbwqw"}}},"container":{"name":"kkm-commutator_service.1.izow478m6qpisgkwmpe5jbwqw","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"a77fe783a6db40a1ce6aff5fe786217bfc7123e35b24fb463acc7e155cdfe40f"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"ecs":{"version":"1.0.1"}}}]}}
1070039 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
1070066 [main] INFO  kkm.UnitTests - End test

1070067 [main] INFO  kkm.UnitTests - Starting test: KKM_DB7()
1070222 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-sQl1eU6nIJX0', '2642748559', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-sQl1eU6nIJX0','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-sQl1eU6nIJX0', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-sQl1eU6nIJX0', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-sQl1eU6nIJX0'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-sQl1eU6nIJX0'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-sQl1eU6nIJX0'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-sQl1eU6nIJX0'
1181017 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-sQl1eU6nIJX0'
1181018 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-sQl1eU6nIJX0, null]
1181020 [main] INFO  kkm.UnitTests - Status: null
1181020 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1181020 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1201024 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1201080 [main] INFO  kkm.UnitTests - Response message : {"took":3,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":832,"relation":"eq"},"max_score":5.894067,"hits":[{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"wn4SlHMBtD96ebe8gSaN","_score":5.894067,"_source":{"@timestamp":"2020-07-28T06:18:28.490Z","message":"{\"ts\":\"2020-07-28T06:18:28.490+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"57e437f34a0beb3c6a3b32cad03743bcc9d525dc0291e5b85c64d23f39656d7e","name":"kkm-commutator_service.1.j63jfc2rrb1frfwtpfuck4vct","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_name":"kkm-commutator_service.1.j63jfc2rrb1frfwtpfuck4vct","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"j63jfc2rrb1frfwtpfuck4vct"}}},"agent":{"hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc"},"log":{"file":{"path":"/var/lib/docker/containers/57e437f34a0beb3c6a3b32cad03743bcc9d525dc0291e5b85c64d23f39656d7e/57e437f34a0beb3c6a3b32cad03743bcc9d525dc0291e5b85c64d23f39656d7e-json.log"},"offset":774735},"stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main","ts":"2020-07-28T06:18:28.490+00:00","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","level":"DEBUG"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"BIAWlHMBtD96ebe870j-","_score":5.894067,"_source":{"@timestamp":"2020-07-28T06:23:19.021Z","docker":{"container":{"labels":{"Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_id":"ofdo77dg3rffuyxfs4c9a1bam","com_docker_swarm_task":"","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_name":"kkm-commutator_service.1.ofdo77dg3rffuyxfs4c9a1bam","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service"}}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"log":{"offset":774719,"file":{"path":"/var/lib/docker/containers/74c28b05d7d676ed52d7cfae695d0c6204b939bcd2ef9487f86e1f6ce2ee81e3/74c28b05d7d676ed52d7cfae695d0c6204b939bcd2ef9487f86e1f6ce2ee81e3-json.log"}},"stream":"stdout","container":{"id":"74c28b05d7d676ed52d7cfae695d0c6204b939bcd2ef9487f86e1f6ce2ee81e3","name":"kkm-commutator_service.1.ofdo77dg3rffuyxfs4c9a1bam","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","ts":"2020-07-28T06:23:19.021+00:00","caller_line_number":52,"thread":"main","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner"},"message":"{\"ts\":\"2020-07-28T06:23:19.021+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"2YEblHMBtD96ebe8XSeH","_score":5.894067,"_source":{"@timestamp":"2020-07-28T06:28:09.814Z","log":{"offset":774722,"file":{"path":"/var/lib/docker/containers/bb55ebd4eca00da09b03fc26ff74b4baff268683ccb0bd3cc186c4fb4bf80ea4/bb55ebd4eca00da09b03fc26ff74b4baff268683ccb0bd3cc186c4fb4bf80ea4-json.log"}},"stream":"stdout","container":{"id":"bb55ebd4eca00da09b03fc26ff74b4baff268683ccb0bd3cc186c4fb4bf80ea4","name":"kkm-commutator_service.1.34roz8bya8etp5y2qoor4kd4k","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-28T06:28:09.813+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"34roz8bya8etp5y2qoor4kd4k","com_docker_swarm_task_name":"kkm-commutator_service.1.34roz8bya8etp5y2qoor4kd4k","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"44fcff07405a"},"json":{"ts":"2020-07-28T06:28:09.813+00:00","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","level":"DEBUG","caller_line_number":52,"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"xX8UlHMBtD96ebe8tT6V","_score":5.894067,"_source":{"@timestamp":"2020-07-28T06:20:54.083Z","stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"json":{"ts":"2020-07-28T06:20:54.082+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"},"log":{"offset":774694,"file":{"path":"/var/lib/docker/containers/d115086562fa14e39f3fe6fcd3cebce8350de839ec3ccedb94b25cd59672acc8/d115086562fa14e39f3fe6fcd3cebce8350de839ec3ccedb94b25cd59672acc8-json.log"}},"message":"{\"ts\":\"2020-07-28T06:20:54.082+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"d115086562fa14e39f3fe6fcd3cebce8350de839ec3ccedb94b25cd59672acc8","name":"kkm-commutator_service.1.awj32heo9emed6t7shgrseekq","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Description":"KKM Commutator Service","com_docker_swarm_task_id":"awj32heo9emed6t7shgrseekq","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.awj32heo9emed6t7shgrseekq"}}},"host":{"name":"44fcff07405a"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"eIAZlHMBtD96ebe8Jty2","_score":5.894067,"_source":{"@timestamp":"2020-07-28T06:25:44.689Z","message":"{\"ts\":\"2020-07-28T06:25:44.688+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","json":{"logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","level":"DEBUG","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","ts":"2020-07-28T06:25:44.688+00:00","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main"},"host":{"name":"44fcff07405a"},"log":{"offset":774742,"file":{"path":"/var/lib/docker/containers/a77fe783a6db40a1ce6aff5fe786217bfc7123e35b24fb463acc7e155cdfe40f/a77fe783a6db40a1ce6aff5fe786217bfc7123e35b24fb463acc7e155cdfe40f-json.log"}},"stream":"stdout","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Version":"97","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.izow478m6qpisgkwmpe5jbwqw","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"izow478m6qpisgkwmpe5jbwqw"}}},"container":{"name":"kkm-commutator_service.1.izow478m6qpisgkwmpe5jbwqw","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"a77fe783a6db40a1ce6aff5fe786217bfc7123e35b24fb463acc7e155cdfe40f"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"ecs":{"version":"1.0.1"}}}]}}
1201249 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1201274 [main] INFO  kkm.UnitTests - End test

1201276 [main] INFO  kkm.UnitTests - Starting test: KKM_DB8()
1201461 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-agYkdhgenqRB', '2422892588', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-agYkdhgenqRB','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-agYkdhgenqRB', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-agYkdhgenqRB', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-agYkdhgenqRB'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-agYkdhgenqRB'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-agYkdhgenqRB'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-agYkdhgenqRB'
1312479 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-agYkdhgenqRB'
1312480 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-agYkdhgenqRB, null]
1312483 [main] INFO  kkm.UnitTests - Status: null
1312484 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1312484 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1332487 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-test-2020.07.28/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1332555 [main] INFO  kkm.UnitTests - Response message : {"took":8,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":834,"relation":"eq"},"max_score":5.8926253,"hits":[{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"wn4SlHMBtD96ebe8gSaN","_score":5.8926253,"_source":{"@timestamp":"2020-07-28T06:18:28.490Z","message":"{\"ts\":\"2020-07-28T06:18:28.490+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"57e437f34a0beb3c6a3b32cad03743bcc9d525dc0291e5b85c64d23f39656d7e","name":"kkm-commutator_service.1.j63jfc2rrb1frfwtpfuck4vct","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_name":"kkm-commutator_service.1.j63jfc2rrb1frfwtpfuck4vct","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_task_id":"j63jfc2rrb1frfwtpfuck4vct"}}},"agent":{"hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc"},"log":{"file":{"path":"/var/lib/docker/containers/57e437f34a0beb3c6a3b32cad03743bcc9d525dc0291e5b85c64d23f39656d7e/57e437f34a0beb3c6a3b32cad03743bcc9d525dc0291e5b85c64d23f39656d7e-json.log"},"offset":774735},"stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main","ts":"2020-07-28T06:18:28.490+00:00","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","level":"DEBUG"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"BIAWlHMBtD96ebe870j-","_score":5.8926253,"_source":{"@timestamp":"2020-07-28T06:23:19.021Z","docker":{"container":{"labels":{"Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_id":"ofdo77dg3rffuyxfs4c9a1bam","com_docker_swarm_task":"","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_name":"kkm-commutator_service.1.ofdo77dg3rffuyxfs4c9a1bam","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service"}}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"log":{"offset":774719,"file":{"path":"/var/lib/docker/containers/74c28b05d7d676ed52d7cfae695d0c6204b939bcd2ef9487f86e1f6ce2ee81e3/74c28b05d7d676ed52d7cfae695d0c6204b939bcd2ef9487f86e1f6ce2ee81e3-json.log"}},"stream":"stdout","container":{"id":"74c28b05d7d676ed52d7cfae695d0c6204b939bcd2ef9487f86e1f6ce2ee81e3","name":"kkm-commutator_service.1.ofdo77dg3rffuyxfs4c9a1bam","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"44fcff07405a"},"json":{"level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","ts":"2020-07-28T06:23:19.021+00:00","caller_line_number":52,"thread":"main","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner"},"message":"{\"ts\":\"2020-07-28T06:23:19.021+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"2YEblHMBtD96ebe8XSeH","_score":5.8926253,"_source":{"@timestamp":"2020-07-28T06:28:09.814Z","log":{"offset":774722,"file":{"path":"/var/lib/docker/containers/bb55ebd4eca00da09b03fc26ff74b4baff268683ccb0bd3cc186c4fb4bf80ea4/bb55ebd4eca00da09b03fc26ff74b4baff268683ccb0bd3cc186c4fb4bf80ea4-json.log"}},"stream":"stdout","container":{"id":"bb55ebd4eca00da09b03fc26ff74b4baff268683ccb0bd3cc186c4fb4bf80ea4","name":"kkm-commutator_service.1.34roz8bya8etp5y2qoor4kd4k","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-28T06:28:09.813+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"34roz8bya8etp5y2qoor4kd4k","com_docker_swarm_task_name":"kkm-commutator_service.1.34roz8bya8etp5y2qoor4kd4k","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"44fcff07405a"},"json":{"ts":"2020-07-28T06:28:09.813+00:00","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","level":"DEBUG","caller_line_number":52,"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"xX8UlHMBtD96ebe8tT6V","_score":5.8926253,"_source":{"@timestamp":"2020-07-28T06:20:54.083Z","stream":"stdout","input":{"type":"container"},"ecs":{"version":"1.0.1"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072"},"json":{"ts":"2020-07-28T06:20:54.082+00:00","logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","level":"DEBUG","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}"},"log":{"offset":774694,"file":{"path":"/var/lib/docker/containers/d115086562fa14e39f3fe6fcd3cebce8350de839ec3ccedb94b25cd59672acc8/d115086562fa14e39f3fe6fcd3cebce8350de839ec3ccedb94b25cd59672acc8-json.log"}},"message":"{\"ts\":\"2020-07-28T06:20:54.082+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","container":{"id":"d115086562fa14e39f3fe6fcd3cebce8350de839ec3ccedb94b25cd59672acc8","name":"kkm-commutator_service.1.awj32heo9emed6t7shgrseekq","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","Version":"97","com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","Description":"KKM Commutator Service","com_docker_swarm_task_id":"awj32heo9emed6t7shgrseekq","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.awj32heo9emed6t7shgrseekq"}}},"host":{"name":"44fcff07405a"}}},{"_index":"kkm-commutator-test-2020.07.28","_type":"_doc","_id":"eIAZlHMBtD96ebe8Jty2","_score":5.8926253,"_source":{"@timestamp":"2020-07-28T06:25:44.689Z","message":"{\"ts\":\"2020-07-28T06:25:44.688+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","json":{"logger":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","level":"DEBUG","msg":"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}","ts":"2020-07-28T06:25:44.688+00:00","class":"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner","method":"combine","caller_file_name":"DefaultRequestHandlerCombiner.java","caller_line_number":52,"thread":"main"},"host":{"name":"44fcff07405a"},"log":{"offset":774742,"file":{"path":"/var/lib/docker/containers/a77fe783a6db40a1ce6aff5fe786217bfc7123e35b24fb463acc7e155cdfe40f/a77fe783a6db40a1ce6aff5fe786217bfc7123e35b24fb463acc7e155cdfe40f-json.log"}},"stream":"stdout","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"rdhag2o7wwmqoenobm498lkb8","Version":"97","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.izow478m6qpisgkwmpe5jbwqw","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"7sy4bxg3vjd3qexelmqu7dul9","com_docker_swarm_task_id":"izow478m6qpisgkwmpe5jbwqw"}}},"container":{"name":"kkm-commutator_service.1.izow478m6qpisgkwmpe5jbwqw","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"a77fe783a6db40a1ce6aff5fe786217bfc7123e35b24fb463acc7e155cdfe40f"},"agent":{"type":"filebeat","ephemeral_id":"a7e14d42-94af-47f2-a1e3-c27c2fc455cc","hostname":"44fcff07405a","id":"e4ad1055-9ebd-4797-8e83-b74a213a4072","version":"7.3.1"},"ecs":{"version":"1.0.1"}}}]}}
1332706 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
1332732 [main] INFO  kkm.UnitTests - End test

1332735 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageWasCanceled()
1335854 [main] INFO  kkm.UnitTests - End test

1335856 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceleNotFound()
1335886 [main] INFO  kkm.UnitTests - End test

1335887 [main] INFO  kkm.UnitTests - Starting test: KKM_makeAndCancelCheckCashier()
1580563 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-test-2020.07.28/_search?q=%20message:%20%22CID=2811bfb9-3c9c-4af6-840d-41f35ed093c82%22%20
1580951 [main] INFO  kkm.UnitTests - Response message : {"took":311,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":46.866627,"hits":[{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"huK4lXMBtD96ebe8KPAU","_score":46.866627,"_source":{"level":"trace","@timestamp":"2020-07-28T13:59:01.306Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST request  Operation 'CancelReceipt' was call with body: 12ed0a95-c656-4459-baea-8a34db381cbe | exid=ID-esb-test01-39552-1595922638059-71-7417 CID=2811bfb9-3c9c-4af6-840d-41f35ed093c82","thread":"qtp1413042234-26078","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:59:01,306","input":{"type":"log"},"offset":41111915,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"0OK4lXMBtD96ebe8YvMo","_score":44.845047,"_source":{"level":"trace","@timestamp":"2020-07-28T13:59:01.329Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST response Operation 'CancelReceipt' was complete with body: CancelReceiptResponse{correlationId='null', checkId='12ed0a95-c656-4459-baea-8a34db381cbe', canceledCheckId='4b3620ae-74e6-4928-88a3-980356677f36', error=null} | exid=ID-esb-test01-39552-1595922638059-71-7417 CID=2811bfb9-3c9c-4af6-840d-41f35ed093c82","thread":"qtp1413042234-26078","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:59:01,329","input":{"type":"log"},"offset":41116002,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"weK4lXMBtD96ebe8KPAW","_score":43.898277,"_source":{"level":"debug","@timestamp":"2020-07-28T13:59:01.306Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST request  Operation 'CancelReceipt' was call with headers: {breadcrumbId=ID-esb-test01-39552-1595922638059-71-7416, JMSCorrelationID=2811bfb9-3c9c-4af6-840d-41f35ed093c82, operationName=CancelReceipt, X-VSK-CorrelationId=2811bfb9-3c9c-4af6-840d-41f35ed093c82} | exid=ID-esb-test01-39552-1595922638059-71-7417 CID=2811bfb9-3c9c-4af6-840d-41f35ed093c82","thread":"qtp1413042234-26078","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:59:01,306","input":{"type":"log"},"offset":41111436,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"7OK4lXMBtD96ebe8KPAZ","_score":41.83731,"_source":{"level":"debug","@timestamp":"2020-07-28T13:59:01.306Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-test01-39552-1595922638059-71-7416, CamelHttpMethod=PUT, JMSCorrelationID=2811bfb9-3c9c-4af6-840d-41f35ed093c82, operationName=CancelReceipt, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/12ed0a95-c656-4459-baea-8a34db381cbe/cancel, X-VSK-CorrelationId=2811bfb9-3c9c-4af6-840d-41f35ed093c82} | exId=ID-esb-test01-39552-1595922638059-71-7419 CID=2811bfb9-3c9c-4af6-840d-41f35ed093c82","thread":"thread #4093 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:59:01,306","input":{"type":"log"},"offset":41112227,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"GOK4lXMBtD96ebe8KPEe","_score":40.744236,"_source":{"level":"trace","@timestamp":"2020-07-28T13:59:01.306Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-test01-39552-1595922638059-71-7416, CamelHttpMethod=PUT, JMSCorrelationID=2811bfb9-3c9c-4af6-840d-41f35ed093c82, operationName=CancelReceipt, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/12ed0a95-c656-4459-baea-8a34db381cbe/cancel, X-VSK-CorrelationId=2811bfb9-3c9c-4af6-840d-41f35ed093c82} | exId=ID-esb-test01-39552-1595922638059-71-7419 CID=2811bfb9-3c9c-4af6-840d-41f35ed093c82 |\n 12ed0a95-c656-4459-baea-8a34db381cbe","thread":"thread #4093 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"@version":"1","environment":"test","timestamp":"2020-07-28T16:59:01,306","input":{"type":"log"},"offset":41112831,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"MuK4lXMBtD96ebe8KPAK","_score":38.246105,"_source":{"level":"debug","@timestamp":"2020-07-28T13:59:01.329Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-39552-1595922638059-71-7416, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 13:59:00 GMT, JMSCorrelationID=2811bfb9-3c9c-4af6-840d-41f35ed093c82, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/12ed0a95-c656-4459-baea-8a34db381cbe/cancel, X-VSK-CorrelationId=2811bfb9-3c9c-4af6-840d-41f35ed093c82} | exid=ID-esb-test01-39552-1595922638059-71-7419 CID=2811bfb9-3c9c-4af6-840d-41f35ed093c82","thread":"thread #4093 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:59:01,329","input":{"type":"log"},"offset":41113475,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"wuK4lXMBtD96ebe8KPAW","_score":38.246105,"_source":{"level":"debug","@timestamp":"2020-07-28T13:59:01.329Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: REST response Operation 'CancelReceipt' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-39552-1595922638059-71-7416, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 13:59:00 GMT, JMSCorrelationID=2811bfb9-3c9c-4af6-840d-41f35ed093c82, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/12ed0a95-c656-4459-baea-8a34db381cbe/cancel, X-VSK-CorrelationId=2811bfb9-3c9c-4af6-840d-41f35ed093c82} | exid=ID-esb-test01-39552-1595922638059-71-7417 CID=2811bfb9-3c9c-4af6-840d-41f35ed093c82","thread":"qtp1413042234-26078","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"@version":"1","environment":"test","timestamp":"2020-07-28T16:59:01,329","input":{"type":"log"},"offset":41115184,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},{"_index":"esb-test-2020.07.28","_type":"_doc","_id":"XOK4lXMBtD96ebe8KPAQ","_score":37.33057,"_source":{"level":"trace","@timestamp":"2020-07-28T13:59:01.329Z","prospector":{"type":"log"},"package":"servicemix.esb.kkm","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-test01-39552-1595922638059-71-7416, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Tue, 28 Jul 2020 13:59:00 GMT, JMSCorrelationID=2811bfb9-3c9c-4af6-840d-41f35ed093c82, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://kkm-dev:9192/master-system/api/v1/receipts/12ed0a95-c656-4459-baea-8a34db381cbe/cancel, X-VSK-CorrelationId=2811bfb9-3c9c-4af6-840d-41f35ed093c82} | exid=ID-esb-test01-39552-1595922638059-71-7419 CID=2811bfb9-3c9c-4af6-840d-41f35ed093c82 |\n {\"checkId\":\"12ed0a95-c656-4459-baea-8a34db381cbe\",\"canceledCheckId\":\"4b3620ae-74e6-4928-88a3-980356677f36\"}","thread":"thread #4093 - seda://kkmRestAPI","beat":{"version":"6.8.10","hostname":"esb-test01","name":"esb-test01"},"bundleid":"38357","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"},"flags":["multiline"]},"@version":"1","environment":"test","timestamp":"2020-07-28T16:59:01,329","input":{"type":"log"},"offset":41114274,"application":"esb","host":{"name":"esb-test01"},"tags":["beats_input_codec_plain_applied"],"source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}}]}}
1580952 [main] INFO  kkm.UnitTests - End test

1580953 [main] INFO  kkm.UnitTests - Starting test: KKM_SIPheckStatus()
1583561 [main] INFO  kkm.UnitTests - End test

1583564 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageNotFound()
1583598 [main] INFO  kkm.UnitTests - End test

1583600 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt_negative()
1583949 [main] INFO  kkm.UnitTests - End test

1583950 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt()
1586471 [main] INFO  kkm.UnitTests - End test

