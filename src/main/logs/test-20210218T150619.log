216  [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGatewayWithStubs_DONE()
499  [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
502  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
508  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
1021 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
1021 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
1023 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
61339 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
61340 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, DONE, nothing, ЖПлато_000898541]
122587 [main] INFO  kkm.UnitTests - End test

122598 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_Error()
122761 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
122761 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
122762 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
123173 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000901797'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000901797'
select * from ProcessStatus where srcID = 'ЖПлато_000901797'
123174 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
123179 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
183491 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000901797'
183492 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000901797]
243596 [main] INFO  kkm.UnitTests - End test

243607 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_NOFILIAL()
243808 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-VwL2QxqaZTpJ', '4786364421', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-VwL2QxqaZTpJ','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-VwL2QxqaZTpJ', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-VwL2QxqaZTpJ', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-VwL2QxqaZTpJ'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-VwL2QxqaZTpJ'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-VwL2QxqaZTpJ'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-VwL2QxqaZTpJ'
354608 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-VwL2QxqaZTpJ'
354609 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-VwL2QxqaZTpJ, null]
354613 [main] INFO  kkm.UnitTests - Status: null
354613 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
354613 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
374872 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
374902 [main] INFO  kkm.UnitTests - End test

374905 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_UTC12_DONE()
375049 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-nfRBhbC3hDaP', '1133972131', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-nfRBhbC3hDaP','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-nfRBhbC3hDaP', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-nfRBhbC3hDaP', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-nfRBhbC3hDaP'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-nfRBhbC3hDaP'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-nfRBhbC3hDaP'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-nfRBhbC3hDaP'
485815 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-nfRBhbC3hDaP'
485816 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-nfRBhbC3hDaP, null]
485819 [main] INFO  kkm.UnitTests - Status: null
485819 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
485820 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
506111 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
506134 [main] INFO  kkm.UnitTests - End test

506136 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_UTC2_FAIL()
506306 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-BtGOaRkCBK9m', '3153874294', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-BtGOaRkCBK9m','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-BtGOaRkCBK9m', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-BtGOaRkCBK9m', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-BtGOaRkCBK9m'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-BtGOaRkCBK9m'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-BtGOaRkCBK9m'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-BtGOaRkCBK9m'
617039 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-BtGOaRkCBK9m'
617039 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-BtGOaRkCBK9m, null]
617042 [main] INFO  kkm.UnitTests - Status: null
617043 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
617043 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
637359 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
637384 [main] INFO  kkm.UnitTests - End test

637389 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_UTC12_DONE()
637566 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UyaYdfXim3ya', '8757063690', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UyaYdfXim3ya','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UyaYdfXim3ya', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-UyaYdfXim3ya', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-UyaYdfXim3ya'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-UyaYdfXim3ya'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-UyaYdfXim3ya'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-UyaYdfXim3ya'
748387 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-UyaYdfXim3ya'
748388 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-UyaYdfXim3ya, null]
748391 [main] INFO  kkm.UnitTests - Status: null
748391 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
748392 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
748523 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/null
748524 [main] INFO  kkm.UnitTests - Response Code : 400
748525 [main] INFO  kkm.UnitTests - End test

748535 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_NOFILIAL()
748719 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ReOTCKElm43z', '4346549931', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ReOTCKElm43z','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ReOTCKElm43z', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ReOTCKElm43z', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-ReOTCKElm43z'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-ReOTCKElm43z'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-ReOTCKElm43z'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-ReOTCKElm43z'
859332 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-ReOTCKElm43z'
859333 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-ReOTCKElm43z, a2b4a9a0-c8bf-4179-932d-932dfe7f51da]
859336 [main] INFO  kkm.UnitTests - Status: DONE
859336 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
859336 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
859478 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/a2b4a9a0-c8bf-4179-932d-932dfe7f51da
859479 [main] INFO  kkm.UnitTests - Response Code : 200
859513 [main] INFO  kkm.UnitTests - [DONE]
879604 [main] INFO  kkm.UnitTests - End test

879611 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_UTC2_FAIL()
879813 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-AxiDNWrBOyFr', '0559874292', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-AxiDNWrBOyFr','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-AxiDNWrBOyFr', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-AxiDNWrBOyFr', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-AxiDNWrBOyFr'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-AxiDNWrBOyFr'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-AxiDNWrBOyFr'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-AxiDNWrBOyFr'
990701 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-AxiDNWrBOyFr'
990701 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-AxiDNWrBOyFr, a63e6ed0-6e8b-4d29-9d75-a64a6d5ae740]
990702 [main] INFO  kkm.UnitTests - Status: FAIL
990702 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
990702 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
991177 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/a63e6ed0-6e8b-4d29-9d75-a64a6d5ae740
991177 [main] INFO  kkm.UnitTests - Response Code : 200
991178 [main] INFO  kkm.UnitTests - [FAIL]
1011295 [main] INFO  kkm.UnitTests - End test

