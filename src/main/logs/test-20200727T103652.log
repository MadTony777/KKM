198  [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckNoCashier()
3172 [main] INFO  kkm.UnitTests - End test

3184 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageEmail()
275838 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.27/_search?q=%20message:%20%22CID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211%22%20
276424 [main] INFO  kkm.UnitTests - Response message : {"took":450,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":58.41049,"hits":[{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"Vsf9jnMBfrYj4vM9-Yo9","_score":58.41049,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":479685,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T06:37:26.203Z","timestamp":"2020-07-27T09:37:26,203","thread":"qtp529223075-268157","message":"KkmService: REST response Operation 'SendMessage' was complete with body: ReceiptResponse{correlationId='null', checkId='ebfbb0ab-01e7-43c7-a0fa-f7f26aa3d02c', error=null} | exid=ID-esb-stage-37060-1595563687826-61-65762 CID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"J8f9jnMBfrYj4vM9v3oy","_score":58.19633,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":475294,"@timestamp":"2020-07-27T06:37:26.172Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T09:37:26,172","thread":"qtp529223075-268157","message":"KkmService: REST request  Operation 'SendMessage' was call with body: SendMessageRequest{checkId='ebfbb0ab-01e7-43c7-a0fa-f7f26aa3d02c', messageType='email', messageAddress='EPolikarpova@VSK.RU'} | exid=ID-esb-stage-37060-1595563687826-61-65762 CID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"Tsf9jnMBfrYj4vM9v3qU","_score":55.940273,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":474816,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T06:37:26.171Z","timestamp":"2020-07-27T09:37:26,171","thread":"qtp529223075-268157","message":"KkmService: REST request  Operation 'SendMessage' was call with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-65761, JMSCorrelationID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211, operationName=SendMessage, X-VSK-CorrelationId=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211} | exid=ID-esb-stage-37060-1595563687826-61-65762 CID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"Dcf9jnMBfrYj4vM9v3ov","_score":52.60334,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":476334,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T06:37:26.172Z","timestamp":"2020-07-27T09:37:26,172","thread":"thread #2412 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-65761, CamelHttpMethod=GET, JMSCorrelationID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/ebfbb0ab-01e7-43c7-a0fa-f7f26aa3d02c/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211} | exId=ID-esb-stage-37060-1595563687826-61-65764 CID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211 |\n ","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"L8f9jnMBfrYj4vM9v3o6","_score":52.60334,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":475694,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T06:37:26.172Z","timestamp":"2020-07-27T09:37:26,172","thread":"thread #2412 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-65761, CamelHttpMethod=GET, JMSCorrelationID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/ebfbb0ab-01e7-43c7-a0fa-f7f26aa3d02c/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211} | exId=ID-esb-stage-37060-1595563687826-61-65764 CID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"GMf9jnMBfrYj4vM9v3ow","_score":47.55975,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":476978,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T06:37:26.202Z","timestamp":"2020-07-27T09:37:26,202","thread":"thread #2412 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-65761, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 06:37:27 GMT, JMSCorrelationID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/ebfbb0ab-01e7-43c7-a0fa-f7f26aa3d02c/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211} | exid=ID-esb-stage-37060-1595563687826-61-65764 CID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"T8f9jnMBfrYj4vM9v3qU","_score":47.55975,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":478788,"beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"@timestamp":"2020-07-27T06:37:26.203Z","timestamp":"2020-07-27T09:37:26,203","thread":"qtp529223075-268157","message":"KkmService: REST response Operation 'SendMessage' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-65761, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 06:37:27 GMT, JMSCorrelationID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/ebfbb0ab-01e7-43c7-a0fa-f7f26aa3d02c/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211} | exid=ID-esb-stage-37060-1595563687826-61-65762 CID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"Qcf9jnMBfrYj4vM9v3qT","_score":46.44643,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":477856,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T06:37:26.202Z","timestamp":"2020-07-27T09:37:26,202","thread":"thread #2412 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-65761, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 06:37:27 GMT, JMSCorrelationID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/ebfbb0ab-01e7-43c7-a0fa-f7f26aa3d02c/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211} | exid=ID-esb-stage-37060-1595563687826-61-65764 CID=b3c2e2af-d84d-4d39-a47a-7f83d6b6751211 |\n {\"checkId\":\"ebfbb0ab-01e7-43c7-a0fa-f7f26aa3d02c\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
276426 [main] INFO  kkm.UnitTests - End test

276431 [main] INFO  kkm.UnitTests - Starting test: KKM_WAcheckStatus()
279064 [main] INFO  kkm.UnitTests - End test

279065 [main] INFO  kkm.UnitTests - Starting test: KKM_getStatus()
281575 [main] INFO  kkm.UnitTests - End test

281578 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceledAlredy()
284143 [main] INFO  kkm.UnitTests - End test

284148 [main] INFO  kkm.UnitTests - Starting test: KKM_getDocCustomer()
284320 [main] INFO  kkm.UnitTests - End test

284324 [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckCashier()
309112 [main] INFO  kkm.UnitTests - End test

309113 [main] INFO  kkm.UnitTests - Starting test: KKM_DB1()
309627 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
309632 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898622
309634 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898622
310162 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000898622'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898622'
select * from ProcessStatus where srcID = 'ЖПлато_000898622'
310163 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000898622]
310165 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000898622]
370465 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898622'
370466 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000898622]
430476 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898622%22%20&size=500
430587 [main] INFO  kkm.UnitTests - Response message : {"took":39,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":2,"relation":"eq"},"max_score":11.605391,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"b7nYjnMBfrYj4vM9t1Gk","_score":11.605391,"_source":{"@timestamp":"2020-07-27T05:57:09.324Z","message":"{\"ts\":\"2020-07-27T05:57:09.322+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"2c7b06acbdbea9b2\",\"spanId\":\"2c7b06acbdbea9b2\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"2c7b06acbdbea9b2\",\"X-B3-TraceId\":\"2c7b06acbdbea9b2\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n"}}},"ecs":{"version":"1.0.1"},"stream":"stdout","container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"host":{"name":"25805977eece"},"log":{"offset":43324754,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"WckBj3MBfrYj4vM96w2Z","_score":11.605391,"_source":{"@timestamp":"2020-07-27T06:42:09.300Z","input":{"type":"container"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7"},"ecs":{"version":"1.0.1"},"stream":"stdout","message":"{\"ts\":\"2020-07-27T06:42:09.300+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"ad74a37670c98ac8\",\"spanId\":\"ad74a37670c98ac8\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"ad74a37670c98ac8\",\"X-B3-TraceId\":\"ad74a37670c98ac8\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","log":{"offset":45397173,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"}}}]}}
430591 [main] INFO  kkm.UnitTests - End test

430592 [main] INFO  kkm.UnitTests - Starting test: KKM_DB2()
430737 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
430737 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
430739 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
431390 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
431391 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
431395 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
491718 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
491719 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, nothing, ЖПлато_000898541]
551727 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
553605 [main] INFO  kkm.UnitTests - Response message : {"took":1791,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":2,"relation":"eq"},"max_score":10.801858,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"LbnajnMBfrYj4vM9jMFx","_score":10.801858,"_source":{"@timestamp":"2020-07-27T05:59:09.416Z","message":"{\"ts\":\"2020-07-27T05:59:09.415+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"f9e5edb1eb62c047\",\"spanId\":\"f9e5edb1eb62c047\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"f9e5edb1eb62c047\",\"X-B3-TraceId\":\"f9e5edb1eb62c047\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":43427463,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"JMkDj3MBfrYj4vM9ve66","_score":10.801858,"_source":{"@timestamp":"2020-07-27T06:44:09.676Z","docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T06:44:09.676+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"8fe5b5fc982cc728\",\"spanId\":\"8fe5b5fc982cc728\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8fe5b5fc982cc728\",\"X-B3-TraceId\":\"8fe5b5fc982cc728\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"log":{"offset":45502972,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout"}}]}}
553609 [main] INFO  kkm.UnitTests - End test

553613 [main] INFO  kkm.UnitTests - Starting test: KKM_DB3()
553748 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4PFKt2HpW0vC', '8304819592', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4PFKt2HpW0vC','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4PFKt2HpW0vC', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-4PFKt2HpW0vC', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-4PFKt2HpW0vC'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-4PFKt2HpW0vC'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-4PFKt2HpW0vC'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-4PFKt2HpW0vC'
664761 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-4PFKt2HpW0vC'
664762 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-4PFKt2HpW0vC, fd40b3b7-8094-4a54-be35-c0941de7f7ef]
664763 [main] INFO  kkm.UnitTests - Status: DONE
664763 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
664763 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
684885 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-4PFKt2HpW0vC%22%20&size=500
684989 [main] INFO  kkm.UnitTests - Response message : {"took":47,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.90035,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"68oFj3MBfrYj4vM9kpWC","_score":27.90035,"_source":{"@timestamp":"2020-07-27T06:46:09.245Z","docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"log":{"offset":45614460,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"message":"{\"ts\":\"2020-07-27T06:46:09.244+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"a6211846a0c36f4f\",\"spanId\":\"a6211846a0c36f4f\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a6211846a0c36f4f\",\"X-B3-TraceId\":\"a6211846a0c36f4f\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-4PFKt2HpW0vC\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-ZMWizQdGQ3Js\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","stream":"stdout","agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"}}}]}}
685121 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
685143 [main] INFO  kkm.UnitTests - End test

685145 [main] INFO  kkm.UnitTests - Starting test: KKM_DB4()
685277 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ', '1847194168', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ'
795898 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ'
795899 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ, c6cdf178-e563-461b-a508-1611b51fdcd2]
795903 [main] INFO  kkm.UnitTests - Status: FAIL
795903 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
795904 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
816441 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-wfgLhZVoUcsJ%22%20&size=500
816507 [main] INFO  kkm.UnitTests - Response message : {"took":7,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.380356,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"7csHj3MBfrYj4vM9z0mW","_score":27.380356,"_source":{"@timestamp":"2020-07-27T06:48:31.190Z","message":"{\"ts\":\"2020-07-27T06:48:31.190+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"c72fa326356195bb\",\"spanId\":\"c72fa326356195bb\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c72fa326356195bb\",\"X-B3-TraceId\":\"c72fa326356195bb\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-pXhVgd7AUTM0\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-wfgLhZVoUcsJ\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":45764545,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"host":{"name":"25805977eece"}}}]}}
816661 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
816686 [main] INFO  kkm.UnitTests - End test

816688 [main] INFO  kkm.UnitTests - Starting test: KKM_DB5()
816824 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-KyvqpNyi6k3h', '3515218455', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-KyvqpNyi6k3h','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-KyvqpNyi6k3h', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-KyvqpNyi6k3h', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-KyvqpNyi6k3h'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-KyvqpNyi6k3h'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-KyvqpNyi6k3h'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-KyvqpNyi6k3h'
927497 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-KyvqpNyi6k3h'
927498 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-KyvqpNyi6k3h, 76ae2bb5-47fb-4537-b090-d02f90443bba]
927500 [main] INFO  kkm.UnitTests - Status: DONE
927501 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
927501 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
947604 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-KyvqpNyi6k3h%22%20&size=500
947671 [main] INFO  kkm.UnitTests - Response message : {"took":12,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":26.949808,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"-8sJj3MBfrYj4vM9pNNl","_score":26.949808,"_source":{"@timestamp":"2020-07-27T06:50:31.168Z","agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":45909028,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","container":{"name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7"}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"message":"{\"ts\":\"2020-07-27T06:50:31.168+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"2d8d9cef52c43360\",\"spanId\":\"2d8d9cef52c43360\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"2d8d9cef52c43360\",\"X-B3-TraceId\":\"2d8d9cef52c43360\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-fDx8S11tmpVH\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-KyvqpNyi6k3h\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"}}}]}}
948136 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
948161 [main] INFO  kkm.UnitTests - End test

948163 [main] INFO  kkm.UnitTests - Starting test: KKM_DB6()
948307 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-xapLuN0ZPFrW', '6170083217', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-xapLuN0ZPFrW','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-xapLuN0ZPFrW', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-xapLuN0ZPFrW', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-xapLuN0ZPFrW'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-xapLuN0ZPFrW'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-xapLuN0ZPFrW'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-xapLuN0ZPFrW'
1059134 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-xapLuN0ZPFrW'
1059135 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-xapLuN0ZPFrW, null]
1059139 [main] INFO  kkm.UnitTests - Status: null
1059139 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1059140 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1079145 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1079243 [main] INFO  kkm.UnitTests - Response message : {"took":39,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":829,"relation":"eq"},"max_score":3.5604272,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"o3aSjXMBfrYj4vM9LZH0","_score":3.5604272,"_source":{"@timestamp":"2020-07-27T00:00:09.153Z","ecs":{"version":"1.0.1"},"log":{"offset":28726039,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-27T00:00:09.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"d452230b2efe5ab7\",\"spanId\":\"d452230b2efe5ab7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d452230b2efe5ab7\",\"X-B3-TraceId\":\"d452230b2efe5ab7\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"OXaSjXMBfrYj4vM9UpQ9","_score":3.5604272,"_source":{"@timestamp":"2020-07-27T00:00:31.122Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"host":{"name":"25805977eece"},"input":{"type":"container"},"message":"{\"ts\":\"2020-07-27T00:00:31.122+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3dd65d6f98321076\",\"spanId\":\"3dd65d6f98321076\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3dd65d6f98321076\",\"X-B3-TraceId\":\"3dd65d6f98321076\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":28738954},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"X3ifjXMBfrYj4vM9nQx0","_score":3.5604272,"_source":{"@timestamp":"2020-07-27T00:15:09.048Z","stream":"stdout","log":{"offset":29337267,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T00:15:09.047+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9146b30fd146e783\",\"spanId\":\"9146b30fd146e783\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9146b30fd146e783\",\"X-B3-TraceId\":\"9146b30fd146e783\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"V3igjXMBfrYj4vM9AyUJ","_score":3.5604272,"_source":{"@timestamp":"2020-07-27T00:15:31.138Z","message":"{\"ts\":\"2020-07-27T00:15:31.138+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a1eefa1f7c6d7600\",\"spanId\":\"a1eefa1f7c6d7600\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a1eefa1f7c6d7600\",\"X-B3-TraceId\":\"a1eefa1f7c6d7600\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":29358423,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"r3igjXMBfrYj4vM9gyr3","_score":3.5604272,"_source":{"@timestamp":"2020-07-27T00:16:09.021Z","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":29383923,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:16:09.021+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7cd409989dfdfa52\",\"spanId\":\"7cd409989dfdfa52\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7cd409989dfdfa52\",\"X-B3-TraceId\":\"7cd409989dfdfa52\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
1079372 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
1079400 [main] INFO  kkm.UnitTests - End test

1079401 [main] INFO  kkm.UnitTests - Starting test: KKM_DB7()
1079523 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-BxPKidICPNrY', '5270420835', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-BxPKidICPNrY','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-BxPKidICPNrY', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-BxPKidICPNrY', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-BxPKidICPNrY'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-BxPKidICPNrY'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-BxPKidICPNrY'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-BxPKidICPNrY'
1190203 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-BxPKidICPNrY'
1190204 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-BxPKidICPNrY, null]
1190206 [main] INFO  kkm.UnitTests - Status: null
1190206 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1190206 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1210211 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1210391 [main] INFO  kkm.UnitTests - Response message : {"took":120,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":833,"relation":"eq"},"max_score":3.5602272,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"o3aSjXMBfrYj4vM9LZH0","_score":3.5602272,"_source":{"@timestamp":"2020-07-27T00:00:09.153Z","ecs":{"version":"1.0.1"},"log":{"offset":28726039,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-27T00:00:09.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"d452230b2efe5ab7\",\"spanId\":\"d452230b2efe5ab7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d452230b2efe5ab7\",\"X-B3-TraceId\":\"d452230b2efe5ab7\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"OXaSjXMBfrYj4vM9UpQ9","_score":3.5602272,"_source":{"@timestamp":"2020-07-27T00:00:31.122Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"host":{"name":"25805977eece"},"input":{"type":"container"},"message":"{\"ts\":\"2020-07-27T00:00:31.122+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3dd65d6f98321076\",\"spanId\":\"3dd65d6f98321076\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3dd65d6f98321076\",\"X-B3-TraceId\":\"3dd65d6f98321076\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":28738954},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"X3ifjXMBfrYj4vM9nQx0","_score":3.5602272,"_source":{"@timestamp":"2020-07-27T00:15:09.048Z","stream":"stdout","log":{"offset":29337267,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T00:15:09.047+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9146b30fd146e783\",\"spanId\":\"9146b30fd146e783\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9146b30fd146e783\",\"X-B3-TraceId\":\"9146b30fd146e783\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"V3igjXMBfrYj4vM9AyUJ","_score":3.5602272,"_source":{"@timestamp":"2020-07-27T00:15:31.138Z","message":"{\"ts\":\"2020-07-27T00:15:31.138+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a1eefa1f7c6d7600\",\"spanId\":\"a1eefa1f7c6d7600\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a1eefa1f7c6d7600\",\"X-B3-TraceId\":\"a1eefa1f7c6d7600\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":29358423,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"r3igjXMBfrYj4vM9gyr3","_score":3.5602272,"_source":{"@timestamp":"2020-07-27T00:16:09.021Z","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":29383923,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:16:09.021+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7cd409989dfdfa52\",\"spanId\":\"7cd409989dfdfa52\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7cd409989dfdfa52\",\"X-B3-TraceId\":\"7cd409989dfdfa52\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
1210511 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1210534 [main] INFO  kkm.UnitTests - End test

1210535 [main] INFO  kkm.UnitTests - Starting test: KKM_DB8()
1210651 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-aLGNls6lPxjF', '9582414355', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-aLGNls6lPxjF','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-aLGNls6lPxjF', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-aLGNls6lPxjF', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-aLGNls6lPxjF'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-aLGNls6lPxjF'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-aLGNls6lPxjF'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-aLGNls6lPxjF'
1321487 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-aLGNls6lPxjF'
1321488 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-aLGNls6lPxjF, null]
1321492 [main] INFO  kkm.UnitTests - Status: null
1321492 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1321492 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1341495 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.27/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1341578 [main] INFO  kkm.UnitTests - Response message : {"took":31,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":837,"relation":"eq"},"max_score":3.5600286,"hits":[{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"o3aSjXMBfrYj4vM9LZH0","_score":3.5600286,"_source":{"@timestamp":"2020-07-27T00:00:09.153Z","ecs":{"version":"1.0.1"},"log":{"offset":28726039,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"message":"{\"ts\":\"2020-07-27T00:00:09.153+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"d452230b2efe5ab7\",\"spanId\":\"d452230b2efe5ab7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"d452230b2efe5ab7\",\"X-B3-TraceId\":\"d452230b2efe5ab7\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"stream":"stdout","input":{"type":"container"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"OXaSjXMBfrYj4vM9UpQ9","_score":3.5600286,"_source":{"@timestamp":"2020-07-27T00:00:31.122Z","container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":""}}},"host":{"name":"25805977eece"},"input":{"type":"container"},"message":"{\"ts\":\"2020-07-27T00:00:31.122+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3dd65d6f98321076\",\"spanId\":\"3dd65d6f98321076\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3dd65d6f98321076\",\"X-B3-TraceId\":\"3dd65d6f98321076\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"},"offset":28738954},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"stream":"stdout"}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"X3ifjXMBfrYj4vM9nQx0","_score":3.5600286,"_source":{"@timestamp":"2020-07-27T00:15:09.048Z","stream":"stdout","log":{"offset":29337267,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-07-27T00:15:09.047+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"9146b30fd146e783\",\"spanId\":\"9146b30fd146e783\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"9146b30fd146e783\",\"X-B3-TraceId\":\"9146b30fd146e783\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"V3igjXMBfrYj4vM9AyUJ","_score":3.5600286,"_source":{"@timestamp":"2020-07-27T00:15:31.138Z","message":"{\"ts\":\"2020-07-27T00:15:31.138+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"a1eefa1f7c6d7600\",\"spanId\":\"a1eefa1f7c6d7600\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a1eefa1f7c6d7600\",\"X-B3-TraceId\":\"a1eefa1f7c6d7600\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":29358423,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.27","_type":"_doc","_id":"r3igjXMBfrYj4vM9gyr3","_score":3.5600286,"_source":{"@timestamp":"2020-07-27T00:16:09.021Z","input":{"type":"container"},"container":{"id":"4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a","name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Description":"KKM Commutator Service","com_docker_swarm_task_id":"8fz0cpmgewgphbyckw9khoxn7","com_docker_swarm_task_name":"kkm-commutator_service.1.8fz0cpmgewgphbyckw9khoxn7","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service"}}},"host":{"name":"25805977eece"},"ecs":{"version":"1.0.1"},"log":{"offset":29383923,"file":{"path":"/var/lib/docker/containers/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a/4757dd31a12511c1c1e27cde013947f1e277e86aba65883883338c186a767c6a-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-27T00:16:09.021+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"7cd409989dfdfa52\",\"spanId\":\"7cd409989dfdfa52\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7cd409989dfdfa52\",\"X-B3-TraceId\":\"7cd409989dfdfa52\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
1341704 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
1341727 [main] INFO  kkm.UnitTests - End test

1341728 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageWasCanceled()
1344756 [main] INFO  kkm.UnitTests - End test

1344757 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceleNotFound()
1344796 [main] INFO  kkm.UnitTests - End test

1344797 [main] INFO  kkm.UnitTests - Starting test: KKM_makeAndCancelCheckCashier()
1587539 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.27/_search?q=%20message:%20%22CID=0803be49-323e-465d-99f5-8230500d58d62%22%20
1588259 [main] INFO  kkm.UnitTests - Response message : {"took":636,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":59.097374,"hits":[{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"Ks4Rj3MBfrYj4vM9pPlk","_score":59.097374,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":14842090,"@timestamp":"2020-07-27T06:59:17.890Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T09:59:17,890","thread":"qtp529223075-281256","message":"KkmService: REST request  Operation 'CancelReceipt' was call with body: 462cd78c-4362-442f-ac0d-ddbcb79716d6 | exid=ID-esb-stage-37060-1595563687826-61-68657 CID=0803be49-323e-465d-99f5-8230500d58d62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"p88Rj3MBfrYj4vM9vALN","_score":56.49534,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":14846222,"@timestamp":"2020-07-27T06:59:17.933Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-27T09:59:17,933","thread":"qtp529223075-281256","message":"KkmService: REST response Operation 'CancelReceipt' was complete with body: CancelReceiptResponse{correlationId='null', checkId='462cd78c-4362-442f-ac0d-ddbcb79716d6', canceledCheckId='cbcda065-5b90-4297-b8d4-54dd1a3d0ce0', error=null} | exid=ID-esb-stage-37060-1595563687826-61-68657 CID=0803be49-323e-465d-99f5-8230500d58d62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"0M4Rj3MBfrYj4vM9pPhk","_score":55.278393,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":14841611,"@timestamp":"2020-07-27T06:59:17.890Z","beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"timestamp":"2020-07-27T09:59:17,890","thread":"qtp529223075-281256","message":"KkmService: REST request  Operation 'CancelReceipt' was call with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-68656, JMSCorrelationID=0803be49-323e-465d-99f5-8230500d58d62, operationName=CancelReceipt, X-VSK-CorrelationId=0803be49-323e-465d-99f5-8230500d58d62} | exid=ID-esb-stage-37060-1595563687826-61-68657 CID=0803be49-323e-465d-99f5-8230500d58d62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"Fc4Rj3MBfrYj4vM9pPpn","_score":52.632988,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":14842402,"beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"@timestamp":"2020-07-27T06:59:17.890Z","timestamp":"2020-07-27T09:59:17,890","thread":"thread #2387 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-68656, CamelHttpMethod=PUT, JMSCorrelationID=0803be49-323e-465d-99f5-8230500d58d62, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/462cd78c-4362-442f-ac0d-ddbcb79716d6/cancel, X-VSK-CorrelationId=0803be49-323e-465d-99f5-8230500d58d62} | exId=ID-esb-stage-37060-1595563687826-61-68659 CID=0803be49-323e-465d-99f5-8230500d58d62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"784Rj3MBfrYj4vM9pPhk","_score":51.23198,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":14843015,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T06:59:17.890Z","timestamp":"2020-07-27T09:59:17,890","thread":"thread #2387 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-68656, CamelHttpMethod=PUT, JMSCorrelationID=0803be49-323e-465d-99f5-8230500d58d62, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/462cd78c-4362-442f-ac0d-ddbcb79716d6/cancel, X-VSK-CorrelationId=0803be49-323e-465d-99f5-8230500d58d62} | exId=ID-esb-stage-37060-1595563687826-61-68659 CID=0803be49-323e-465d-99f5-8230500d58d62 |\n 462cd78c-4362-442f-ac0d-ddbcb79716d6","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"0c4Rj3MBfrYj4vM9pPhk","_score":48.035416,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":14845395,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T06:59:17.933Z","timestamp":"2020-07-27T09:59:17,933","thread":"qtp529223075-281256","message":"KkmService: REST response Operation 'CancelReceipt' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-68656, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 06:59:18 GMT, JMSCorrelationID=0803be49-323e-465d-99f5-8230500d58d62, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/462cd78c-4362-442f-ac0d-ddbcb79716d6/cancel, X-VSK-CorrelationId=0803be49-323e-465d-99f5-8230500d58d62} | exid=ID-esb-stage-37060-1595563687826-61-68657 CID=0803be49-323e-465d-99f5-8230500d58d62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"2M4Rj3MBfrYj4vM9pPlm","_score":48.035416,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":14843668,"@timestamp":"2020-07-27T06:59:17.933Z","beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"timestamp":"2020-07-27T09:59:17,933","thread":"thread #2387 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-68656, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 06:59:18 GMT, JMSCorrelationID=0803be49-323e-465d-99f5-8230500d58d62, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/462cd78c-4362-442f-ac0d-ddbcb79716d6/cancel, X-VSK-CorrelationId=0803be49-323e-465d-99f5-8230500d58d62} | exid=ID-esb-stage-37060-1595563687826-61-68659 CID=0803be49-323e-465d-99f5-8230500d58d62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.27","_type":"_doc","_id":"nM4Rj3MBfrYj4vM9pPll","_score":46.865765,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":14844476,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-27T06:59:17.933Z","timestamp":"2020-07-27T09:59:17,933","thread":"thread #2387 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-68656, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Mon, 27 Jul 2020 06:59:18 GMT, JMSCorrelationID=0803be49-323e-465d-99f5-8230500d58d62, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/462cd78c-4362-442f-ac0d-ddbcb79716d6/cancel, X-VSK-CorrelationId=0803be49-323e-465d-99f5-8230500d58d62} | exid=ID-esb-stage-37060-1595563687826-61-68659 CID=0803be49-323e-465d-99f5-8230500d58d62 |\n {\"checkId\":\"462cd78c-4362-442f-ac0d-ddbcb79716d6\",\"canceledCheckId\":\"cbcda065-5b90-4297-b8d4-54dd1a3d0ce0\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
1588260 [main] INFO  kkm.UnitTests - End test

1588263 [main] INFO  kkm.UnitTests - Starting test: KKM_SIPheckStatus()
1590933 [main] INFO  kkm.UnitTests - End test

1590936 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageNotFound()
1590974 [main] INFO  kkm.UnitTests - End test

1590977 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt_negative()
1591058 [main] INFO  kkm.UnitTests - End test

1591059 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt()
1593407 [main] INFO  kkm.UnitTests - End test

