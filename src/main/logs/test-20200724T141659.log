146  [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckNoCashier()
2996 [main] INFO  kkm.UnitTests - End test

3004 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageEmail()
275970 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.24/_search?q=%20message:%20%22CID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11%22%20
276765 [main] INFO  kkm.UnitTests - Response message : {"took":697,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":59.927643,"hits":[{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"EUFUgHMBfrYj4vM9aP57","_score":59.927643,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1056374,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-24T10:17:33.020Z","timestamp":"2020-07-24T13:17:33,020","thread":"qtp529223075-35288","message":"KkmService: REST response Operation 'SendMessage' was complete with body: ReceiptResponse{correlationId='null', checkId='323f7404-7b4b-4e8d-b0dc-c029033e48c0', error=null} | exid=ID-esb-stage-37060-1595563687826-61-49557 CID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"OUFUgHMBfrYj4vM9Ld7g","_score":59.64537,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1051983,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-24T10:17:32.991Z","timestamp":"2020-07-24T13:17:32,991","thread":"qtp529223075-35288","message":"KkmService: REST request  Operation 'SendMessage' was call with body: SendMessageRequest{checkId='323f7404-7b4b-4e8d-b0dc-c029033e48c0', messageType='email', messageAddress='EPolikarpova@VSK.RU'} | exid=ID-esb-stage-37060-1595563687826-61-49557 CID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"OEFUgHMBfrYj4vM9Ld7g","_score":56.707275,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1051505,"beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"@timestamp":"2020-07-24T10:17:32.991Z","timestamp":"2020-07-24T13:17:32,991","thread":"qtp529223075-35288","message":"KkmService: REST request  Operation 'SendMessage' was call with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-49556, JMSCorrelationID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11, operationName=SendMessage, X-VSK-CorrelationId=ef8ae440-8871-4523-8d7f-ebc74b73db5e11} | exid=ID-esb-stage-37060-1595563687826-61-49557 CID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"OkFUgHMBfrYj4vM9Ld7g","_score":52.47727,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1052383,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-24T10:17:32.992Z","timestamp":"2020-07-24T13:17:32,992","thread":"thread #2376 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-49556, CamelHttpMethod=GET, JMSCorrelationID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/323f7404-7b4b-4e8d-b0dc-c029033e48c0/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=ef8ae440-8871-4523-8d7f-ebc74b73db5e11} | exId=ID-esb-stage-37060-1595563687826-61-49559 CID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"O0FUgHMBfrYj4vM9Ld7g","_score":52.47727,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1053023,"@timestamp":"2020-07-24T10:17:32.992Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-24T13:17:32,992","thread":"thread #2376 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-49556, CamelHttpMethod=GET, JMSCorrelationID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11, operationName=SendMessage, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/323f7404-7b4b-4e8d-b0dc-c029033e48c0/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=ef8ae440-8871-4523-8d7f-ebc74b73db5e11} | exId=ID-esb-stage-37060-1595563687826-61-49559 CID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11 |\n ","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"PEFUgHMBfrYj4vM9Ld7g","_score":46.333008,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1053667,"@timestamp":"2020-07-24T10:17:33.020Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-24T13:17:33,020","thread":"thread #2376 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-49556, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Fri, 24 Jul 2020 10:17:34 GMT, JMSCorrelationID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/323f7404-7b4b-4e8d-b0dc-c029033e48c0/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=ef8ae440-8871-4523-8d7f-ebc74b73db5e11} | exid=ID-esb-stage-37060-1595563687826-61-49559 CID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"PkFUgHMBfrYj4vM9Ld7g","_score":46.333008,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1055477,"beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"@timestamp":"2020-07-24T10:17:33.020Z","timestamp":"2020-07-24T13:17:33,020","thread":"qtp529223075-35288","message":"KkmService: REST response Operation 'SendMessage' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-49556, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Fri, 24 Jul 2020 10:17:34 GMT, JMSCorrelationID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/323f7404-7b4b-4e8d-b0dc-c029033e48c0/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=ef8ae440-8871-4523-8d7f-ebc74b73db5e11} | exid=ID-esb-stage-37060-1595563687826-61-49557 CID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"PUFUgHMBfrYj4vM9Ld7g","_score":45.015358,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":1054545,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-24T10:17:33.020Z","timestamp":"2020-07-24T13:17:33,020","thread":"thread #2376 - seda://kkmRestAPI","message":"KkmService: 'SendMessage' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-49556, CamelHttpMethod=GET, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Disposition=inline;filename=f.txt, Content-Type=application/json;charset=utf-8, Date=Fri, 24 Jul 2020 10:17:34 GMT, JMSCorrelationID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11, operationName=SendMessage, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/323f7404-7b4b-4e8d-b0dc-c029033e48c0/messages/email/EPolikarpova@VSK.RU, X-VSK-CorrelationId=ef8ae440-8871-4523-8d7f-ebc74b73db5e11} | exid=ID-esb-stage-37060-1595563687826-61-49559 CID=ef8ae440-8871-4523-8d7f-ebc74b73db5e11 |\n {\"checkId\":\"323f7404-7b4b-4e8d-b0dc-c029033e48c0\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
276767 [main] INFO  kkm.UnitTests - End test

276770 [main] INFO  kkm.UnitTests - Starting test: KKM_WAcheckStatus()
279138 [main] INFO  kkm.UnitTests - End test

279141 [main] INFO  kkm.UnitTests - Starting test: KKM_getStatus()
281901 [main] INFO  kkm.UnitTests - End test

281904 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceledAlredy()
285213 [main] INFO  kkm.UnitTests - End test

285217 [main] INFO  kkm.UnitTests - Starting test: KKM_getDocCustomer()
285681 [main] INFO  kkm.UnitTests - End test

285683 [main] INFO  kkm.UnitTests - Starting test: KKM_makeCheckCashier()
290749 [main] INFO  kkm.UnitTests - End test

290753 [main] INFO  kkm.UnitTests - Starting test: KKM_DB1()
291369 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
291376 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898622
291379 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898622
291820 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000898622'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898622'
select * from ProcessStatus where srcID = 'ЖПлато_000898622'
291822 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000898622]
291827 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000898622]
352079 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898622'
352080 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000898622]
412087 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.24/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898622%22%20&size=500
412194 [main] INFO  kkm.UnitTests - Response message : {"took":34,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":2,"relation":"eq"},"max_score":12.187401,"hits":[{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"A8Rtf3MBfrYj4vM941ee","_score":12.187401,"_source":{"@timestamp":"2020-07-24T06:06:09.095Z","message":"{\"ts\":\"2020-07-24T06:06:09.093+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"358b833597423eb1\",\"spanId\":\"358b833597423eb1\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"358b833597423eb1\",\"X-B3-TraceId\":\"358b833597423eb1\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"container":{"id":"696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5","name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"host":{"name":"25805977eece"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"offset":6065520,"file":{"path":"/var/lib/docker/containers/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5-json.log"}},"stream":"stdout","docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_task_id":"rsbhpo3kr9y2xy2cwv2x95c8v","com_docker_swarm_task_name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"00RYgHMBfrYj4vM9QVLt","_score":12.187401,"_source":{"@timestamp":"2020-07-24T10:22:09.075Z","log":{"offset":17020855,"file":{"path":"/var/lib/docker/containers/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5-json.log"}},"message":"{\"ts\":\"2020-07-24T10:22:09.075+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"7a5aeba6507541c3\",\"spanId\":\"7a5aeba6507541c3\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7a5aeba6507541c3\",\"X-B3-TraceId\":\"7a5aeba6507541c3\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898622\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Version":"97","com_docker_swarm_task_id":"rsbhpo3kr9y2xy2cwv2x95c8v","com_docker_swarm_task_name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"stream":"stdout","input":{"type":"container"},"container":{"id":"696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5","name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"}}}]}}
412196 [main] INFO  kkm.UnitTests - End test

412200 [main] INFO  kkm.UnitTests - Starting test: KKM_DB2()
412354 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
412354 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
412357 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
412833 [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
412833 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
412834 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
473075 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
473076 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, nothing, ЖПлато_000898541]
533078 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.24/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
533133 [main] INFO  kkm.UnitTests - Response message : {"took":5,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":2,"relation":"eq"},"max_score":11.393973,"hits":[{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"vsVvf3MBfrYj4vM9uOVs","_score":11.393973,"_source":{"@timestamp":"2020-07-24T06:08:09.058Z","docker":{"container":{"labels":{"com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"rsbhpo3kr9y2xy2cwv2x95c8v","com_docker_swarm_task_name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"container":{"id":"696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5","name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"log":{"offset":6169244,"file":{"path":"/var/lib/docker/containers/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-24T06:08:09.057+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"ac9295396100359c\",\"spanId\":\"ac9295396100359c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"ac9295396100359c\",\"X-B3-TraceId\":\"ac9295396100359c\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"IkVagHMBfrYj4vM9Fmew","_score":11.393973,"_source":{"@timestamp":"2020-07-24T10:24:09.442Z","input":{"type":"container"},"ecs":{"version":"1.0.1"},"docker":{"container":{"labels":{"Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"rsbhpo3kr9y2xy2cwv2x95c8v","com_docker_swarm_task_name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","Description":"KKM Commutator Service"}}},"host":{"name":"25805977eece"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"log":{"offset":17123538,"file":{"path":"/var/lib/docker/containers/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5-json.log"}},"stream":"stdout","message":"{\"ts\":\"2020-07-24T10:24:09.442+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"a05a50ee35275799\",\"spanId\":\"a05a50ee35275799\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a05a50ee35275799\",\"X-B3-TraceId\":\"a05a50ee35275799\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","container":{"name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5"}}}]}}
533134 [main] INFO  kkm.UnitTests - End test

533135 [main] INFO  kkm.UnitTests - Starting test: KKM_DB3()
533254 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq', '7824272982', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq'
643941 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq'
643942 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq, 4246df09-5214-404f-8994-779ba336b2bb]
643946 [main] INFO  kkm.UnitTests - Status: DONE
643947 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
643947 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
664091 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.24/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-YVi9JvLZn0Bq%22%20&size=500
664154 [main] INFO  kkm.UnitTests - Response message : {"took":8,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":28.236715,"hits":[{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"yUZbgHMBfrYj4vM96xJ1","_score":28.236715,"_source":{"@timestamp":"2020-07-24T10:26:09.054Z","stream":"stdout","input":{"type":"container"},"container":{"id":"696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5","name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"rsbhpo3kr9y2xy2cwv2x95c8v","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Version":"97","com_docker_stack_namespace":"kkm-commutator"}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876"},"log":{"offset":17233517,"file":{"path":"/var/lib/docker/containers/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5-json.log"}},"message":"{\"ts\":\"2020-07-24T10:26:09.054+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"4f78c9fd07f20e33\",\"spanId\":\"4f78c9fd07f20e33\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"4f78c9fd07f20e33\",\"X-B3-TraceId\":\"4f78c9fd07f20e33\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-RZEcjVcWKREa\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-YVi9JvLZn0Bq\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}"}}]}}
664272 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
664297 [main] INFO  kkm.UnitTests - End test

664299 [main] INFO  kkm.UnitTests - Starting test: KKM_DB4()
664443 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ogoz0OBDU9du', '3732624893', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ogoz0OBDU9du','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ogoz0OBDU9du', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-ogoz0OBDU9du', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-ogoz0OBDU9du'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-ogoz0OBDU9du'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-ogoz0OBDU9du'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-ogoz0OBDU9du'
775274 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-ogoz0OBDU9du'
775276 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-ogoz0OBDU9du, b117cb41-d70c-4566-b6a2-a14b1acad8f4]
775280 [main] INFO  kkm.UnitTests - Status: FAIL
775280 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
775280 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
795684 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.24/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-ogoz0OBDU9du%22%20&size=500
795780 [main] INFO  kkm.UnitTests - Response message : {"took":15,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.924753,"hits":[{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"ikZdgHMBfrYj4vM9wK43","_score":27.924753,"_source":{"@timestamp":"2020-07-24T10:28:09.185Z","message":"{\"ts\":\"2020-07-24T10:28:09.185+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"a01812d2008c3a59\",\"spanId\":\"a01812d2008c3a59\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"a01812d2008c3a59\",\"X-B3-TraceId\":\"a01812d2008c3a59\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-g4JohKpMDIgX\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-ogoz0OBDU9du\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"container":{"id":"696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5","name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_task_id":"rsbhpo3kr9y2xy2cwv2x95c8v","com_docker_swarm_task_name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"ecs":{"version":"1.0.1"},"stream":"stdout","log":{"offset":17370658,"file":{"path":"/var/lib/docker/containers/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5-json.log"}}}}]}}
795911 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
795937 [main] INFO  kkm.UnitTests - End test

795941 [main] INFO  kkm.UnitTests - Starting test: KKM_DB5()
796057 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-il0BqVU6hIfq', '4582265744', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-il0BqVU6hIfq','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-il0BqVU6hIfq', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-il0BqVU6hIfq', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-il0BqVU6hIfq'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-il0BqVU6hIfq'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-il0BqVU6hIfq'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-il0BqVU6hIfq'
906781 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-il0BqVU6hIfq'
906782 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-il0BqVU6hIfq, 9c40bf34-b8b9-4022-b431-031be0a63121]
906786 [main] INFO  kkm.UnitTests - Status: DONE
906786 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
906786 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
926909 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.24/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-il0BqVU6hIfq%22%20&size=500
926980 [main] INFO  kkm.UnitTests - Response message : {"took":17,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":27.6494,"hits":[{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"PEdfgHMBfrYj4vM97OxL","_score":27.6494,"_source":{"@timestamp":"2020-07-24T10:30:31.201Z","message":"{\"ts\":\"2020-07-24T10:30:31.201+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"f4078a6795bbb056\",\"spanId\":\"f4078a6795bbb056\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"f4078a6795bbb056\",\"X-B3-TraceId\":\"f4078a6795bbb056\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-il0BqVU6hIfq\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-1gAUvtJSrPOR\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","log":{"offset":17528038,"file":{"path":"/var/lib/docker/containers/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5-json.log"}},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"docker":{"container":{"labels":{"com_docker_swarm_task":"","com_docker_swarm_task_id":"rsbhpo3kr9y2xy2cwv2x95c8v","com_docker_swarm_task_name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"stream":"stdout","input":{"type":"container"},"container":{"id":"696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5","name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}}}}]}}
927099 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
927128 [main] INFO  kkm.UnitTests - End test

927131 [main] INFO  kkm.UnitTests - Starting test: KKM_DB6()
927261 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-irG4gBq51ajP', '3474129264', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-irG4gBq51ajP','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-irG4gBq51ajP', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-irG4gBq51ajP', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-irG4gBq51ajP'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-irG4gBq51ajP'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-irG4gBq51ajP'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-irG4gBq51ajP'
1037908 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-irG4gBq51ajP'
1037908 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-irG4gBq51ajP, null]
1037911 [main] INFO  kkm.UnitTests - Status: null
1037911 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1037911 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1057912 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.24/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1058033 [main] INFO  kkm.UnitTests - Response message : {"took":72,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1263,"relation":"eq"},"max_score":5.368604,"hits":[{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"dpn-fnMBfrYj4vM9rllb","_score":5.368604,"_source":{"@timestamp":"2020-07-24T04:04:41.968Z","stream":"stdout","log":{"offset":774733,"file":{"path":"/var/lib/docker/containers/e18f19a7cd33e89c860e1b31f01e648f7fdd65d6fb2c9c5dfe19bfdc4d76b28b/e18f19a7cd33e89c860e1b31f01e648f7fdd65d6fb2c9c5dfe19bfdc4d76b28b-json.log"}},"input":{"type":"container"},"container":{"id":"e18f19a7cd33e89c860e1b31f01e648f7fdd65d6fb2c9c5dfe19bfdc4d76b28b","name":"kkm-commutator_service.1.oblpq9bam4o7ngzg5rjg15phn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.oblpq9bam4o7ngzg5rjg15phn","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_id":"oblpq9bam4o7ngzg5rjg15phn","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-24T04:04:41.968+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"-5j8fnMBfrYj4vM9efoG","_score":5.368604,"_source":{"@timestamp":"2020-07-24T04:02:17.266Z","stream":"stdout","container":{"name":"kkm-commutator_service.1.la3yz63wepu5zi890sitccied","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"b29b9e0a968b9ae2c134fa4060a78acf0f9676ca149c24cce79feea01424eff6"},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_id":"la3yz63wepu5zi890sitccied","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.la3yz63wepu5zi890sitccied","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Version":"97"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":774751,"file":{"path":"/var/lib/docker/containers/b29b9e0a968b9ae2c134fa4060a78acf0f9676ca149c24cce79feea01424eff6/b29b9e0a968b9ae2c134fa4060a78acf0f9676ca149c24cce79feea01424eff6-json.log"}},"message":"{\"ts\":\"2020-07-24T04:02:17.266+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"GJoAf3MBfrYj4vM941xh","_score":5.368604,"_source":{"@timestamp":"2020-07-24T04:07:06.471Z","ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-24T04:07:06.471+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","log":{"offset":774748,"file":{"path":"/var/lib/docker/containers/14db796fc0ebe5f229c572d061248713b2c0933a2584bc427b3efbf02090b8ea/14db796fc0ebe5f229c572d061248713b2c0933a2584bc427b3efbf02090b8ea-json.log"}},"stream":"stdout","container":{"id":"14db796fc0ebe5f229c572d061248713b2c0933a2584bc427b3efbf02090b8ea","name":"kkm-commutator_service.1.5ab7hm5uettvefpahnh7oqnwr","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","com_docker_swarm_task_name":"kkm-commutator_service.1.5ab7hm5uettvefpahnh7oqnwr","com_docker_swarm_task_id":"5ab7hm5uettvefpahnh7oqnwr","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":""}}}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"HZoDf3MBfrYj4vM9GNjS","_score":5.368604,"_source":{"@timestamp":"2020-07-24T04:09:31.943Z","message":"{\"ts\":\"2020-07-24T04:09:31.942+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"rsbhpo3kr9y2xy2cwv2x95c8v","com_docker_swarm_task_name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"},"stream":"stdout","ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"file":{"path":"/var/lib/docker/containers/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5-json.log"},"offset":774747}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"N24ifnMBfrYj4vM9fdVq","_score":3.7005675,"_source":{"@timestamp":"2020-07-24T00:04:09.050Z","input":{"type":"container"},"container":{"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida"}}},"ecs":{"version":"1.0.1"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"message":"{\"ts\":\"2020-07-24T00:04:09.050+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"e10f9e688e02e50d\",\"spanId\":\"e10f9e688e02e50d\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"e10f9e688e02e50d\",\"X-B3-TraceId\":\"e10f9e688e02e50d\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"},"offset":583459},"stream":"stdout","host":{"name":"25805977eece"}}}]}}
1058176 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
1058201 [main] INFO  kkm.UnitTests - End test

1058202 [main] INFO  kkm.UnitTests - Starting test: KKM_DB7()
1058325 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-T1Es4cFjFujk', '5148559424', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-T1Es4cFjFujk','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-T1Es4cFjFujk', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-T1Es4cFjFujk', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-T1Es4cFjFujk'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-T1Es4cFjFujk'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-T1Es4cFjFujk'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-T1Es4cFjFujk'
1169003 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-T1Es4cFjFujk'
1169004 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-T1Es4cFjFujk, null]
1169008 [main] INFO  kkm.UnitTests - Status: null
1169009 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1169009 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1189012 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.24/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1189078 [main] INFO  kkm.UnitTests - Response message : {"took":6,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1269,"relation":"eq"},"max_score":5.36756,"hits":[{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"dpn-fnMBfrYj4vM9rllb","_score":5.36756,"_source":{"@timestamp":"2020-07-24T04:04:41.968Z","stream":"stdout","log":{"offset":774733,"file":{"path":"/var/lib/docker/containers/e18f19a7cd33e89c860e1b31f01e648f7fdd65d6fb2c9c5dfe19bfdc4d76b28b/e18f19a7cd33e89c860e1b31f01e648f7fdd65d6fb2c9c5dfe19bfdc4d76b28b-json.log"}},"input":{"type":"container"},"container":{"id":"e18f19a7cd33e89c860e1b31f01e648f7fdd65d6fb2c9c5dfe19bfdc4d76b28b","name":"kkm-commutator_service.1.oblpq9bam4o7ngzg5rjg15phn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.oblpq9bam4o7ngzg5rjg15phn","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_id":"oblpq9bam4o7ngzg5rjg15phn","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-24T04:04:41.968+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"-5j8fnMBfrYj4vM9efoG","_score":5.36756,"_source":{"@timestamp":"2020-07-24T04:02:17.266Z","stream":"stdout","container":{"name":"kkm-commutator_service.1.la3yz63wepu5zi890sitccied","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"b29b9e0a968b9ae2c134fa4060a78acf0f9676ca149c24cce79feea01424eff6"},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_id":"la3yz63wepu5zi890sitccied","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.la3yz63wepu5zi890sitccied","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Version":"97"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":774751,"file":{"path":"/var/lib/docker/containers/b29b9e0a968b9ae2c134fa4060a78acf0f9676ca149c24cce79feea01424eff6/b29b9e0a968b9ae2c134fa4060a78acf0f9676ca149c24cce79feea01424eff6-json.log"}},"message":"{\"ts\":\"2020-07-24T04:02:17.266+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"GJoAf3MBfrYj4vM941xh","_score":5.36756,"_source":{"@timestamp":"2020-07-24T04:07:06.471Z","ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-24T04:07:06.471+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","log":{"offset":774748,"file":{"path":"/var/lib/docker/containers/14db796fc0ebe5f229c572d061248713b2c0933a2584bc427b3efbf02090b8ea/14db796fc0ebe5f229c572d061248713b2c0933a2584bc427b3efbf02090b8ea-json.log"}},"stream":"stdout","container":{"id":"14db796fc0ebe5f229c572d061248713b2c0933a2584bc427b3efbf02090b8ea","name":"kkm-commutator_service.1.5ab7hm5uettvefpahnh7oqnwr","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","com_docker_swarm_task_name":"kkm-commutator_service.1.5ab7hm5uettvefpahnh7oqnwr","com_docker_swarm_task_id":"5ab7hm5uettvefpahnh7oqnwr","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":""}}}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"HZoDf3MBfrYj4vM9GNjS","_score":5.36756,"_source":{"@timestamp":"2020-07-24T04:09:31.943Z","message":"{\"ts\":\"2020-07-24T04:09:31.942+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"rsbhpo3kr9y2xy2cwv2x95c8v","com_docker_swarm_task_name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"},"stream":"stdout","ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"file":{"path":"/var/lib/docker/containers/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5-json.log"},"offset":774747}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"N24ifnMBfrYj4vM9fdVq","_score":3.6999006,"_source":{"@timestamp":"2020-07-24T00:04:09.050Z","input":{"type":"container"},"container":{"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida"}}},"ecs":{"version":"1.0.1"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"message":"{\"ts\":\"2020-07-24T00:04:09.050+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"e10f9e688e02e50d\",\"spanId\":\"e10f9e688e02e50d\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"e10f9e688e02e50d\",\"X-B3-TraceId\":\"e10f9e688e02e50d\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"},"offset":583459},"stream":"stdout","host":{"name":"25805977eece"}}}]}}
1189206 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1189234 [main] INFO  kkm.UnitTests - End test

1189237 [main] INFO  kkm.UnitTests - Starting test: KKM_DB8()
1189384 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-2uplSF5SHrRf', '0893150515', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-2uplSF5SHrRf','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-2uplSF5SHrRf', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-2uplSF5SHrRf', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-2uplSF5SHrRf'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-2uplSF5SHrRf'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-2uplSF5SHrRf'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-2uplSF5SHrRf'
1299977 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-2uplSF5SHrRf'
1299977 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-2uplSF5SHrRf, null]
1299979 [main] INFO  kkm.UnitTests - Status: null
1299979 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
1299979 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
1319980 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.07.24/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
1320033 [main] INFO  kkm.UnitTests - Response message : {"took":3,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1273,"relation":"eq"},"max_score":5.366979,"hits":[{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"dpn-fnMBfrYj4vM9rllb","_score":5.366979,"_source":{"@timestamp":"2020-07-24T04:04:41.968Z","stream":"stdout","log":{"offset":774733,"file":{"path":"/var/lib/docker/containers/e18f19a7cd33e89c860e1b31f01e648f7fdd65d6fb2c9c5dfe19bfdc4d76b28b/e18f19a7cd33e89c860e1b31f01e648f7fdd65d6fb2c9c5dfe19bfdc4d76b28b-json.log"}},"input":{"type":"container"},"container":{"id":"e18f19a7cd33e89c860e1b31f01e648f7fdd65d6fb2c9c5dfe19bfdc4d76b28b","name":"kkm-commutator_service.1.oblpq9bam4o7ngzg5rjg15phn","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.oblpq9bam4o7ngzg5rjg15phn","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_task_id":"oblpq9bam4o7ngzg5rjg15phn","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task":"","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_stack_namespace":"kkm-commutator"}}},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-24T04:04:41.968+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"-5j8fnMBfrYj4vM9efoG","_score":5.366979,"_source":{"@timestamp":"2020-07-24T04:02:17.266Z","stream":"stdout","container":{"name":"kkm-commutator_service.1.la3yz63wepu5zi890sitccied","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"b29b9e0a968b9ae2c134fa4060a78acf0f9676ca149c24cce79feea01424eff6"},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_id":"la3yz63wepu5zi890sitccied","Description":"KKM Commutator Service","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_name":"kkm-commutator_service.1.la3yz63wepu5zi890sitccied","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","Version":"97"}}},"ecs":{"version":"1.0.1"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"log":{"offset":774751,"file":{"path":"/var/lib/docker/containers/b29b9e0a968b9ae2c134fa4060a78acf0f9676ca149c24cce79feea01424eff6/b29b9e0a968b9ae2c134fa4060a78acf0f9676ca149c24cce79feea01424eff6-json.log"}},"message":"{\"ts\":\"2020-07-24T04:02:17.266+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"host":{"name":"25805977eece"}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"GJoAf3MBfrYj4vM941xh","_score":5.366979,"_source":{"@timestamp":"2020-07-24T04:07:06.471Z","ecs":{"version":"1.0.1"},"host":{"name":"25805977eece"},"agent":{"ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat"},"message":"{\"ts\":\"2020-07-24T04:07:06.471+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","log":{"offset":774748,"file":{"path":"/var/lib/docker/containers/14db796fc0ebe5f229c572d061248713b2c0933a2584bc427b3efbf02090b8ea/14db796fc0ebe5f229c572d061248713b2c0933a2584bc427b3efbf02090b8ea-json.log"}},"stream":"stdout","container":{"id":"14db796fc0ebe5f229c572d061248713b2c0933a2584bc427b3efbf02090b8ea","name":"kkm-commutator_service.1.5ab7hm5uettvefpahnh7oqnwr","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","com_docker_swarm_task_name":"kkm-commutator_service.1.5ab7hm5uettvefpahnh7oqnwr","com_docker_swarm_task_id":"5ab7hm5uettvefpahnh7oqnwr","Version":"97","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":""}}}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"HZoDf3MBfrYj4vM9GNjS","_score":5.366979,"_source":{"@timestamp":"2020-07-24T04:09:31.943Z","message":"{\"ts\":\"2020-07-24T04:09:31.942+00:00\",\"logger\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"level\":\"DEBUG\",\"class\":\"springfox.documentation.spring.web.plugins.DefaultRequestHandlerCombiner\",\"method\":\"combine\",\"caller_file_name\":\"DefaultRequestHandlerCombiner.java\",\"caller_line_number\":52,\"thread\":\"main\",\"msg\":\"Adding key: [/ReadyForSendingReceiptKeys], WebMvcRequestHandler{key=RequestHandlerKey{pathMappings=[/ReadyForSendingReceiptKeys], supportedMethods=[GET], supportedMediaTypes=[], producibleMediaTypes=[]}}\"}","input":{"type":"container"},"container":{"name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5"},"docker":{"container":{"labels":{"Description":"KKM Commutator Service","com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task":"","com_docker_swarm_task_id":"rsbhpo3kr9y2xy2cwv2x95c8v","com_docker_swarm_task_name":"kkm-commutator_service.1.rsbhpo3kr9y2xy2cwv2x95c8v","Version":"97","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd"}}},"host":{"name":"25805977eece"},"stream":"stdout","ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792","hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1"},"log":{"file":{"path":"/var/lib/docker/containers/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5/696decc37adac746af7423b1d52ab3ff74d5b769a00508f73851e84f69a9fbd5-json.log"},"offset":774747}}},{"_index":"kkm-commutator-stage-2020.07.24","_type":"_doc","_id":"N24ifnMBfrYj4vM9fdVq","_score":3.69954,"_source":{"@timestamp":"2020-07-24T00:04:09.050Z","input":{"type":"container"},"container":{"id":"8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3","name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"vzf1p3l7jfjimzgsk4k4shq6n","com_docker_swarm_service_name":"kkm-commutator_service","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_task_id":"eqt37is64rgqgyp486kpbqida","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.eqt37is64rgqgyp486kpbqida"}}},"ecs":{"version":"1.0.1"},"agent":{"hostname":"25805977eece","id":"b42b3136-a942-47e4-a9fc-eaddc4fbe876","version":"7.3.1","type":"filebeat","ephemeral_id":"d557a4cf-a231-4f25-a77d-53dd56bac792"},"message":"{\"ts\":\"2020-07-24T00:04:09.050+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"e10f9e688e02e50d\",\"spanId\":\"e10f9e688e02e50d\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"e10f9e688e02e50d\",\"X-B3-TraceId\":\"e10f9e688e02e50d\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","log":{"file":{"path":"/var/lib/docker/containers/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3/8acdbd0e1f6da341879ba61aee84362cfeb386a81e0889176ea90009cea717a3-json.log"},"offset":583459},"stream":"stdout","host":{"name":"25805977eece"}}}]}}
1320150 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
1320176 [main] INFO  kkm.UnitTests - End test

1320180 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageWasCanceled()
1322932 [main] INFO  kkm.UnitTests - End test

1322934 [main] INFO  kkm.UnitTests - Starting test: KKM_CanceleNotFound()
1322964 [main] INFO  kkm.UnitTests - End test

1322966 [main] INFO  kkm.UnitTests - Starting test: KKM_makeAndCancelCheckCashier()
1565834 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/esb-stage-2020.07.24/_search?q=%20message:%20%22CID=d2c8ec89-54d5-49b9-823c-d73d149cbed62%22%20
1566272 [main] INFO  kkm.UnitTests - Response message : {"took":384,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":8,"relation":"eq"},"max_score":62.548557,"hits":[{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"hEtngHMBfrYj4vM9_Lm0","_score":62.548557,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":644075,"beat":{"version":"6.8.6","name":"esb-stage","hostname":"esb-stage"},"@timestamp":"2020-07-24T10:39:02.839Z","timestamp":"2020-07-24T13:39:02,839","thread":"qtp529223075-36873","message":"KkmService: REST request  Operation 'CancelReceipt' was call with body: cf5da3eb-f6a7-42bc-b838-09c1c8ab7754 | exid=ID-esb-stage-37060-1595563687826-61-51092 CID=d2c8ec89-54d5-49b9-823c-d73d149cbed62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"T0togHMBfrYj4vM9N9A0","_score":59.086357,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":648207,"beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"@timestamp":"2020-07-24T10:39:02.880Z","timestamp":"2020-07-24T13:39:02,880","thread":"qtp529223075-36873","message":"KkmService: REST response Operation 'CancelReceipt' was complete with body: CancelReceiptResponse{correlationId='null', checkId='cf5da3eb-f6a7-42bc-b838-09c1c8ab7754', canceledCheckId='98dee1c6-1c18-4707-abef-6e968673e0bb', error=null} | exid=ID-esb-stage-37060-1595563687826-61-51092 CID=d2c8ec89-54d5-49b9-823c-d73d149cbed62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"g0tngHMBfrYj4vM9_Lm0","_score":57.49512,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":643596,"@timestamp":"2020-07-24T10:39:02.839Z","beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"timestamp":"2020-07-24T13:39:02,839","thread":"qtp529223075-36873","message":"KkmService: REST request  Operation 'CancelReceipt' was call with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-51091, JMSCorrelationID=d2c8ec89-54d5-49b9-823c-d73d149cbed62, operationName=CancelReceipt, X-VSK-CorrelationId=d2c8ec89-54d5-49b9-823c-d73d149cbed62} | exid=ID-esb-stage-37060-1595563687826-61-51092 CID=d2c8ec89-54d5-49b9-823c-d73d149cbed62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"hUtngHMBfrYj4vM9_Lm0","_score":54.095833,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":644387,"beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"@timestamp":"2020-07-24T10:39:02.839Z","timestamp":"2020-07-24T13:39:02,839","thread":"thread #2440 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-51091, CamelHttpMethod=PUT, JMSCorrelationID=d2c8ec89-54d5-49b9-823c-d73d149cbed62, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/cf5da3eb-f6a7-42bc-b838-09c1c8ab7754/cancel, X-VSK-CorrelationId=d2c8ec89-54d5-49b9-823c-d73d149cbed62} | exId=ID-esb-stage-37060-1595563687826-61-51094 CID=d2c8ec89-54d5-49b9-823c-d73d149cbed62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"hktngHMBfrYj4vM9_Lm0","_score":52.32794,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":645000,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-24T10:39:02.839Z","timestamp":"2020-07-24T13:39:02,839","thread":"thread #2440 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' calling REST service  with headers: {breadcrumbId=ID-esb-stage-37060-1595563687826-61-51091, CamelHttpMethod=PUT, JMSCorrelationID=d2c8ec89-54d5-49b9-823c-d73d149cbed62, operationName=CancelReceipt, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/cf5da3eb-f6a7-42bc-b838-09c1c8ab7754/cancel, X-VSK-CorrelationId=d2c8ec89-54d5-49b9-823c-d73d149cbed62} | exId=ID-esb-stage-37060-1595563687826-61-51094 CID=d2c8ec89-54d5-49b9-823c-d73d149cbed62 |\n cf5da3eb-f6a7-42bc-b838-09c1c8ab7754","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"h0tngHMBfrYj4vM9_Lm0","_score":48.375595,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":645653,"beat":{"name":"esb-stage","hostname":"esb-stage","version":"6.8.6"},"@timestamp":"2020-07-24T10:39:02.880Z","timestamp":"2020-07-24T13:39:02,880","thread":"thread #2440 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-51091, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Fri, 24 Jul 2020 10:39:04 GMT, JMSCorrelationID=d2c8ec89-54d5-49b9-823c-d73d149cbed62, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/cf5da3eb-f6a7-42bc-b838-09c1c8ab7754/cancel, X-VSK-CorrelationId=d2c8ec89-54d5-49b9-823c-d73d149cbed62} | exid=ID-esb-stage-37060-1595563687826-61-51094 CID=d2c8ec89-54d5-49b9-823c-d73d149cbed62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"iUtngHMBfrYj4vM9_Lm0","_score":48.375595,"_source":{"level":"debug","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":647380,"@timestamp":"2020-07-24T10:39:02.880Z","beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"timestamp":"2020-07-24T13:39:02,880","thread":"qtp529223075-36873","message":"KkmService: REST response Operation 'CancelReceipt' was complete with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-51091, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Fri, 24 Jul 2020 10:39:04 GMT, JMSCorrelationID=d2c8ec89-54d5-49b9-823c-d73d149cbed62, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/cf5da3eb-f6a7-42bc-b838-09c1c8ab7754/cancel, X-VSK-CorrelationId=d2c8ec89-54d5-49b9-823c-d73d149cbed62} | exid=ID-esb-stage-37060-1595563687826-61-51092 CID=d2c8ec89-54d5-49b9-823c-d73d149cbed62","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}},{"_index":"esb-stage-2020.07.24","_type":"_doc","_id":"iEtngHMBfrYj4vM9_Lm0","_score":46.956924,"_source":{"level":"trace","input":{"type":"log"},"tags":["beats_input_codec_plain_applied"],"application":"esb","log":{"flags":["multiline"],"file":{"path":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log"}},"offset":646461,"beat":{"hostname":"esb-stage","version":"6.8.6","name":"esb-stage"},"@timestamp":"2020-07-24T10:39:02.880Z","timestamp":"2020-07-24T13:39:02,880","thread":"thread #2440 - seda://kkmRestAPI","message":"KkmService: 'CancelReceipt' service responded with headers: {Accept=application/json; charset=utf-8, breadcrumbId=ID-esb-stage-37060-1595563687826-61-51091, CamelHttpMethod=PUT, CamelHttpResponseCode=200, CamelHttpResponseText=, Content-Type=application/json;charset=utf-8, Date=Fri, 24 Jul 2020 10:39:04 GMT, JMSCorrelationID=d2c8ec89-54d5-49b9-823c-d73d149cbed62, operationName=CancelReceipt, Transfer-Encoding=chunked, UnitariusServiceUri=http://rcptss-api-tst.vsk.ru/master-system/api/v1/receipts/cf5da3eb-f6a7-42bc-b838-09c1c8ab7754/cancel, X-VSK-CorrelationId=d2c8ec89-54d5-49b9-823c-d73d149cbed62} | exid=ID-esb-stage-37060-1595563687826-61-51094 CID=d2c8ec89-54d5-49b9-823c-d73d149cbed62 |\n {\"checkId\":\"cf5da3eb-f6a7-42bc-b838-09c1c8ab7754\",\"canceledCheckId\":\"98dee1c6-1c18-4707-abef-6e968673e0bb\"}","environment":"stage","source":"/opt/apache-servicemix-6.1.4/instances/esb001/data/log/esb001.log","@version":"1","bundleid":"27638","host":{"name":"esb-stage"},"prospector":{"type":"log"},"package":"servicemix.esb.kkm"}}]}}
1566273 [main] INFO  kkm.UnitTests - End test

1566276 [main] INFO  kkm.UnitTests - Starting test: KKM_SIPheckStatus()
1569003 [main] INFO  kkm.UnitTests - End test

1569006 [main] INFO  kkm.UnitTests - Starting test: KKM_SendMessageNotFound()
1569038 [main] INFO  kkm.UnitTests - End test

1569040 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt_negative()
1569117 [main] INFO  kkm.UnitTests - End test

1569118 [main] INFO  kkm.UnitTests - Starting test: KKM_PostCorrectionReceipt()
1571804 [main] INFO  kkm.UnitTests - End test

