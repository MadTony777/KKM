169  [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGatewayWithStubs_DONE()
447  [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'DONE'
454  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
465  [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000898541
988  [main] INFO  kkm.UnitTests - update alertPeriod set finishTime = '00:00:00' where FilialCode = '--filialCode--'
update alertPeriod set startTime = '00:00:00' where FilialCode = '--filialCode--'
update customer set Phone = '70000000000' where srcID = 'ЖПлато_000898541'
update customer set email = '' where srcId = 'ЖПлато_000898541'
update processStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000898541'
select * from processStatus where srcID = 'ЖПлато_000898541'
989  [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
995  [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, nothing, ЖПлато_000898541]
61318 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000898541'
61318 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, SENDED, nothing, ЖПлато_000898541]
121582 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000898541%22%20&size=500
121751 [main] INFO  kkm.UnitTests - Response message : {"took":48,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":11.991403,"hits":[{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"cUCLrnYBfrYj4vM932rz","_score":11.991403,"_source":{"@timestamp":"2020-12-29T12:49:08.969Z","message":"{\"ts\":\"2020-12-29T12:49:08.969+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"8042ce0e51afbb12\",\"spanId\":\"8042ce0e51afbb12\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8042ce0e51afbb12\",\"X-B3-TraceId\":\"8042ce0e51afbb12\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000898541\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","stream":"stdout","input":{"type":"container"},"container":{"image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"},"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service"}}},"ecs":{"version":"1.0.1"},"agent":{"hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11"},"log":{"offset":7088274,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"host":{"name":"4597739f505f"}}}]}}
121770 [main] INFO  kkm.UnitTests - End test

121783 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_Error()
121940 [main] INFO  kkm.UnitTests - Script is: SELECT TOP 1 * FROM ProcessStatus Where fiscGateCheckStatusCode = 'ERROR'
121941 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
121946 [main] INFO  kkm.UnitTests - srcID is: ЖПлато_000901797
122517 [main] INFO  kkm.UnitTests - update dbo.Customer set inn = '1' where srcID = 'ЖПлато_000901797'
update ProcessStatus set fiscGateCheckStatusCode = null where srcID = 'ЖПлато_000901797'
select * from ProcessStatus where srcID = 'ЖПлато_000901797'
122517 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
122521 [main] INFO  kkm.UnitTests - Status is: [AXAPTA, PaymentOrder, null, VALIDATION_ERROR, ЖПлато_000901797]
182788 [main] INFO  kkm.UnitTests - select * from ProcessStatus where srcID = 'ЖПлато_000901797'
182789 [main] INFO  kkm.UnitTests - Table String info is: [AXAPTA, PaymentOrder, ERROR, VALIDATION_ERROR, ЖПлато_000901797]
242797 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%22ЖПлато_000901797%22%20&size=500
242909 [main] INFO  kkm.UnitTests - Response message : {"took":51,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":12.75185,"hits":[{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"2UKNrnYBfrYj4vM9tNvB","_score":12.75185,"_source":{"@timestamp":"2020-12-29T12:51:09.075Z","message":"{\"ts\":\"2020-12-29T12:51:09.075+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"c25598ada9db1ce4\",\"spanId\":\"c25598ada9db1ce4\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c25598ada9db1ce4\",\"X-B3-TraceId\":\"c25598ada9db1ce4\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"AXAPTA\",\"entityCode\":\"PaymentOrder\",\"srcID\":\"ЖПлато_000901797\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","stream":"stdout","docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task":""}}},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"log":{"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"},"offset":7201734},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"}}}]}}
242911 [main] INFO  kkm.UnitTests - End test

242915 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_NOFILIAL()
243074 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-1nRjqDntOAzG', '2273462554', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-1nRjqDntOAzG','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-1nRjqDntOAzG', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-1nRjqDntOAzG', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-1nRjqDntOAzG'

update alertPeriod set finishTime = '00:00:00' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-1nRjqDntOAzG'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-1nRjqDntOAzG'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-1nRjqDntOAzG'
354092 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-1nRjqDntOAzG'
354092 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-1nRjqDntOAzG, null]
354096 [main] INFO  kkm.UnitTests - Status: null
354096 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
354097 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
374105 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
374346 [main] INFO  kkm.UnitTests - Response message : {"took":156,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1549,"relation":"eq"},"max_score":3.533097,"hits":[{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"QFTPq3YBfrYj4vM9gWGr","_score":3.533097,"_source":{"@timestamp":"2020-12-29T00:04:09.000Z","log":{"offset":25711282,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"host":{"name":"4597739f505f"},"stream":"stdout","message":"{\"ts\":\"2020-12-29T00:04:09.000+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3edbaa3e6fc6b781\",\"spanId\":\"3edbaa3e6fc6b781\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3edbaa3e6fc6b781\",\"X-B3-TraceId\":\"3edbaa3e6fc6b781\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw"}}}}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"n1TPq3YBfrYj4vM9750P","_score":3.533097,"_source":{"@timestamp":"2020-12-29T00:04:31.146Z","log":{"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"},"offset":25724197},"stream":"stdout","input":{"type":"container"},"message":"{\"ts\":\"2020-12-29T00:04:31.146+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"0e4c47204a783871\",\"spanId\":\"0e4c47204a783871\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"0e4c47204a783871\",\"X-B3-TraceId\":\"0e4c47204a783871\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i"}}},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"tFTQq3YBfrYj4vM9aNko","_score":3.533097,"_source":{"@timestamp":"2020-12-29T00:05:09.045Z","stream":"stdout","message":"{\"ts\":\"2020-12-29T00:05:09.044+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"c203e87a64f51feb\",\"spanId\":\"c203e87a64f51feb\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c203e87a64f51feb\",\"X-B3-TraceId\":\"c203e87a64f51feb\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","host":{"name":"4597739f505f"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"log":{"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"},"offset":25754924},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","Version":"97","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"FlLMq3YBfrYj4vM9AXCe","_score":3.533097,"_source":{"@timestamp":"2020-12-29T00:00:09.041Z","ecs":{"version":"1.0.1"},"log":{"offset":25547162,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","Version":"97","com_docker_swarm_task":""}}},"host":{"name":"4597739f505f"},"agent":{"hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11"},"stream":"stdout","message":"{\"ts\":\"2020-12-29T00:00:09.041+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"bd499e4e533f56fd\",\"spanId\":\"bd499e4e533f56fd\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"bd499e4e533f56fd\",\"X-B3-TraceId\":\"bd499e4e533f56fd\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"UVLMq3YBfrYj4vM9RYNw","_score":3.533097,"_source":{"@timestamp":"2020-12-29T00:00:31.131Z","log":{"offset":25560078,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"}}},"agent":{"ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat"},"stream":"stdout","host":{"name":"4597739f505f"},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-12-29T00:00:31.131+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"8d30fe67b924df4c\",\"spanId\":\"8d30fe67b924df4c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8d30fe67b924df4c\",\"X-B3-TraceId\":\"8d30fe67b924df4c\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
374514 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
374543 [main] INFO  kkm.UnitTests - End test

374547 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_UTC12_DONE()
374702 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-GfmENIv5W7Up', '1557442272', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-GfmENIv5W7Up','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-GfmENIv5W7Up', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-GfmENIv5W7Up', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-GfmENIv5W7Up'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-GfmENIv5W7Up'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-GfmENIv5W7Up'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-GfmENIv5W7Up'
485449 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-GfmENIv5W7Up'
485450 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-GfmENIv5W7Up, null]
485454 [main] INFO  kkm.UnitTests - Status: null
485454 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
485455 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
505459 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
505559 [main] INFO  kkm.UnitTests - Response message : {"took":41,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1553,"relation":"eq"},"max_score":3.5330927,"hits":[{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"QFTPq3YBfrYj4vM9gWGr","_score":3.5330927,"_source":{"@timestamp":"2020-12-29T00:04:09.000Z","log":{"offset":25711282,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"host":{"name":"4597739f505f"},"stream":"stdout","message":"{\"ts\":\"2020-12-29T00:04:09.000+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3edbaa3e6fc6b781\",\"spanId\":\"3edbaa3e6fc6b781\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3edbaa3e6fc6b781\",\"X-B3-TraceId\":\"3edbaa3e6fc6b781\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw"}}}}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"n1TPq3YBfrYj4vM9750P","_score":3.5330927,"_source":{"@timestamp":"2020-12-29T00:04:31.146Z","log":{"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"},"offset":25724197},"stream":"stdout","input":{"type":"container"},"message":"{\"ts\":\"2020-12-29T00:04:31.146+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"0e4c47204a783871\",\"spanId\":\"0e4c47204a783871\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"0e4c47204a783871\",\"X-B3-TraceId\":\"0e4c47204a783871\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i"}}},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"tFTQq3YBfrYj4vM9aNko","_score":3.5330927,"_source":{"@timestamp":"2020-12-29T00:05:09.045Z","stream":"stdout","message":"{\"ts\":\"2020-12-29T00:05:09.044+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"c203e87a64f51feb\",\"spanId\":\"c203e87a64f51feb\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c203e87a64f51feb\",\"X-B3-TraceId\":\"c203e87a64f51feb\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","host":{"name":"4597739f505f"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"log":{"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"},"offset":25754924},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","Version":"97","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"FlLMq3YBfrYj4vM9AXCe","_score":3.5330927,"_source":{"@timestamp":"2020-12-29T00:00:09.041Z","ecs":{"version":"1.0.1"},"log":{"offset":25547162,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","Version":"97","com_docker_swarm_task":""}}},"host":{"name":"4597739f505f"},"agent":{"hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11"},"stream":"stdout","message":"{\"ts\":\"2020-12-29T00:00:09.041+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"bd499e4e533f56fd\",\"spanId\":\"bd499e4e533f56fd\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"bd499e4e533f56fd\",\"X-B3-TraceId\":\"bd499e4e533f56fd\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"UVLMq3YBfrYj4vM9RYNw","_score":3.5330927,"_source":{"@timestamp":"2020-12-29T00:00:31.131Z","log":{"offset":25560078,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"}}},"agent":{"ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat"},"stream":"stdout","host":{"name":"4597739f505f"},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-12-29T00:00:31.131+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"8d30fe67b924df4c\",\"spanId\":\"8d30fe67b924df4c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8d30fe67b924df4c\",\"X-B3-TraceId\":\"8d30fe67b924df4c\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
505717 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0031'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0031'
505742 [main] INFO  kkm.UnitTests - End test

505746 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_NoSentToGateway_UTC2_FAIL()
505894 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-quujhvIfrq3T', '5044899129', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-quujhvIfrq3T','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-quujhvIfrq3T', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-quujhvIfrq3T', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-quujhvIfrq3T'

update alertPeriod set finishTime = '00:00:00' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-quujhvIfrq3T'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-quujhvIfrq3T'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-quujhvIfrq3T'
616695 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-quujhvIfrq3T'
616696 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-quujhvIfrq3T, null]
616700 [main] INFO  kkm.UnitTests - Status: null
616700 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
616701 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
636705 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20&size=5
636839 [main] INFO  kkm.UnitTests - Response message : {"took":76,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1557,"relation":"eq"},"max_score":3.5330546,"hits":[{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"QFTPq3YBfrYj4vM9gWGr","_score":3.5330546,"_source":{"@timestamp":"2020-12-29T00:04:09.000Z","log":{"offset":25711282,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"host":{"name":"4597739f505f"},"stream":"stdout","message":"{\"ts\":\"2020-12-29T00:04:09.000+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"3edbaa3e6fc6b781\",\"spanId\":\"3edbaa3e6fc6b781\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"3edbaa3e6fc6b781\",\"X-B3-TraceId\":\"3edbaa3e6fc6b781\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","input":{"type":"container"},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw"}}}}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"n1TPq3YBfrYj4vM9750P","_score":3.5330546,"_source":{"@timestamp":"2020-12-29T00:04:31.146Z","log":{"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"},"offset":25724197},"stream":"stdout","input":{"type":"container"},"message":"{\"ts\":\"2020-12-29T00:04:31.146+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"0e4c47204a783871\",\"spanId\":\"0e4c47204a783871\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"0e4c47204a783871\",\"X-B3-TraceId\":\"0e4c47204a783871\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i"}}},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"}}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"tFTQq3YBfrYj4vM9aNko","_score":3.5330546,"_source":{"@timestamp":"2020-12-29T00:05:09.045Z","stream":"stdout","message":"{\"ts\":\"2020-12-29T00:05:09.044+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"c203e87a64f51feb\",\"spanId\":\"c203e87a64f51feb\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"c203e87a64f51feb\",\"X-B3-TraceId\":\"c203e87a64f51feb\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}","host":{"name":"4597739f505f"},"agent":{"type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1"},"log":{"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"},"offset":25754924},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","Version":"97","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"}}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"FlLMq3YBfrYj4vM9AXCe","_score":3.5330546,"_source":{"@timestamp":"2020-12-29T00:00:09.041Z","ecs":{"version":"1.0.1"},"log":{"offset":25547162,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","Version":"97","com_docker_swarm_task":""}}},"host":{"name":"4597739f505f"},"agent":{"hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11"},"stream":"stdout","message":"{\"ts\":\"2020-12-29T00:00:09.041+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"bd499e4e533f56fd\",\"spanId\":\"bd499e4e533f56fd\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"bd499e4e533f56fd\",\"X-B3-TraceId\":\"bd499e4e533f56fd\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}},{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"UVLMq3YBfrYj4vM9RYNw","_score":3.5330546,"_source":{"@timestamp":"2020-12-29T00:00:31.131Z","log":{"offset":25560078,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"Version":"97","com_docker_swarm_task":"","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i"}}},"agent":{"ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat"},"stream":"stdout","host":{"name":"4597739f505f"},"ecs":{"version":"1.0.1"},"message":"{\"ts\":\"2020-12-29T00:00:31.131+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":82,\"thread\":\"scheduling-1\",\"traceId\":\"8d30fe67b924df4c\",\"spanId\":\"8d30fe67b924df4c\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"8d30fe67b924df4c\",\"X-B3-TraceId\":\"8d30fe67b924df4c\",\"msg\":\"ReadyForSendingReceiptKeys is EMPTY\"}"}}]}}
637001 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
637026 [main] INFO  kkm.UnitTests - End test

637030 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_UTC12_DONE()
637294 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-dXw2VqLz6UE8', '6445282553', '2019-07-12 00:00:00.000', '7710026574', '0031');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-dXw2VqLz6UE8','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-dXw2VqLz6UE8', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-dXw2VqLz6UE8', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-dXw2VqLz6UE8'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0031'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0031'
update fiscalCheck set filialCode = '0031' where srcId = '9SD0C9DZ-9289-4A09-dXw2VqLz6UE8'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-dXw2VqLz6UE8'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-dXw2VqLz6UE8'
748012 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-dXw2VqLz6UE8'
748013 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, null, null, null, 9SD0C9DZ-9289-4A09-dXw2VqLz6UE8, null]
748017 [main] INFO  kkm.UnitTests - Status: null
748017 [main] INFO  kkm.UnitTests - fiscGateErrorCode: null
748017 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: null
748147 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/null
748147 [main] INFO  kkm.UnitTests - Response Code : 400
748149 [main] INFO  kkm.UnitTests - End test

748155 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_NOFILIAL()
748286 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jHoLCu0m7bkd', '8860257403', '2019-07-12 00:00:00.000', '7710026574', 'NOFILIAL');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jHoLCu0m7bkd','Фамилия Имя Отчество', '7710026574', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jHoLCu0m7bkd', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-jHoLCu0m7bkd', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-jHoLCu0m7bkd'

update alertPeriod set finishTime = '23:59:59' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '00:00:00' where FilialCode = 'NOFILIAL'
update fiscalCheck set filialCode = 'NOFILIAL' where srcId = '9SD0C9DZ-9289-4A09-jHoLCu0m7bkd'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-jHoLCu0m7bkd'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-jHoLCu0m7bkd'
858979 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-jHoLCu0m7bkd'
858980 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, DONE, , , 9SD0C9DZ-9289-4A09-jHoLCu0m7bkd, 789516bb-86fe-42b7-be77-c64946e72e46]
858984 [main] INFO  kkm.UnitTests - Status: DONE
858984 [main] INFO  kkm.UnitTests - fiscGateErrorCode: 
858984 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: 
859073 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/789516bb-86fe-42b7-be77-c64946e72e46
859073 [main] INFO  kkm.UnitTests - Response Code : 200
859083 [main] INFO  kkm.UnitTests - [DONE]
879088 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-jHoLCu0m7bkd%22%20&size=500
879224 [main] INFO  kkm.UnitTests - Response message : {"took":77,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":33.551018,"hits":[{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"Xk6XrnYBfrYj4vM9SoEq","_score":33.551018,"_source":{"@timestamp":"2020-12-29T13:01:31.131Z","message":"{\"ts\":\"2020-12-29T13:01:31.131+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"df4839a38b5a83b7\",\"spanId\":\"df4839a38b5a83b7\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"df4839a38b5a83b7\",\"X-B3-TraceId\":\"df4839a38b5a83b7\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-1nRjqDntOAzG\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-jHoLCu0m7bkd\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"stream":"stdout","log":{"offset":7645305,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"input":{"type":"container"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}},"docker":{"container":{"labels":{"com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","com_docker_stack_namespace":"kkm-commutator","Version":"97","com_docker_swarm_task":""}}},"agent":{"ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f","id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat"}}}]}}
879417 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = 'NOFILIAL'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = 'NOFILIAL'
879445 [main] INFO  kkm.UnitTests - End test

879448 [main] INFO  kkm.UnitTests - Starting test: KKM_DB_SentToGateway_UTC2_FAIL()
879916 [main] INFO  kkm.UnitTests - Script is: Insert into FiscalCheck(SystemCode,EntityCode,srcID,CorrelationID,Date,OrganizationInn, FilialCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-FWV3SedJppSC', '7563931469', '2019-07-12 00:00:00.000', '7725327863', '0067');

Insert into Customer(SystemCode,EntityCode,srcID, FullName,INN, Phone)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-FWV3SedJppSC','Фамилия Имя Отчество', '7725327863', '71000000000' );

Insert into Payment(SystemCode,EntityCode,srcID,Amount,PaymentTypeCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-FWV3SedJppSC', '1522756', 'INCOME');

Insert into Position(SystemCode,EntityCode,srcID,"Number",Name,Price,Quantity,TaxCode)
values( 'ADINSURE', 'Payment', '9SD0C9DZ-9289-4A09-FWV3SedJppSC', '123456', 'Страховая премия № 100000000', '1234', '1234', 'VAT20');

insert into ProcessStatus(SystemCode, EntityCode, srcID, fiscGateCorrelationID)
select top 1 f.SystemCode, f.EntityCode, f.srcID, CorrelationID
from FiscalCheck as f left join ProcessStatus as p on p.SystemCode = f.SystemCode and p.EntityCode = f.EntityCode and p.srcID = f.srcID
where p.EntityCode is null and f.srcID = '9SD0C9DZ-9289-4A09-FWV3SedJppSC'

update alertPeriod set finishTime = '23:59:59' where FilialCode = '0067'
update alertPeriod set startTime = '00:00:00' where FilialCode = '0067'
update fiscalCheck set filialCode = '0067' where srcId = '9SD0C9DZ-9289-4A09-FWV3SedJppSC'
update processStatus set fiscGateCheckStatusCode = null where srcId = '9SD0C9DZ-9289-4A09-FWV3SedJppSC'
select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-FWV3SedJppSC'
990751 [main] INFO  kkm.UnitTests - select * from processStatus where srcID = '9SD0C9DZ-9289-4A09-FWV3SedJppSC'
990751 [main] INFO  kkm.UnitTests - Table String info is: [ADINSURE, Payment, FAIL, BAD_REQUEST, Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}, 9SD0C9DZ-9289-4A09-FWV3SedJppSC, 45da8528-eb3a-497f-bbf7-dfb3e86a527d]
990754 [main] INFO  kkm.UnitTests - Status: FAIL
990755 [main] INFO  kkm.UnitTests - fiscGateErrorCode: BAD_REQUEST
990755 [main] INFO  kkm.UnitTests - fiscGateErrorMessage: Bad request: {
  "errors": [
    "Передача данных автомата недоступна для указанной группы"
  ]
}
991091 [main] INFO  kkm.UnitTests - 
Sending 'GET' request to URL : http://esb-stage:8501/cxf/rest/api/v1/kkm/receipts/45da8528-eb3a-497f-bbf7-dfb3e86a527d
991091 [main] INFO  kkm.UnitTests - Response Code : 200
991093 [main] INFO  kkm.UnitTests - [FAIL]
1011096 [main] INFO  kkm.UnitTests - URL is : http://elog.vsk.ru:9200/kkm-commutator-stage-2020.12.29/_search?q=%20message:%20%22ReadyForSendingReceiptKeys%22%20AND%20%229SD0C9DZ-9289-4A09-FWV3SedJppSC%22%20&size=500
1011254 [main] INFO  kkm.UnitTests - Response message : {"took":99,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":1,"relation":"eq"},"max_score":31.84886,"hits":[{"_index":"kkm-commutator-stage-2020.12.29","_type":"_doc","_id":"AlGZrnYBfrYj4vM9nDgC","_score":31.84886,"_source":{"@timestamp":"2020-12-29T13:04:08.982Z","stream":"stdout","message":"{\"ts\":\"2020-12-29T13:04:08.982+00:00\",\"logger\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"level\":\"INFO\",\"class\":\"ru.vsk.integration.kkmcommutator.KkmCommutatorService\",\"method\":\"getReadyForSendingReceiptKeys\",\"caller_file_name\":\"KkmCommutatorService.java\",\"caller_line_number\":84,\"thread\":\"scheduling-1\",\"traceId\":\"7f95dbd569c1cacb\",\"spanId\":\"7f95dbd569c1cacb\",\"spanExportable\":\"true\",\"X-Span-Export\":\"true\",\"X-B3-SpanId\":\"7f95dbd569c1cacb\",\"X-B3-TraceId\":\"7f95dbd569c1cacb\",\"X-VSK-ReceiptKeys\":[{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-quujhvIfrq3T\"},{\"systemCode\":\"ADINSURE\",\"entityCode\":\"Payment\",\"srcID\":\"9SD0C9DZ-9289-4A09-FWV3SedJppSC\"}],\"msg\":\"ReadyForSendingReceiptKeys selected \"}","input":{"type":"container"},"docker":{"container":{"labels":{"com_docker_stack_namespace":"kkm-commutator","com_docker_swarm_service_id":"v0bk7igldr6dey2wwas136yyw","com_docker_swarm_node_id":"ygqa2daq7eosrz5hy95q8qotd","com_docker_swarm_service_name":"kkm-commutator_service","com_docker_swarm_task_id":"sbw9tgq4sxtbpk4upf335u57i","com_docker_swarm_task_name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","Description":"KKM Commutator Service","Version":"97","com_docker_swarm_task":""}}},"ecs":{"version":"1.0.1"},"host":{"name":"4597739f505f"},"log":{"offset":7813196,"file":{"path":"/var/lib/docker/containers/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef/5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef-json.log"}},"agent":{"id":"43b4a947-ca03-403c-bf09-06f308a0e16c","version":"7.3.1","type":"filebeat","ephemeral_id":"966c5eea-79a5-4ae5-846c-a19d43c74a11","hostname":"4597739f505f"},"container":{"id":"5ddc114922a010f1de728d15f6136a4c7d2553b96cb91284fe9cbc86de5883ef","name":"kkm-commutator_service.1.sbw9tgq4sxtbpk4upf335u57i","image":{"name":"nexus.vsk.ru:8183/vsk/kkm-commutator:97@sha256:d7fe200be876de577493ecaf034656903ed1743d311447433a9e080df2bf87fe"}}}}]}}
1011429 [main] INFO  kkm.UnitTests - Script is: update alertPeriod set finishTime = '--18:59:59--' where FilialCode = '0067'
update alertPeriod set startTime = '--09:00:00--' where FilialCode = '0067'
1011456 [main] INFO  kkm.UnitTests - End test

